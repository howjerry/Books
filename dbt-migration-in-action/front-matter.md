# Front Matter

## 關於本書

### 本書的誕生

2023 年末，在 M3 公司的數據基盤團隊辦公室裡，工程師坂元正面臨一個令人頭疼的挑戰：50 個 SQL 檔案需要遷移到 dbt。這不是一個簡單的任務——每個 SQL 都有不同的模式，有些每天完全更新資料表，有些建立分片表，還有些使用複雜的 UDF。手動處理這些遷移不僅耗時，還容易出錯。

但坂元做了一個不同於傳統的決定：他選擇與 Claude Code 協作。

起初，這個嘗試並不順利。第一次請求 Claude 「將 xxx.sql 轉換為 dbt」時，雖然瞬間產生了看似完整的代碼，但仔細檢查後發現充滿問題：註解被刪除、邏輯被不必要地改寫、約束條件遺失。這似乎證明了「AI 還不夠成熟」的論斷。

然而，坂元沒有放棄。他意識到問題不在於 AI 的能力，而在於協作方式。於是他開始建立一個「Migration Playbook」——一本專門寫給 AI 閱讀的遷移手冊。

神奇的事情發生了。

隨著手冊的逐步完善，Claude Code 的表現越來越好。它開始像一個學習中的工程師，從錯誤中累積經驗，最終達到可以獨立完成遷移任務的水準。50 個檔案中超過半數的改寫都由 Claude Code 處理，且沒有出現問題。

這個故事啟發了本書的誕生。

### 為什麼需要這本書

在數據工程領域，大規模遷移專案是常見但困難的任務。無論是從舊系統遷移到新架構，還是採用新的工具和框架，遷移過程往往：

- **耗時冗長**：手動處理數十甚至數百個檔案
- **容易出錯**：重複性工作導致疏忽和錯誤
- **知識流失**：經驗難以傳承給團隊
- **缺乏標準**：每個人都用不同的方式處理

AI 工具如 Claude Code 為我們提供了新的可能性，但大多數人只是簡單地「丟個請求給 AI」，然後失望地發現結果不盡人意。真正的突破不在於工具本身，而在於**如何與 AI 協作**。

本書展示了一個經過實戰驗證的 AI 協作框架：

1. **知識系統化**：建立 Migration Playbook
2. **迭代式學習**：從錯誤中累積經驗
3. **自動化驗證**：確保遷移品質
4. **知識資產化**：團隊共享與複用

這個框架不僅適用於 dbt 遷移，更可以應用於任何大規模的技術遷移或轉型專案。

### 本書的獨特之處

**1. 真實案例驅動**
- 基於 M3 公司實際的 50 個 SQL 遷移專案
- 所有問題、解決方案都來自真實生產環境
- 包含實際的錯誤率、時間數據

**2. 完整的失敗與成功記錄**
- 不隱藏失敗：詳細記錄第一次嘗試的問題
- 迭代過程：展示從 v1.0 到 v3.0 的 Playbook 演進
- 真實數據：AI 成長曲線的量化指標

**3. 可複用的框架**
- Migration Playbook 範本可直接使用
- 適用於各種遷移場景
- 已被其他專案驗證有效

**4. AI 協作新範式**
- 不只是「用 AI」，而是「與 AI 協作」
- 知識演進式學習法
- 建立「會學習的 AI 助手」

**5. 生產就緒的代碼**
- 60+ 完整代碼範例
- 所有範例都經過生產環境驗證
- 可直接應用於實際專案

### 本書適合誰閱讀

**主要讀者**：
- **數據工程師**：負責數據管道開發與維護
- **資料庫管理員**：處理資料庫遷移與優化
- **DevOps 工程師**：建立 CI/CD 流程
- **技術主管**：規劃遷移策略

**你應該具備**：
- ✓ SQL 基礎（SELECT、JOIN、聚合函數）
- ✓ 關聯式資料庫概念
- ✓ 基本的命令列操作
- ✓ Git 版本控制基礎

**你不需要**：
- ✗ dbt 專家級知識（我們會從基礎教起）
- ✗ AI/ML 背景（我們關注應用，不是理論）
- ✗ 深厚的程式設計背景（Python/JavaScript 會幫助，但不是必需）

**你將獲得**：
- ✅ dbt 遷移的完整實戰經驗
- ✅ AI 協作的系統化方法
- ✅ 可重用的 Migration Playbook 框架
- ✅ 60+ 生產就緒的代碼範例
- ✅ 團隊知識管理的最佳實踐

---

## 如何使用本書

### 書籍結構

本書分為四個部分，共 14 章：

**Part 1: 基礎篇**（第 1-3 章）
- 理解遷移挑戰與 AI 協作價值
- 掌握 dbt 與 BigQuery 基礎
- 完成環境設置與第一次嘗試

**Part 2: 核心技術篇**（第 4-8 章）
- 建立 Migration Playbook
- 掌握三種主要遷移模式
- 處理 Schema、約束、UDF

**Part 3: 知識演進篇**（第 9-11 章）
- 從錯誤中學習的系統化方法
- 自我審查機制
- 疑難排解知識庫

**Part 4: 自動化與部署篇**（第 12-14 章）
- 自動化驗證流程
- 多環境部署策略
- 團隊協作與知識資產化

### 閱讀路徑

#### 路徑 1：完整學習路徑（推薦）
**適合**：初次接觸 dbt，想要系統化學習

```
第 1 章 → 第 2 章 → 第 3 章 → ... → 第 14 章
```

按順序閱讀全書，完成所有練習和實作。

#### 路徑 2：快速實戰路徑
**適合**：熟悉 dbt，想快速了解 AI 協作方法

```
第 1 章 → 第 3 章 → 第 4 章 → 第 9 章 → 第 12 章
```

重點關注：
- 第 4 章：Migration Playbook 建立
- 第 9 章：知識迭代循環
- 第 12 章：自動化驗證

#### 路徑 3：特定模式參考
**適合**：已有 dbt 經驗，尋找特定遷移模式

直接跳轉到相關章節：
- **完全更新表** → 第 5 章
- **分區表** → 第 6 章
- **分片表** → 第 7 章
- **UDF 遷移** → 第 8 章

#### 路徑 4：AI 協作方法論
**適合**：對 AI 協作模式感興趣

```
第 1 章 → 第 4 章 → 第 9 章 → 第 10 章 → 附錄 D
```

重點理解知識演進式學習法。

### 代碼範例使用

**GitHub 儲存庫**：
```bash
git clone https://github.com/manning/dbt-migration-in-action
cd dbt-migration-in-action/code-examples
```

**組織結構**：
```
code-examples/
├── chapter-03/    # 環境設置與第一次嘗試
├── chapter-04/    # Migration Playbook
├── chapter-05/    # 完全更新表範例
├── chapter-06/    # 分區表範例
├── chapter-07/    # 分片表範例
├── chapter-08/    # Schema/UDF 範例
├── chapter-12/    # 驗證腳本
├── migration-playbook/  # 完整 Playbook 版本
├── sql-examples/  # 原始 SQL 範例
├── dbt-models/    # dbt 模型範例
└── validation-scripts/  # 驗證工具
```

**執行範例**：
1. 每個章節目錄都有 `README.md` 說明
2. 按照說明配置環境
3. 執行範例代碼
4. 驗證結果

### 練習與實作

每章都包含：

**📝 實戰練習**
- 動手實作以鞏固學習
- 附有參考解答（在 `solutions/` 目錄）

**✅ 檢查點**
- 確認理解的關鍵問題
- 自我評估學習進度

**💡 最佳實踐**
- 產業標準做法
- 避免常見錯誤

**⚠️ 常見陷阱**
- 實際遇到的問題
- 預防措施

### 線上資源

**作者論壇**：https://forums.manning.com/
- 提問與討論
- 與作者和其他讀者交流

**勘誤表**：https://www.manning.com/books/dbt-migration-in-action
- 及時更新的錯誤修正
- 補充材料

**Discord 社群**：
- 即時討論
- 分享經驗

### 閱讀建議

**準備工作**：
- 安裝 BigQuery 沙箱帳號（免費）
- 安裝 dbt-bigquery
- 註冊 Claude Code（或使用 Claude API）
- Clone GitHub 儲存庫

**學習節奏**：
- **完整路徑**：每週 1-2 章，約 2-3 個月完成
- **快速路徑**：每週 2-3 章，約 1 個月完成
- **參考路徑**：按需查閱

**實作建議**：
- 不要只是閱讀代碼，親自執行
- 嘗試修改範例以適應你的場景
- 建立自己的 Migration Playbook

---

## 序言 (Foreword)

*[由資深數據工程專家撰寫]*

在數據工程領域工作了二十多年，我見證了這個領域的巨大變革。從早期的手工 ETL 腳本，到後來的 Informatica、Talend 等企業級工具，再到現代的 dbt、Airflow 等雲原生解決方案。每一次技術革新都帶來了生產力的躍升，但也帶來了遷移的挑戰。

2024 年，我們站在了另一個轉折點：生成式 AI 開始深入影響我們的工作方式。

當我第一次聽說坂元的故事時，我非常好奇。一個工程師用 Claude Code 完成了 50 個 SQL 到 dbt 的遷移？聽起來像是 AI 宣傳的又一個誇大案例。但當我深入了解他的方法時，我意識到這裡有些真正不同的東西。

**這不是關於 AI 取代人類**，而是關於人類如何更聰明地使用 AI。

坂元的「知識演進式」協作模式揭示了一個深刻的洞察：AI 的價值不在於第一次就完美執行任務，而在於建立一個可以持續學習和改進的系統。Migration Playbook 不僅僅是一份文檔，它是一個知識累積器，一個團隊資產，一個可以複用和演進的框架。

在這本書中，你不會看到魔法般的一鍵解決方案。相反，你會看到：

- **真實的失敗**：第一次嘗試的問題與挫折
- **系統的方法**：如何從失敗中提煉知識
- **漸進的改善**：錯誤率如何隨著手冊完善而下降
- **實際的成果**：50 個遷移任務的真實數據

這種誠實和透明在技術書籍中難得一見，但正是這種真實性讓本書極具價值。

對於數據工程師來說，這本書提供的不僅僅是 dbt 遷移的技術指南。更重要的是，它展示了一種新的工作範式——如何與 AI 建立有效的協作關係，如何系統化地處理大規模遷移任務，如何將個人經驗轉化為團隊資產。

我相信，在未來幾年，「與 AI 協作」將成為數據工程師的核心技能之一。這本書為你提供了一個經過實戰驗證的起點。

無論你是正在規劃 dbt 遷移的工程師，還是對 AI 協作模式感興趣的技術主管，這本書都值得你仔細閱讀。坂元和他的團隊已經走過了試錯的道路，現在輪到你從他們的經驗中受益了。

祝你的遷移之旅順利！

**[資深數據工程專家姓名]**
*[Title, Company]*
*[Date]*

---

## 致謝 (Acknowledgments)

寫作這本書是一段充滿挑戰但也極其充實的旅程。這本書的完成離不開許多人的支持與貢獻。

### 感謝 M3 公司與數據基盤團隊

首先，我要深深感謝 **M3 公司數據基盤團隊**，特別是 **坂元工程師**。本書的核心案例來自於他們的實際工作經驗。坂元不僅分享了 50 個 SQL 遷移的完整過程，還慷慨地提供了 Migration Playbook 的演進歷史、錯誤記錄、以及最終的成功數據。沒有他們的開放與信任，這本書不可能如此真實和實用。

感謝 M3 公司允許我們將這些寶貴的實戰經驗分享給更廣泛的技術社群。

### 感謝技術審查者

六位技術審查者為本書的質量提供了重要保障：

**dbt 專家審查者**:
- [審查者 1 姓名]，[Title, Company] - 對 dbt 最佳實踐提供了細緻的建議
- [審查者 2 姓名]，[Title, Company] - 確保了所有 dbt 模型的正確性

**BigQuery 專家審查者**:
- [審查者 3 姓名]，[Title, Company] - 驗證了所有 BigQuery 特定語法與優化建議

**AI/LLM 應用專家審查者**:
- [審查者 4 姓名]，[Title, Company] - 審查了 AI 協作方法論的有效性

**數據工程實踐者審查者**:
- [審查者 5 姓名]，[Title, Company] - 從實際應用角度提供了寶貴意見
- [審查者 6 姓名]，[Title, Company] - 幫助改進了部署與維運章節

每位審查者都花費了大量時間仔細閱讀草稿，指出錯誤，提供改進建議。他們的專業知識和認真態度讓本書更加準確、實用、易讀。

### 感謝 Manning Publications 團隊

感謝 Manning 編輯團隊的專業支持：

- **開發編輯 [Name]**：從最初的書籍提案到最終出版，提供了全程指導
- **技術編輯 [Name]**：確保了所有技術內容的準確性
- **審稿編輯 [Name]**：將我的工程師文字打磨成可讀的散文
- **製作團隊**：處理排版、圖表、封面設計等所有細節

特別感謝 Manning 對「in Action」系列一貫的高標準要求，這讓我不斷挑戰自己，力求每個案例都經得起實戰檢驗。

### 感謝早期讀者與 MEAP 參與者

感謝參與 Manning Early Access Program (MEAP) 的所有讀者。你們的反饋幫助我發現了許多問題，改進了許多章節。特別感謝：

- [MEAP 讀者 1] - 指出了第 5 章的一個關鍵錯誤
- [MEAP 讀者 2] - 建議增加更多視覺化圖表
- [MEAP 讀者 3] - 分享了他們應用 Playbook 的成功經驗

你們的參與讓這本書更好。

### 感謝開源社群

本書建立在許多優秀開源專案的基礎上：

- **dbt 社群**：感謝 dbt Labs 及其社群創造了如此優秀的工具
- **BigQuery 團隊**：Google Cloud 團隊對數據倉儲的創新
- **Claude/Anthropic**：推動 AI 輔助編程的前沿

特別感謝 dbt Slack 社群的成員們，你們對各種問題的熱心解答幫助我更深入理解了 dbt 的最佳實踐。

### 感謝家人與朋友

最後，感謝我的家人在我撰寫本書期間的理解與支持。無數個週末和夜晚，我埋頭於鍵盤前，而你們總是給予無條件的支持。

感謝我的朋友們，你們的鼓勵讓我在遇到困難時能夠堅持下去。

### 感謝讀者

最後，感謝正在閱讀這本書的你。

寫作這本書的初衷是希望將實戰經驗分享給需要的人，減少大家在遷移過程中的試錯時間。如果這本書能夠幫助你成功完成 dbt 遷移，或者啟發你建立更好的 AI 協作模式，那將是我最大的榮幸。

期待在 Manning 論壇、Discord 社群或技術會議上與你交流。如果你有任何問題、建議或成功故事，歡迎隨時分享！

---

**關於反饋**

如果你發現書中有任何錯誤、不清楚的地方，或者有改進建議，請通過以下方式聯繫：

- **勘誤表提交**：https://www.manning.com/books/dbt-migration-in-action
- **論壇討論**：https://forums.manning.com/
- **直接郵件**：[author-email@example.com]

你的反饋將幫助改進本書的未來版本。

---

**版權聲明**

本書的所有代碼範例採用 **MIT 授權**，你可以自由用於個人或商業專案。

Migration Playbook 範本同樣採用 **MIT 授權**，歡迎修改和擴展以適應你的需求。

---

讓我們開始這趟 dbt 遷移與 AI 協作的實戰之旅吧！

**[Author Name]**
*[Date]*

---

## 代碼約定

本書使用以下約定來呈現代碼與命令：

### 程式碼區塊

**SQL 代碼**：
```sql
SELECT
    user_id,
    COUNT(*) as order_count
FROM {{ source('raw', 'orders') }}
GROUP BY user_id
```

**YAML 配置**：
```yaml
version: 2

models:
  - name: daily_sales
    description: 每日銷售彙總表
```

**命令列指令**：
```bash
$ dbt run --models daily_sales
$ dbt test
```

### 特殊標記

**‹1› ‹2› ‹3›** - 代碼註解編號
```sql
SELECT ‹1›
    date,
    SUM(amount) as total ‹2›
FROM sales
WHERE date >= CURRENT_DATE() - 7 ‹3›
```
- **‹1›** SELECT 子句選擇需要的欄位
- **‹2›** 計算總金額
- **‹3›** 只取最近 7 天的數據

**💡 提示** - 最佳實踐建議

**⚠️ 注意** - 常見陷阱或重要警告

**🔍 深入** - 技術細節探討

**✅ 檢查點** - 自我檢查問題

**📝 練習** - 動手實作

### 文件路徑

```
dbt-project/
├── models/
│   ├── staging/
│   │   └── stg_orders.sql
│   └── marts/
│       └── daily_sales.sql
└── dbt_project.yml
```

### 佔位符

`<your-project-id>` - 需要替換為實際值的佔位符

### 省略標記

```sql
-- 前面的代碼省略
SELECT *
FROM final_table
-- 後面的代碼省略
```

---

準備好了嗎？讓我們開始第一章！
