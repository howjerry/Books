# CLAUDE.md - AI å”ä½œæŒ‡å—

## æ–‡ä»¶ç›®çš„

æœ¬æ–‡ä»¶æ˜¯å°ˆé–€ç‚º AI å”ä½œæ’°å¯«æœ¬æ›¸è€Œè¨­è¨ˆçš„æŒ‡å—ã€‚å¦‚æœä½ æ˜¯ Claude Code æˆ–å…¶ä»– AI åŠ©æ‰‹ï¼Œæ­£åœ¨å”åŠ©æ’°å¯«ã€ä¿®è¨‚æˆ–æ“´å±•æœ¬æ›¸å…§å®¹ï¼Œè«‹ä»”ç´°é–±è®€æœ¬æ–‡ä»¶çš„å®Œæ•´å…§å®¹ã€‚

## âš ï¸ é‡è¦æé†’

**è«‹å‹™å¿…å®Œæ•´é–±è®€æœ¬æ–‡ä»¶**ã€‚ä¸è¦åªé–±è®€å‰åŠéƒ¨åˆ†å°±é–‹å§‹å·¥ä½œã€‚å®Œæ•´çš„ä¸Šä¸‹æ–‡å°æ–¼ç”¢å‡ºé«˜å“è³ªå…§å®¹è‡³é—œé‡è¦ã€‚

---

## æ›¸ç±æ ¸å¿ƒè³‡è¨Š

### æ›¸ç±å®šä½

**æ›¸å**: dbt Migration in Action: AI-Powered Database Transformation with Claude Code

**ä¸­æ–‡å‰¯æ¨™é¡Œ**: ç”¨ Claude Code æ‰“é€ æ™ºæ…§åŒ–è³‡æ–™åº«è½‰å‹ - 50 å€‹ SQL é·ç§»çš„å¯¦æˆ°æ•…äº‹

**å‡ºç‰ˆç¤¾**: Manning Publications
**ç³»åˆ—**: "in Action" Series
**ç›®æ¨™è®€è€…**: æ•¸æ“šå·¥ç¨‹å¸«ã€è³‡æ–™åº«ç®¡ç†å“¡ã€DevOps å·¥ç¨‹å¸«
**é›£åº¦**: ä¸­ç´šåˆ°é€²éš

### æ ¸å¿ƒåƒ¹å€¼ä¸»å¼µ

æœ¬æ›¸çš„ç¨ç‰¹æ€§åœ¨æ–¼ï¼š

1. **çœŸå¯¦æ¡ˆä¾‹é©…å‹•**: åŸºæ–¼ M3 å…¬å¸å¯¦éš›çš„ 50 å€‹ SQL é·ç§»å°ˆæ¡ˆ
2. **å®Œæ•´çš„å¤±æ•—èˆ‡æˆåŠŸ**: ä¸éš±è—ç¬¬ä¸€æ¬¡å˜—è©¦çš„å¤±æ•—ï¼Œå±•ç¤ºå®Œæ•´çš„å­¸ç¿’éç¨‹
3. **çŸ¥è­˜æ¼”é€²æ¨¡å¼**: å±•ç¤º Migration Playbook å¾ v1.0 åˆ° v3.0 çš„æ¼”åŒ–
4. **å¯è¤‡ç”¨æ¡†æ¶**: æä¾›å¯ç›´æ¥æ‡‰ç”¨çš„ Playbook ç¯„æœ¬å’Œä»£ç¢¼ç¯„ä¾‹
5. **AI å”ä½œæ–°ç¯„å¼**: å±•ç¤ºå¦‚ä½•èˆ‡ AI å»ºç«‹æœ‰æ•ˆçš„å”ä½œé—œä¿‚

---

## Manning "in Action" å¯«ä½œé¢¨æ ¼è¦æ±‚

### æ ¸å¿ƒåŸå‰‡

Manning "in Action" ç³»åˆ—æœ‰æ˜ç¢ºçš„é¢¨æ ¼è¦æ±‚ï¼Œ**å¿…é ˆåš´æ ¼éµå®ˆ**ï¼š

#### 1. å°ˆæ¡ˆ/æ¡ˆä¾‹é©…å‹•é–‹é ­ (Project/Case-Driven Opening)

**è¦æ±‚**:
- æ¯ç« å¿…é ˆä»¥å…·é«”çš„å°ˆæ¡ˆã€æ¡ˆä¾‹æˆ–æœ€çµ‚ç›®æ¨™é–‹é ­
- æ˜ç¢ºèªªæ˜è®€è€…åœ¨æœ¬ç« çµæŸæ™‚å°‡å®Œæˆä»€éº¼ã€ç”¢å‡ºä»€éº¼ã€å­¸åˆ°ä»€éº¼
- é¿å…æŠ½è±¡çš„ç†è«–é–‹å ´

**ç¯„ä¾‹**:

âœ… **å¥½çš„é–‹é ­**:
```markdown
åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘å€‘å°‡å»ºç«‹ç¬¬ä¸€ç‰ˆçš„ Migration Playbookï¼Œ
é€™æ˜¯ä¸€ä»½å°ˆé–€å¯«çµ¦ AI é–±è®€çš„é·ç§»æ‰‹å†Šã€‚åˆ°æœ¬ç« çµæŸæ™‚ï¼Œ
ä½ å°‡æ“æœ‰ä¸€å€‹åŒ…å« 6 å€‹æ ¸å¿ƒç« ç¯€çš„ Playbookï¼Œä¸¦ä¸”èƒ½å¤ 
ç”¨å®ƒæŒ‡å° Claude Code å®Œæˆç¬¬äºŒå€‹ SQL æª”æ¡ˆçš„é·ç§»ã€‚
```

âŒ **ä¸å¥½çš„é–‹é ­**:
```markdown
Migration Playbook æ˜¯ä¸€ç¨®çŸ¥è­˜ç®¡ç†å·¥å…·ï¼Œç”¨æ–¼ç³»çµ±åŒ–
åœ°çµ„ç¹”é·ç§»çŸ¥è­˜ã€‚å®ƒæœ‰è¨±å¤šå„ªé»...
```

#### 2. å¾åŸºç¤åˆ°é€²éšçš„æ¼”é€² (Progressive Evolution)

**è¦æ±‚**:
- å…§å®¹å¿…é ˆå¾ªåºæ¼¸é€²
- å¾æœ€ç°¡å–®çš„å ´æ™¯é–‹å§‹ï¼Œé€æ­¥å¢åŠ è¤‡é›œæ€§
- æ¯å€‹å°ç¯€å®Œæˆä¸€å€‹æ¸…æ™°ã€ç¨ç«‹çš„çŸ¥è­˜é»æˆ–ä»»å‹™

**ç¯„ä¾‹çµæ§‹**:
```markdown
4.1 Migration Playbook çš„è¨­è¨ˆåŸå‰‡  â† åŸºç¤æ¦‚å¿µ
4.2 å»ºç«‹ç¬¬ä¸€ç‰ˆæ‰‹å†Šï¼ˆ6 å€‹ç« ç¯€ï¼‰   â† ç°¡å–®ç‰ˆæœ¬
4.3 æ¸¬è©¦æ‰‹å†Šï¼šç¬¬äºŒå€‹ SQL æª”æ¡ˆ    â† é©—è­‰
4.4 è¿­ä»£æ”¹é€²æ©Ÿåˆ¶                â† é€²éšæ‡‰ç”¨
```

#### 3. å¯¦é«”ç”¢å‡ºç‚ºæ ¸å¿ƒ (Artifact-Centric Narrative)

**é€™æ˜¯æœ€é‡è¦çš„èª¿æ•´ï¼**

æ–‡ç« çš„æ ¸å¿ƒä¸æ˜¯æŠ½è±¡ç†è«–ï¼Œè€Œæ˜¯è®€è€…å¯ä»¥çœ‹åˆ°ã€æ¨¡ä»¿ã€å‰µå»ºçš„**å…·é«”ç”¢å‡ºç‰©**ã€‚

**ç”¢å‡ºç‰©é¡å‹**ï¼ˆæ ¹æ“šç« ç¯€å…§å®¹é¸æ“‡ï¼‰:

- **ç¨‹å¼ç¢¼æˆ–å½ä»£ç¢¼**: å®Œæ•´ã€å¯åŸ·è¡Œçš„ SQLã€Pythonã€YAML
- **é…ç½®æª”æ¡ˆ**: dbt_project.ymlã€profiles.ymlã€sources.yml
- **åœ–è¡¨**: Mermaid æµç¨‹åœ–ã€æ¶æ§‹åœ–ã€å°æ¯”è¡¨
- **æ‰‹å†Š/æ¸…å–®**: Migration Playbookã€æª¢æŸ¥æ¸…å–®ã€ç–‘é›£æ’è§£æŒ‡å—
- **è…³æœ¬**: é©—è­‰è…³æœ¬ã€éƒ¨ç½²è…³æœ¬ã€å›å¡«è…³æœ¬

**æ¯ç« å¿…é ˆåŒ…å«è‡³å°‘ 2-3 å€‹æ ¸å¿ƒç”¢å‡ºç‰©**ã€‚

**ç¯„ä¾‹**:

```markdown
### 4.2 å»ºç«‹ç¬¬ä¸€ç‰ˆæ‰‹å†Š

è®“æˆ‘å€‘é–‹å§‹å»ºç«‹ Migration Playbook v1.0ã€‚é€™å€‹åˆç‰ˆå°‡åŒ…å« 6 å€‹æ ¸å¿ƒç« ç¯€ï¼š

```markdown
# dbt æ¨¡å‹é·ç§»æ‰‹å†Š v1.0

## 1. ç¢ºèªé·ç§»ä¾†æºçš„ SQL æª”æ¡ˆ  â€¹1â€º
åœ¨é–‹å§‹é·ç§»å‰ï¼Œå…ˆç¢ºèªåŸå§‹ SQL æª”æ¡ˆçš„çµæ§‹ï¼š
- æª”æ¡ˆä½ç½®
- CREATE TABLE èªæ³•
- SELECT é‚è¼¯
- æ˜¯å¦ä½¿ç”¨ UDF

## 2. å»ºç«‹åƒç…§å¤–éƒ¨ schema è³‡æ–™è¡¨çš„ sources å®šç¾©  â€¹2â€º
...
```

**â€¹1â€º** ç¬¬ä¸€æ­¥ç¸½æ˜¯åˆ†æåŸå§‹æª”æ¡ˆã€‚é€™ç¢ºä¿æˆ‘å€‘ç†è§£é·ç§»çš„ä¾†æºå’Œç›®æ¨™ã€‚
**â€¹2â€º** sources å®šç¾©æ˜¯ dbt çš„åŸºç¤ï¼Œè®“æˆ‘å€‘ç”¨ source() å‡½æ•¸åƒç…§å¤–éƒ¨è¡¨ã€‚
```

#### 4. è¨»è§£èˆ‡åˆ†è§£èªªæ˜ (Annotated & Decomposed Explanations)

**è¦æ±‚**:
- å°é—œéµç”¢å‡ºç‰©ä½¿ç”¨ â€¹1â€º â€¹2â€º â€¹3â€º ç·¨è™Ÿæ¨™è¨˜
- åœ¨ç”¢å‡ºç‰©ä¸‹æ–¹æä¾›è©³ç´°è§£é‡‹
- è§£é‡‹è¨­è¨ˆç›®çš„ã€å…§éƒ¨é‚è¼¯ã€æ“ä½œåŸå› 

**ç¯„ä¾‹**:

```markdown
```sql
-- models/staging/stg_orders.sql
SELECT  â€¹1â€º
    order_id,
    user_id,
    DATE(order_timestamp) as order_date,  â€¹2â€º
    amount
FROM {{ source('raw', 'orders') }}  â€¹3â€º
WHERE order_date >= '2023-01-01'  â€¹4â€º
```

**èªªæ˜**:
- **â€¹1â€º** SELECT æ¸…æ™°åˆ—å‡ºæ‰€æœ‰éœ€è¦çš„æ¬„ä½ï¼Œé¿å…ä½¿ç”¨ SELECT *
- **â€¹2â€º** å°‡ timestamp è½‰æ›ç‚º dateï¼Œé©ç”¨æ–¼æ—¥å ±è¡¨
- **â€¹3â€º** ä½¿ç”¨ source() å‡½æ•¸åƒç…§åŸå§‹è¡¨ï¼Œè€Œä¸æ˜¯ç¡¬ç·¨ç¢¼è¡¨å
- **â€¹4â€º** éæ¿¾æ¢ä»¶é™åˆ¶æ•¸æ“šç¯„åœï¼Œæå‡æŸ¥è©¢æ€§èƒ½
```

#### 5. å¼·èª¿ã€Œç‚ºä½•ã€è€Œéåƒ…ã€Œå¦‚ä½•ã€ (Explaining the "Why")

**è¦æ±‚**:
- é™¤äº†å±•ç¤ºä»£ç¢¼ï¼Œå¿…é ˆè§£é‡‹è¨­è¨ˆæ±ºç­–
- è¨è«–æ›¿ä»£æ–¹æ¡ˆå’Œæ¬Šè¡¡
- èªªæ˜æœ€ä½³å¯¦è¸çš„ä¾æ“š

**ç¯„ä¾‹**:

```markdown
### ç‚ºä½•ä½¿ç”¨ source() è€Œä¸æ˜¯ç›´æ¥å¯«è¡¨åï¼Ÿ

ä½ å¯èƒ½æœƒå•ï¼Œç‚ºä½•ä¸ç›´æ¥å¯«ï¼š
```sql
FROM `project.dataset.orders`
```

è€Œè¦ä½¿ç”¨ï¼š
```sql
FROM {{ source('raw', 'orders') }}
```

åŸå› æœ‰ä¸‰ï¼š

1. **å¯ç¶­è­·æ€§**: ç•¶è¡¨åæ”¹è®Šæ™‚ï¼Œåªéœ€æ›´æ–° sources.ymlï¼Œä¸ç”¨ä¿®æ”¹æ‰€æœ‰æ¨¡å‹
2. **æ•¸æ“šè¡€ç·£**: dbt èƒ½è¿½è¹¤æ•¸æ“šä¾†æºï¼Œç”Ÿæˆå®Œæ•´çš„è¡€ç·£åœ–
3. **æ–°é®®åº¦æª¢æŸ¥**: å¯ä»¥ç‚º sources é…ç½®æ–°é®®åº¦æ¸¬è©¦
```

#### 6. è¦ªåˆ‡çš„ç¬¬äºŒäººç¨±èªæ°£ (Conversational & Second-Person Tone)

**è¦æ±‚**:
- ä½¿ç”¨ã€Œä½ ã€ã€ã€Œæˆ‘å€‘ã€
- å°è©±å¼é¢¨æ ¼ï¼Œåƒå°å¸«åœ¨æ—é‚ŠæŒ‡å°
- é¿å…éæ–¼æ­£å¼æˆ–å­¸è¡“åŒ–çš„èªè¨€

**ç¯„ä¾‹**:

âœ… **å¥½çš„èªæ°£**:
```markdown
ç¾åœ¨è®“æˆ‘å€‘è™•ç†ç¬¬ä¸€å€‹çœŸæ­£çš„æŒ‘æˆ°ï¼šClaude Code ç”Ÿæˆçš„ä»£ç¢¼åˆªé™¤äº†
æ‰€æœ‰è¨»è§£ã€‚ä½ å¯èƒ½æœƒæƒ³ï¼Œã€Œè¨»è§£çœŸçš„é‚£éº¼é‡è¦å—ï¼Ÿã€ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œ
ç‰¹åˆ¥æ˜¯åœ¨åœ˜éšŠå”ä½œç’°å¢ƒä¸­ã€‚
```

âŒ **ä¸å¥½çš„èªæ°£**:
```markdown
æœ¬ç¯€å°‡è¨è«–è¨»è§£ä¿ç•™çš„é‡è¦æ€§ã€‚ç ”ç©¶è¡¨æ˜ï¼Œé©ç•¶çš„ä»£ç¢¼æ–‡æª”èƒ½å¤ 
æå‡å¯ç¶­è­·æ€§ã€‚å› æ­¤ï¼Œæ‡‰è©²åœ¨é·ç§»éç¨‹ä¸­ä¿ç•™è¨»è§£ã€‚
```

#### 7. ç« ç¯€ç¸½çµèˆ‡å¾ŒçºŒæ­¥é©Ÿ (Summary & What's Next)

**è¦æ±‚**:
- æ¯ç« çµå°¾æä¾›æ¸…æ™°ç¸½çµ
- å›é¡§æœ¬ç« å®Œæˆçš„æ ¸å¿ƒä»»å‹™èˆ‡å­¸ç¿’æˆæœ
- é å‘Šä¸‹ä¸€ç« å…§å®¹ï¼Œä¿æŒå­¸ç¿’é€£è²«æ€§

**ç¯„ä¾‹**:

```markdown
## æœ¬ç« ç¸½çµ

åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘å€‘å®Œæˆäº†ä»¥ä¸‹ä»»å‹™ï¼š

âœ… **å»ºç«‹äº† Migration Playbook v1.0**ï¼ŒåŒ…å« 6 å€‹æ ¸å¿ƒç« ç¯€
âœ… **æ¸¬è©¦äº†æ‰‹å†Š**ï¼Œç”¨å®ƒæŒ‡å° Claude Code å®Œæˆç¬¬äºŒå€‹ SQL çš„é·ç§»
âœ… **ç™¼ç¾äº†æ”¹é€²é»**ï¼Œè¨˜éŒ„äº†ä»ç„¶å­˜åœ¨çš„å°å•é¡Œ
âœ… **å»ºç«‹äº†è¿­ä»£æ©Ÿåˆ¶**ï¼Œå¾éŒ¯èª¤åˆ°æ‰‹å†Šæ›´æ–°çš„æµç¨‹

### æ ¸å¿ƒæ”¶ç©«

- Migration Playbook æ˜¯çµ¦ AI çš„ã€Œæ•™ç§‘æ›¸ã€
- åˆç‰ˆä¸éœ€è¦å®Œç¾ï¼Œé‡é»æ˜¯å»ºç«‹è¿­ä»£æ©Ÿåˆ¶
- å¾å¯¦éš›éŒ¯èª¤ä¸­æç…‰çŸ¥è­˜æ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•

### ä¸‹ä¸€ç« é å‘Š

åœ¨ç¬¬ 5 ç« ï¼Œæˆ‘å€‘å°‡æ·±å…¥ç¬¬ä¸€ç¨®é·ç§»æ¨¡å¼ï¼š**æ¯æ—¥å®Œå…¨æ›´æ–°è³‡æ–™è¡¨**ã€‚
é€™æ˜¯æœ€å¸¸è¦‹çš„æ¨¡å¼ï¼Œæ¶µè“‹äº†ç´„ 60% çš„é·ç§»æ¡ˆä¾‹ã€‚æˆ‘å€‘å°‡å»ºç«‹å¯é‡ç”¨
çš„ç¯„æœ¬ï¼Œä¸¦è®“ Claude Code ç¨ç«‹è™•ç† 3-5 å€‹é¡ä¼¼æª”æ¡ˆã€‚
```

---

## å¯«ä½œæ ¼å¼è¦ç¯„

### Markdown æ ¼å¼

**å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡**ï¼Œé™¤äº†ï¼š
- ç¨‹å¼ç¢¼
- æŠ€è¡“è¡“èªï¼ˆå¦‚ dbtã€BigQueryã€SQLï¼‰
- å°ˆæœ‰åè©ï¼ˆå¦‚ Claude Codeã€M3ï¼‰

**æ¨™é¡Œå±¤ç´š**:
```markdown
# ç« ç¯€æ¨™é¡Œ (H1 - åƒ…ç”¨æ–¼ç« ç¯€é–‹é ­)
## ä¸»è¦å°ç¯€ (H2)
### æ¬¡è¦å°ç¯€ (H3)
#### ç´°ç¯€èªªæ˜ (H4)
```

**ä»£ç¢¼å€å¡Š**:

å¿…é ˆæŒ‡å®šèªè¨€ï¼š

```markdown
```sql
SELECT * FROM table
```

```python
def validate():
    pass
```

```yaml
version: 2
```

```bash
$ dbt run
```
```

**ç‰¹æ®Šæ¨™è¨˜**:

- ğŸ’¡ **æç¤ºå’Œæœ€ä½³å¯¦è¸**
- âš ï¸ **è­¦å‘Šå’Œå¸¸è¦‹é™·é˜±**
- ğŸ” **æ·±å…¥æŠ€è¡“ç´°ç¯€**
- âœ… **æª¢æŸ¥é»**
- ğŸ“ **å¯¦æˆ°ç·´ç¿’**

### ç”¢å‡ºç‰©å‘ˆç¾æ ¼å¼

**å®Œæ•´çš„ç”¢å‡ºç‰©**ï¼ˆå¦‚å®Œæ•´æª”æ¡ˆï¼‰:

```markdown
### 4.2.1 å®Œæ•´çš„ Migration Playbook v1.0

ä»¥ä¸‹æ˜¯æˆ‘å€‘çš„ç¬¬ä¸€ç‰ˆæ‰‹å†Šï¼š

```markdown
# dbt æ¨¡å‹é·ç§»æ‰‹å†Š v1.0

## 1. ç¢ºèªé·ç§»ä¾†æºçš„ SQL æª”æ¡ˆ
...

## 2. å»ºç«‹åƒç…§å¤–éƒ¨ schema è³‡æ–™è¡¨çš„ sources å®šç¾©
...
```

é€™å€‹åˆç‰ˆæ¶µè“‹äº†...
```

**éƒ¨åˆ†ç”¢å‡ºç‰©**ï¼ˆç‰‡æ®µæˆ–é‡é»ï¼‰:

```markdown
é—œéµçš„é…ç½®æ˜¯ `materialized` è¨­å®šï¼š

```yaml
models:
  - name: daily_sales
    config:
      materialized: table  â€¹1â€º
      partition_by:
        field: date  â€¹2â€º
        data_type: date
```

- **â€¹1â€º** ä½¿ç”¨ table ç‰©åŒ–ç­–ç•¥ï¼Œæ¯æ¬¡é‹è¡Œéƒ½å®Œå…¨é‡å»º
- **â€¹2â€º** æŒ‰æ—¥æœŸåˆ†å€ï¼Œæå‡æŸ¥è©¢æ€§èƒ½
```

### åœ–è¡¨æ ¼å¼

**ä½¿ç”¨ Mermaid.js** ç¹ªè£½æµç¨‹åœ–ã€æ¶æ§‹åœ–ï¼š

```markdown
```mermaid
graph TD
    A[åŸå§‹ SQL] --> B{åˆ†ææ¨¡å¼}
    B --> C[å®Œå…¨æ›´æ–°è¡¨]
    B --> D[åˆ†å€è¡¨]
    B --> E[åˆ†ç‰‡è¡¨]
    C --> F[å»ºç«‹ dbt æ¨¡å‹]
    D --> F
    E --> F
```
```

æˆ–**è©³ç´°æ–‡å­—æè¿°**ï¼ˆç•¶åœ–è¡¨éæ–¼è¤‡é›œæ™‚ï¼‰ï¼š

```markdown
**çŸ¥è­˜è¿­ä»£å¾ªç’°**:

1. Claude Code åŸ·è¡Œé·ç§» â†’
2. ç™¼ç¾éŒ¯èª¤ â†’
3. åˆ†æéŒ¯èª¤æ ¹å›  â†’
4. æç…‰å¯é‡ç”¨çŸ¥è­˜ â†’
5. æ›´æ–° Migration Playbook â†’
6. å›åˆ°æ­¥é©Ÿ 1ï¼ˆä¸‹ä¸€å€‹æª”æ¡ˆï¼‰
```

---

## ç« ç¯€æ’°å¯«æª¢æŸ¥æ¸…å–®

åœ¨å®Œæˆæ¯ç« å‰ï¼Œè«‹æª¢æŸ¥ä»¥ä¸‹é …ç›®ï¼š

### çµæ§‹æª¢æŸ¥

- [ ] ç« ç¯€ä»¥å°ˆæ¡ˆ/æ¡ˆä¾‹é–‹é ­ï¼Œæ˜ç¢ºèªªæ˜å°‡å®Œæˆä»€éº¼ï¼Ÿ
- [ ] å…§å®¹æ˜¯å¦å¾ªåºæ¼¸é€²ï¼ˆå¾ç°¡å–®åˆ°è¤‡é›œï¼‰ï¼Ÿ
- [ ] æ¯å€‹å°ç¯€æ˜¯å¦å®Œæˆä¸€å€‹æ¸…æ™°çš„ä»»å‹™/çŸ¥è­˜é»ï¼Ÿ
- [ ] ç« ç¯€çµå°¾æ˜¯å¦æœ‰ç¸½çµèˆ‡ä¸‹ç« é å‘Šï¼Ÿ

### ç”¢å‡ºç‰©æª¢æŸ¥

- [ ] æœ¬ç« è‡³å°‘æœ‰ 2-3 å€‹æ ¸å¿ƒç”¢å‡ºç‰©ï¼Ÿ
- [ ] ç”¢å‡ºç‰©æ˜¯å¦å®Œæ•´ã€å¯ç”¨ï¼ˆä»£ç¢¼å¯åŸ·è¡Œã€ç¯„æœ¬å¯è¤‡è£½ï¼‰ï¼Ÿ
- [ ] é—œéµç”¢å‡ºç‰©æ˜¯å¦ä½¿ç”¨ â€¹1â€º â€¹2â€º â€¹3â€º æ¨™è¨˜ä¸¦è©³ç´°è§£é‡‹ï¼Ÿ

### å…§å®¹å“è³ªæª¢æŸ¥

- [ ] æ˜¯å¦è§£é‡‹äº†ã€Œç‚ºä½•ã€è€Œéåªæœ‰ã€Œå¦‚ä½•ã€ï¼Ÿ
- [ ] æ˜¯å¦è¨è«–äº†æ›¿ä»£æ–¹æ¡ˆå’Œæ¬Šè¡¡ï¼Ÿ
- [ ] èªæ°£æ˜¯å¦è¦ªåˆ‡ã€å°è©±å¼ï¼ˆä½¿ç”¨ã€Œä½ ã€ã€ã€Œæˆ‘å€‘ã€ï¼‰ï¼Ÿ
- [ ] æ˜¯å¦é¿å…äº†éæ–¼å­¸è¡“æˆ–æ­£å¼çš„èªè¨€ï¼Ÿ

### æŠ€è¡“æº–ç¢ºæ€§æª¢æŸ¥

- [ ] æ‰€æœ‰ SQL èªæ³•æ˜¯å¦æ­£ç¢ºï¼ˆBigQuery èªæ³•ï¼‰ï¼Ÿ
- [ ] æ‰€æœ‰ dbt é…ç½®æ˜¯å¦ç¬¦åˆæœ€ä½³å¯¦è¸ï¼Ÿ
- [ ] ä»£ç¢¼æ˜¯å¦åŒ…å«å®Œæ•´è¨»è§£ï¼Ÿ
- [ ] æ˜¯å¦æ¨™è¨»äº†æª”æ¡ˆè·¯å¾‘ï¼ˆå¦‚ `models/staging/stg_orders.sql`ï¼‰ï¼Ÿ

### Manning æ¨™æº–æª¢æŸ¥

- [ ] æ˜¯å¦ä½¿ç”¨ç¹é«”ä¸­æ–‡ï¼ˆé™¤äº†ä»£ç¢¼å’Œè¡“èªï¼‰ï¼Ÿ
- [ ] ä»£ç¢¼å€å¡Šæ˜¯å¦æŒ‡å®šèªè¨€ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨äº†ç‰¹æ®Šæ¨™è¨˜ï¼ˆğŸ’¡ âš ï¸ ğŸ” âœ… ğŸ“ï¼‰ï¼Ÿ
- [ ] å­—æ•¸æ˜¯å¦ç¬¦åˆé ä¼°ï¼ˆåƒè€ƒ BOOK_STRUCTURE.mdï¼‰ï¼Ÿ

---

## æ ¸å¿ƒæ¡ˆä¾‹èƒŒæ™¯

### M3 å…¬å¸çš„ 50 å€‹ SQL é·ç§»å°ˆæ¡ˆ

**èƒŒæ™¯**:
- **å…¬å¸**: M3 å…¬å¸æ•¸æ“šåŸºç›¤åœ˜éšŠ
- **ä»»å‹™**: å°‡ 50 å€‹ SQL æª”æ¡ˆé·ç§»åˆ° dbt
- **å¹³å°**: Google BigQuery
- **æ™‚é–“**: 2023 å¹´

**é·ç§»å°è±¡çš„è¤‡é›œæ€§**:

1. **å¤šç¨®æ¨¡å¼**:
   - æ¯æ—¥å®Œå…¨æ›´æ–°è³‡æ–™è¡¨ï¼ˆç´„ 30 å€‹ï¼‰
   - åˆ†å€è³‡æ–™è¡¨ï¼ˆç´„ 10 å€‹ï¼‰
   - åˆ†ç‰‡è³‡æ–™è¡¨ï¼ˆç´„ 10 å€‹ï¼‰

2. **æ¯å€‹ SQL çš„ç‰¹é»**:
   - æ¬„ä½éƒ½æœ‰ description
   - éƒ¨åˆ†æ¬„ä½æœ‰ not null é™åˆ¶
   - éƒ¨åˆ†ä½¿ç”¨ UDF (User-Defined Functions)
   - é‚è¼¯è¤‡é›œåº¦ä¸ä¸€

**é·ç§»æŒ‘æˆ°**:
- æ‰‹å‹•è™•ç†è€—æ™‚ï¼ˆæ¯å€‹æª”æ¡ˆ 20-30 åˆ†é˜ï¼‰
- å®¹æ˜“å‡ºéŒ¯ï¼ˆè¨»è§£éºå¤±ã€é‚è¼¯æ”¹è®Šã€ç´„æŸéºæ¼ï¼‰
- é‡è¤‡æ€§é«˜ï¼ˆè¨±å¤šç›¸ä¼¼æ¨¡å¼ï¼‰
- è‚Œè…±ç‚é¢¨éšªï¼ˆé–‹ç™¼è€…è‡ªå˜²ï¼‰

### é—œéµæ™‚é–“ç·š

**ç¬¬ä¸€éšæ®µï¼šåˆæ¬¡å˜—è©¦ï¼ˆå¤±æ•—ï¼‰**
- ç°¡å–®è«‹æ±‚ï¼šã€Œè«‹å°‡ xxx.sql è½‰æ›ç‚º dbtã€
- å¿«é€Ÿç”Ÿæˆï¼Œä½†å•é¡Œå¤š
- é€ä¸€ä¿®æ­£ï¼Œæ•ˆç‡ä½

**ç¬¬äºŒéšæ®µï¼šå»ºç«‹æ‰‹å†Šï¼ˆè½‰æŠ˜é»ï¼‰**
- è«‹æ±‚ Claude Code è£½ä½œæ‰‹å†Š
- ç”Ÿæˆåˆç‰ˆæ‰‹å†Šï¼ˆ6 å€‹ç« ç¯€ï¼‰
- é–‹å§‹ç³»çµ±åŒ–å”ä½œ

**ç¬¬ä¸‰éšæ®µï¼šè¿­ä»£æ”¹é€²ï¼ˆæˆé•·ï¼‰**
- å¾ç¬¬äºŒå€‹æª”æ¡ˆé–‹å§‹ä½¿ç”¨æ‰‹å†Š
- é‡åˆ°éŒ¯èª¤å°±æ›´æ–°æ‰‹å†Š
- æ‰‹å†Šå¾ 6 ç¯€æˆé•·åˆ° 13 ç¯€

**ç¬¬å››éšæ®µï¼šç¨ç«‹ä½œæ¥­ï¼ˆæˆåŠŸï¼‰**
- Claude Code èƒ½ä¸€æ¬¡ç”¢å‡ºæ­£ç¢ºä»£ç¢¼
- é·ç§»æ™‚é–“å¾ 20-30 åˆ†é˜é™åˆ°å¹¾åˆ†é˜
- è¶…éåŠæ•¸æª”æ¡ˆç”± Claude Code è™•ç†

**ç¬¬äº”éšæ®µï¼šæ“´å±•é©—è­‰ï¼ˆé€²éšï¼‰**
- å°‡é©—è­‰æµç¨‹åŠ å…¥æ‰‹å†Š
- Claude Code èƒ½è‡ªä¸»éƒ¨ç½²åˆ° QA ä¸¦é©—è­‰
- å¯¦ç¾é«˜åº¦è‡ªå‹•åŒ–

### Migration Playbook æ¼”é€²

**v1.0ï¼ˆåˆç‰ˆ - 6 ç¯€ï¼‰**:
```markdown
1. ç¢ºèªé·ç§»ä¾†æºçš„ SQL æª”æ¡ˆ
2. å»ºç«‹åƒç…§å¤–éƒ¨ schema è³‡æ–™è¡¨çš„ sources å®šç¾©
3. å»ºç«‹ dbt æ¨¡å‹çš„ SQL æª”æ¡ˆï¼ˆæ¯æ—¥å®Œå…¨æ›´æ–°è³‡æ–™è¡¨ç‰ˆï¼‰
4. å»ºç«‹æ¨¡å‹æª”æ¡ˆæ™‚çš„æ³¨æ„äº‹é …
5. å»ºç«‹ dbt æ¨¡å‹çš„ schema æª”æ¡ˆ
6. æ•´é«”å…±é€šæ³¨æ„äº‹é …
```

**v3.0ï¼ˆæœ€çµ‚ç‰ˆ - 13 ç¯€ï¼‰**:
```markdown
1. ç¢ºèªé·ç§»ä¾†æºçš„ SQL æª”æ¡ˆ
2. å»ºç«‹åƒç…§å¤–éƒ¨ schema è³‡æ–™è¡¨çš„ sources å®šç¾©
3. sources å®šç¾©éºæ¼æª¢æŸ¥  â† æ–°å¢
4. æ–°å¢ sources å®šç¾©æ™‚çš„æ³¨æ„äº‹é …ãƒ»ç–‘é›£æ’è§£æ–¹æ³•  â† æ–°å¢
5-a. å»ºç«‹ dbt æ¨¡å‹çš„ SQL æª”æ¡ˆï¼ˆæ¯æ—¥å®Œå…¨æ›´æ–°è³‡æ–™è¡¨ç‰ˆï¼‰
5-b. å»ºç«‹ dbt æ¨¡å‹çš„ SQL æª”æ¡ˆï¼ˆåˆ†å€è³‡æ–™è¡¨ç‰ˆï¼‰  â† æ–°å¢
5-c. å»ºç«‹ dbt æ¨¡å‹çš„ SQL æª”æ¡ˆï¼ˆåˆ†ç‰‡è³‡æ–™è¡¨ç‰ˆï¼‰  â† æ–°å¢
6. å»ºç«‹æ¨¡å‹æª”æ¡ˆæ™‚çš„æ³¨æ„äº‹é …
7. å»ºç«‹ dbt æ¨¡å‹çš„ schema æª”æ¡ˆ
8. æ›´æ–° dbt åŸ·è¡Œç’°å¢ƒï¼ˆå¿…è¦æ™‚ï¼‰  â† æ–°å¢
9. è‡ªæˆ‘å¯©æŸ¥  â† æ–°å¢
10. éƒ¨ç½²åˆ° QA ç’°å¢ƒ  â† æ–°å¢
11. é€²è¡Œå‹•ä½œé©—è­‰  â† æ–°å¢
12. å‹•ä½œé©—è­‰æ™‚çš„æ³¨æ„äº‹é …ãƒ»ç–‘é›£æ’è§£æ–¹æ³•  â† æ–°å¢
13. æ•´é«”å…±é€šæ³¨æ„äº‹é …
```

### é—œéµå­¸ç¿’

**å¾å¤±æ•—ä¸­å­¸åˆ°çš„æ•™è¨“**:

1. **è¨»è§£è¢«åˆªé™¤** â†’ æ‰‹å†ŠåŠ å…¥ã€Œå¿…é ˆä¿ç•™æ‰€æœ‰åŸå§‹è¨»è§£ã€
2. **é‚è¼¯è¢«æ”¹å¯«** â†’ æ‰‹å†ŠåŠ å…¥ã€Œä¸è¦æ”¹è®Š SQL é‚è¼¯ï¼Œåªåšæ ¼å¼è½‰æ›ã€
3. **OUTER JOIN è®Š INNER JOIN** â†’ æ‰‹å†ŠåŠ å…¥ã€ŒJOIN é¡å‹æª¢æŸ¥ã€
4. **ref() vs source() æ··ç”¨** â†’ æ‰‹å†ŠåŠ å…¥æ˜ç¢ºä½¿ç”¨è¦å‰‡
5. **sources å®šç¾©éºæ¼** â†’ æ‰‹å†ŠåŠ å…¥æª¢æŸ¥æ¸…å–®å’Œç–‘é›£æ’è§£

**è‡ªæˆ‘å¯©æŸ¥çš„é‡è¦æ€§**:
- Claude Code æœ‰æ™‚æœƒã€Œç–å¿½ã€æ‰‹å†Šä¸­çš„æ³¨æ„äº‹é …
- åŠ å…¥è‡ªæˆ‘å¯©æŸ¥ç« ç¯€å¾Œï¼Œèƒ½åœ¨å®Œæˆå‰ç™¼ç¾ä¸¦ä¿®æ­£éŒ¯èª¤
- é¡¯è‘—æå‡ä¸€æ¬¡æˆåŠŸç‡

**æœªè§£æ±ºçš„æŒ‘æˆ°**:
- ç•¶é©—è­‰ç™¼ç¾å·®ç•°æ™‚ï¼ŒåŸå› åˆ†æé‚„ä¸å¤ ç©©å®š
- é€™éƒ¨åˆ†ä»éœ€äººå·¥ä»‹å…¥

---

## ç‰¹å®šç« ç¯€æŒ‡å¼•

### ç¬¬ 1 ç« æ³¨æ„äº‹é …

- å¿…é ˆå¸å¼•è®€è€…ï¼Œè®“ä»–å€‘äº†è§£é€™æœ¬æ›¸çš„ç¨ç‰¹åƒ¹å€¼
- ä½¿ç”¨ M3 æ¡ˆä¾‹ä½œç‚ºå¼•å­
- å¼·èª¿ã€ŒçŸ¥è­˜æ¼”é€²ã€çš„æ¦‚å¿µ
- é¿å…éåº¦æŠ€è¡“ç´°ç¯€ï¼ˆç•™åˆ°å¾Œé¢ç« ç¯€ï¼‰

### ç¬¬ 3 ç« æ³¨æ„äº‹é …

- é€™ç« è¦è©³ç´°è¨˜éŒ„ã€Œç¬¬ä¸€æ¬¡å¤±æ•—ã€
- ä¸è¦ç¾åŒ–çµæœï¼Œè¦çœŸå¯¦å‘ˆç¾å•é¡Œ
- è©³ç´°èªªæ˜æ¯å€‹ç™¼ç¾çš„å•é¡Œ
- é€™æ˜¯å¾ŒçºŒå»ºç«‹æ‰‹å†Šçš„å‹•æ©Ÿ

### ç¬¬ 4 ç« æ³¨æ„äº‹é …

- é€™æ˜¯æ ¸å¿ƒç« ç¯€ä¹‹ä¸€
- å¿…é ˆå®Œæ•´å‘ˆç¾ Migration Playbook v1.0
- è§£é‡‹æ‰‹å†Šè¨­è¨ˆçš„æ€è·¯
- å±•ç¤ºæ¸¬è©¦çµæœèˆ‡æ”¹é€²æ–¹å‘

### ç¬¬ 9 ç« æ³¨æ„äº‹é …

- å±•ç¤ºå…·é«”çš„éŒ¯èª¤æ¡ˆä¾‹ï¼ˆè‡³å°‘ 10 å€‹ï¼‰
- é‡åŒ– AI æˆé•·ï¼ˆéŒ¯èª¤ç‡æ›²ç·šã€æ™‚é–“ç¸®çŸ­ï¼‰
- å°æ¯” v1.0 å’Œ v3.0 çš„å…§å®¹è®ŠåŒ–
- é€™ç« å±•ç¤ºã€ŒçŸ¥è­˜æ¼”é€²ã€çš„æ ¸å¿ƒåƒ¹å€¼

### ç¬¬ 12 ç« æ³¨æ„äº‹é …

- æä¾›å®Œæ•´å¯åŸ·è¡Œçš„é©—è­‰è…³æœ¬
- è§£é‡‹ç‚ºä½•éœ€è¦å¤šå±¤æ¬¡é©—è­‰ï¼ˆèªæ³•ã€çµæ§‹ã€æ•¸æ“šï¼‰
- å±•ç¤º Claude Code å¦‚ä½•è‡ªä¸»åŸ·è¡Œé©—è­‰

### é™„éŒ„ A æ³¨æ„äº‹é …

- æä¾›æœ€çµ‚ç‰ˆ Playbook çš„å®Œæ•´å…§å®¹ï¼ˆv3.0ï¼‰
- å¯ä»¥ç›´æ¥è¤‡è£½ä½¿ç”¨çš„æ ¼å¼
- åŠ å…¥è©³ç´°è¨»è§£èªªæ˜æ¯å€‹ç« ç¯€çš„ç›®çš„

---

## ä»£ç¢¼ç¯„ä¾‹è¦æ±‚

### åŸå‰‡

1. **æ‰€æœ‰ä»£ç¢¼å¿…é ˆå¯åŸ·è¡Œ**
2. **åŒ…å«å®Œæ•´è¨»è§£**
3. **éµå¾ªæœ€ä½³å¯¦è¸**
4. **æä¾›æª”æ¡ˆè·¯å¾‘**

### SQL ä»£ç¢¼

```sql
-- models/staging/stg_orders.sql
-- è¨‚å–®è³‡æ–™æš«å­˜è¡¨
-- å¾åŸå§‹è¨‚å–®è¡¨æå–ä¸¦æ¸…ç†æ•¸æ“š

SELECT
    order_id,
    user_id,
    DATE(order_timestamp) as order_date,
    amount,
    status
FROM {{ source('raw', 'orders') }}
WHERE
    order_timestamp >= '2023-01-01'
    AND status IS NOT NULL
```

### dbt Schema YAML

```yaml
# models/staging/schema.yml
version: 2

sources:
  - name: raw
    description: åŸå§‹æ•¸æ“šä¾†æº
    database: project-id
    schema: raw_data
    tables:
      - name: orders
        description: åŸå§‹è¨‚å–®è¡¨

models:
  - name: stg_orders
    description: è¨‚å–®è³‡æ–™æš«å­˜è¡¨
    columns:
      - name: order_id
        description: è¨‚å–®å”¯ä¸€è­˜åˆ¥ç¢¼
        tests:
          - unique
          - not_null
      - name: user_id
        description: ç”¨æˆ¶ID
        tests:
          - not_null
      - name: order_date
        description: è¨‚å–®æ—¥æœŸ
      - name: amount
        description: è¨‚å–®é‡‘é¡
      - name: status
        description: è¨‚å–®ç‹€æ…‹
```

### Python é©—è­‰è…³æœ¬

```python
# validation/schema_validator.py
"""
Schema ä¸€è‡´æ€§é©—è­‰å·¥å…·
æ¯”å°åŸå§‹è¡¨å’Œ dbt æ¨¡å‹çš„ schema æ˜¯å¦ä¸€è‡´
"""

from google.cloud import bigquery

def validate_schema(original_table, dbt_model):
    """
    é©—è­‰å…©å€‹è¡¨çš„ schema æ˜¯å¦ä¸€è‡´

    Args:
        original_table: åŸå§‹è¡¨å…¨å (project.dataset.table)
        dbt_model: dbt æ¨¡å‹å…¨å

    Returns:
        bool: schema æ˜¯å¦ä¸€è‡´
    """
    client = bigquery.Client()

    # å–å¾—å…©å€‹è¡¨çš„ schema
    original_schema = client.get_table(original_table).schema
    model_schema = client.get_table(dbt_model).schema

    # æ¯”å°æ¬„ä½
    original_fields = {field.name: field.field_type for field in original_schema}
    model_fields = {field.name: field.field_type for field in model_schema}

    # æª¢æŸ¥å·®ç•°
    if original_fields != model_fields:
        print("Schema ä¸ä¸€è‡´ï¼")
        print(f"åŸå§‹è¡¨ç¨æœ‰: {set(original_fields) - set(model_fields)}")
        print(f"æ¨¡å‹ç¨æœ‰: {set(model_fields) - set(original_fields)}")
        return False

    print("âœ… Schema ä¸€è‡´")
    return True
```

---

## ç•¶å‰ä»»å‹™ä¸Šä¸‹æ–‡

### å·²å®Œæˆ
- âœ… æ›¸ç±æ¶æ§‹è¨­è¨ˆ
- âœ… README.md
- âœ… BOOK_STRUCTURE.md
- âœ… ACTION_PLAN.md
- âœ… front-matter.md
- âœ… CLAUDE.mdï¼ˆæœ¬æ–‡ä»¶ï¼‰

### é€²è¡Œä¸­
- ğŸ”„ æ’°å¯«ç« ç¯€å…§å®¹

### ä¸‹ä¸€æ­¥
æ ¹æ“š ACTION_PLAN.md ä¸­çš„æ™‚ç¨‹ï¼ŒæŒ‰é †åºæ’°å¯«ç¬¬ 1-14 ç« åŠé™„éŒ„ã€‚

---

## èˆ‡ä½œè€…å”ä½œ

### æå•æ©Ÿåˆ¶

å¦‚æœé‡åˆ°ä»¥ä¸‹æƒ…æ³ï¼Œè«‹è©¢å•ä½œè€…ï¼š

1. **æŠ€è¡“ç´°ç¯€ä¸ç¢ºå®š**: å¦‚ BigQuery ç‰¹å®šåŠŸèƒ½çš„ç´°ç¯€
2. **æ¡ˆä¾‹ç´°ç¯€ä¸è¶³**: éœ€è¦æ›´å¤š M3 æ¡ˆä¾‹çš„å…·é«”ä¿¡æ¯
3. **é¢¨æ ¼åˆ¤æ–·**: ä¸ç¢ºå®šæŸç¨®å‘ˆç¾æ–¹å¼æ˜¯å¦ç¬¦åˆ Manning æ¨™æº–
4. **ç¯„åœèª¿æ•´**: æŸç« å…§å®¹éå¤šæˆ–éå°‘

### ä¸éœ€è¦è©¢å•çš„æƒ…æ³

ä»¥ä¸‹æƒ…æ³å¯ä»¥è‡ªä¸»åˆ¤æ–·ï¼š

1. **æ ¼å¼èª¿æ•´**: æ ¹æ“šæœ¬æ–‡ä»¶çš„æ ¼å¼è¦ç¯„
2. **èªæ°£å„ªåŒ–**: æ”¹ç‚ºæ›´å°è©±å¼çš„èªè¨€
3. **çµæ§‹é‡çµ„**: èª¿æ•´å°ç¯€é †åºä»¥æ›´ç¬¦åˆæ¼¸é€²å¼å­¸ç¿’
4. **è£œå……ç¯„ä¾‹**: å¢åŠ ä»£ç¢¼ç¯„ä¾‹æˆ–åœ–è¡¨

---

## æœ€å¾Œæé†’

### å“è³ªç¬¬ä¸€

å¯§é¡˜èŠ±æ›´å¤šæ™‚é–“ç”¢å‡ºé«˜å“è³ªå…§å®¹ï¼Œä¹Ÿä¸è¦ç‚ºäº†é€Ÿåº¦çŠ§ç‰²å“è³ªã€‚

### è®€è€…è¦–è§’

å§‹çµ‚å¾è®€è€…è§’åº¦æ€è€ƒï¼š
- é€™å€‹æ¦‚å¿µç¬¬ä¸€æ¬¡æ¥è§¸çš„äººèƒ½ç†è§£å—ï¼Ÿ
- é€™å€‹ä»£ç¢¼ç¯„ä¾‹èƒ½ç›´æ¥é‹è¡Œå—ï¼Ÿ
- é€™å€‹æ­¥é©Ÿæ˜¯å¦æ¼æ‰äº†ä»€éº¼ï¼Ÿ

### Manning æ¨™æº–

åš´æ ¼éµå®ˆ Manning "in Action" çš„é¢¨æ ¼è¦æ±‚ã€‚é€™æ˜¯æœ¬æ›¸çš„æ ¸å¿ƒåƒ¹å€¼ä¹‹ä¸€ã€‚

---

**æº–å‚™å¥½äº†å—ï¼Ÿè®“æˆ‘å€‘é–‹å§‹æ’°å¯«é€™æœ¬æ›¸å§ï¼**

---

*æœ€å¾Œæ›´æ–°: 2025-01*
*ç‰ˆæœ¬: 1.0*
