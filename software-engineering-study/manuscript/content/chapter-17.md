# 第17章　軟體品質保證

> 「品質保證不是在最後關卡把關，而是在整個過程中持續建構品質。」

---

## 17.1 什麼是軟體品質保證？

### 17.1.1 SQA 的定義

**軟體品質保證（Software Quality Assurance, SQA）**：確保軟體開發流程和工作產品符合品質標準的系統化活動。

SQA vs. 相關概念：

| 概念 | 定義 | 焦點 |
|------|------|------|
| **QA（品質保證）** | 預防問題 | 流程 |
| **QC（品質控制）** | 偵測問題 | 產品 |
| **Testing（測試）** | 驗證功能 | 產品的一部分 |

```
┌──────────────────────────────────────────────────────────────┐
│                    品質管理                                   │
│                                                              │
│  ┌─────────────────────┐   ┌─────────────────────────────┐  │
│  │   品質保證（QA）     │   │      品質控制（QC）          │  │
│  │                     │   │                             │  │
│  │  • 流程定義          │   │  • 測試                     │  │
│  │  • 標準制定          │   │  • 審查                     │  │
│  │  • 稽核              │   │  • 檢查                     │  │
│  │  • 培訓              │   │  • 驗證                     │  │
│  │                     │   │                             │  │
│  │   預防導向           │   │   偵測導向                   │  │
│  └─────────────────────┘   └─────────────────────────────┘  │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

### 17.1.2 SQA 的目標

| 目標 | 說明 |
|------|------|
| **流程符合** | 確保團隊遵循定義的流程 |
| **標準遵守** | 確保產品符合編碼標準 |
| **問題預防** | 在問題發生前預防 |
| **持續改善** | 從問題中學習改進 |

### 17.1.3 SQA 的活動

| 活動 | 說明 |
|------|------|
| **流程定義** | 定義開發流程和標準 |
| **流程稽核** | 檢查流程是否被遵循 |
| **產品審查** | 審查工作產品 |
| **問題追蹤** | 追蹤和分析問題 |
| **度量收集** | 收集品質指標 |
| **培訓** | 培訓團隊品質意識 |

---

## 17.2 SQA 流程

### 17.2.1 SQA 活動流程

```
┌─────────────────────────────────────────────────────────────────┐
│                        SQA 持續循環                              │
│                                                                 │
│    ┌────────┐    ┌────────┐    ┌────────┐    ┌────────┐        │
│    │  規劃  │───►│  執行  │───►│  檢查  │───►│  改善  │        │
│    │ (Plan) │    │  (Do)  │    │(Check) │    │ (Act)  │        │
│    └───┬────┘    └────────┘    └────────┘    └───┬────┘        │
│        │                                          │             │
│        └──────────────────────────────────────────┘             │
│                         持續循環                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 17.2.2 規劃階段（Plan）

| 活動 | 內容 |
|------|------|
| **品質目標** | 定義品質目標和指標 |
| **流程選擇** | 選擇適合的開發流程 |
| **標準制定** | 制定編碼和文件標準 |
| **工具選擇** | 選擇 QA 工具 |
| **人員培訓** | 規劃培訓計畫 |

### 17.2.3 執行階段（Do）

| 活動 | 內容 |
|------|------|
| **流程遵循** | 團隊按流程開發 |
| **標準遵守** | 按標準編碼和文件 |
| **審查執行** | 執行程式碼審查 |
| **測試執行** | 執行各層級測試 |
| **問題記錄** | 記錄發現的問題 |

### 17.2.4 檢查階段（Check）

| 活動 | 內容 |
|------|------|
| **流程稽核** | 稽核流程遵循情況 |
| **度量分析** | 分析品質指標 |
| **問題分析** | 分析問題根因 |
| **趨勢識別** | 識別品質趨勢 |

### 17.2.5 改善階段（Act）

| 活動 | 內容 |
|------|------|
| **改善行動** | 採取改善措施 |
| **流程更新** | 更新流程和標準 |
| **經驗學習** | 分享經驗教訓 |
| **預防措施** | 建立預防機制 |

---

## 17.3 SQA 技術

### 17.3.1 靜態分析

**靜態分析**：不執行程式碼，分析源碼的技術。

| 類型 | 說明 | 工具範例 |
|------|------|----------|
| **程式碼風格** | 檢查編碼標準 | ESLint, Pylint |
| **潛在錯誤** | 發現潛在 bug | SonarQube, FindBugs |
| **安全漏洞** | 發現安全問題 | Checkmarx, Fortify |
| **複雜度** | 測量程式碼複雜度 | SonarQube |
| **重複** | 發現重複程式碼 | CPD, Simian |

**靜態分析流程**：

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│ 程式碼   │───►│ 靜態分析 │───►│  問題    │───►│  修正    │
│ 提交     │    │   工具   │    │  報告    │    │         │
└──────────┘    └──────────┘    └──────────┘    └──────────┘
```

### 17.3.2 動態分析

**動態分析**：執行程式碼，觀察行為的技術。

| 類型 | 說明 | 工具範例 |
|------|------|----------|
| **單元測試** | 測試個別單元 | JUnit, pytest |
| **整合測試** | 測試整合 | TestNG |
| **覆蓋率** | 測量測試覆蓋 | JaCoCo, Istanbul |
| **效能分析** | 分析效能瓶頸 | JProfiler, Py-Spy |
| **記憶體分析** | 分析記憶體使用 | Valgrind |

### 17.3.3 持續整合/持續部署（CI/CD）

```
┌──────────────────────────────────────────────────────────────────┐
│                         CI/CD Pipeline                           │
│                                                                  │
│  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐    │
│  │ Commit │─►│ Build  │─►│ Test   │─►│ Deploy │─►│Monitor │    │
│  │        │  │        │  │        │  │        │  │        │    │
│  └────────┘  └────────┘  └────────┘  └────────┘  └────────┘    │
│                                                                  │
│       │           │           │           │           │          │
│       ▼           ▼           ▼           ▼           ▼          │
│   ┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐        │
│   │Lint  │   │Unit  │   │E2E   │   │Smoke │   │Alert │        │
│   │      │   │Test  │   │Test  │   │Test  │   │      │        │
│   └──────┘   └──────┘   └──────┘   └──────┘   └──────┘        │
└──────────────────────────────────────────────────────────────────┘
```

**CI/CD 品質關卡**：

| 階段 | 品質關卡 |
|------|----------|
| Commit | Lint 檢查、Pre-commit hooks |
| Build | 編譯成功、靜態分析 |
| Test | 單元測試、覆蓋率門檻 |
| Deploy | 整合測試、安全掃描 |
| Monitor | 錯誤率、效能指標 |

---

## 17.4 SQA 標準與模型

### 17.4.1 ISO 9001

**ISO 9001**：品質管理系統標準。

| 原則 | 說明 |
|------|------|
| 客戶焦點 | 以客戶需求為中心 |
| 領導 | 管理層承諾 |
| 人員參與 | 全員參與品質 |
| 流程方法 | 流程化管理 |
| 改善 | 持續改善 |
| 決策 | 基於證據的決策 |
| 關係管理 | 供應商關係 |

### 17.4.2 CMMI

**CMMI（Capability Maturity Model Integration）**：流程成熟度模型。

| 等級 | 名稱 | 特徵 |
|------|------|------|
| 1 | 初始級 | 無流程，靠英雄 |
| 2 | 管理級 | 專案級流程 |
| 3 | 已定義級 | 組織級流程 |
| 4 | 量化管理級 | 量化管理 |
| 5 | 優化級 | 持續改善 |

```
┌─────────────────────────────────────────┐
│              Level 5                     │
│           持續優化                        │
├─────────────────────────────────────────┤
│              Level 4                     │
│           量化管理                        │
├─────────────────────────────────────────┤
│              Level 3                     │
│           已定義流程                      │
├─────────────────────────────────────────┤
│              Level 2                     │
│           專案管理                        │
├─────────────────────────────────────────┤
│              Level 1                     │
│           初始/英雄主義                   │
└─────────────────────────────────────────┘
```

### 17.4.3 敏捷中的 SQA

在敏捷環境中，SQA 如何實踐？

| 傳統 SQA | 敏捷 SQA |
|----------|----------|
| 專門 QA 團隊 | 全團隊負責品質 |
| 階段性稽核 | 持續檢查 |
| 大量文件 | 剛好夠用的文件 |
| 正式審查 | 結對程式設計、PR |
| 最後測試 | 持續測試 |

**敏捷 SQA 實踐**：

| 實踐 | 說明 |
|------|------|
| **TDD** | 測試驅動開發 |
| **CI/CD** | 持續整合部署 |
| **結對程式設計** | 即時審查 |
| **Sprint Review** | 持續回饋 |
| **Retrospective** | 持續改善 |

---

## 17.5 問題管理

### 17.5.1 問題追蹤流程

```
┌────────────────────────────────────────────────────────────┐
│                     問題生命週期                            │
│                                                            │
│  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐          │
│  │  新建  │─►│  分派  │─►│ 處理中 │─►│  解決  │          │
│  │  New   │  │Assigned│  │  Open  │  │Resolved│          │
│  └────────┘  └────────┘  └────────┘  └───┬────┘          │
│                                          │                │
│                              ┌───────────┴───────────┐    │
│                              ▼                       ▼    │
│                        ┌────────┐              ┌────────┐ │
│                        │  關閉  │              │ 重開   │ │
│                        │ Closed │              │Reopened│ │
│                        └────────┘              └────────┘ │
└────────────────────────────────────────────────────────────┘
```

### 17.5.2 問題分類

| 分類維度 | 選項 |
|----------|------|
| **嚴重度** | Critical, Major, Minor, Trivial |
| **優先級** | High, Medium, Low |
| **類型** | Bug, Feature, Task, Improvement |
| **來源** | 開發、測試、生產、客戶 |

### 17.5.3 根因分析

**5 Why 分析法**：

```
問題：上線後發現嚴重 bug

為什麼？→ 測試沒有覆蓋這個情境
為什麼？→ 測試案例沒有考慮這個邊界情況
為什麼？→ 需求規格沒有提到這個情況
為什麼？→ 需求討論時沒有問清楚
為什麼？→ 沒有需求審查的流程

根因：需求審查流程缺失
對策：建立需求審查 Checklist
```

**魚骨圖（Ishikawa Diagram）**：

```
        人員              流程              工具
         │                │                │
    ─────┼────────────────┼────────────────┼─────
         │                │                │
         └────────────────┼────────────────┘
                          │
                          ▼
                      ┌──────┐
                      │ 問題 │
                      └──────┘
                          │
         ┌────────────────┼────────────────┐
         │                │                │
    ─────┼────────────────┼────────────────┼─────
         │                │                │
        環境              方法              度量
```

---

## 17.6 SQA 度量

### 17.6.1 流程度量

| 度量 | 定義 | 目標 |
|------|------|------|
| **流程遵循率** | 遵循流程的比例 | > 90% |
| **審查覆蓋率** | 審查過的程式碼比例 | > 80% |
| **缺陷發現效率** | 發布前發現的缺陷比例 | > 90% |
| **流程週期時間** | 完成流程的時間 | 持續縮短 |

### 17.6.2 產品度量

| 度量 | 定義 | 目標 |
|------|------|------|
| **缺陷密度** | 缺陷數 / KLOC | < 1 |
| **測試覆蓋率** | 被測試覆蓋的程式碼比例 | > 80% |
| **技術債比率** | 技術債 / 開發時間 | < 5% |
| **程式碼複雜度** | Cyclomatic Complexity 平均 | < 10 |

### 17.6.3 度量儀表板

```
┌──────────────────────────────────────────────────────────────┐
│                    SQA Dashboard                             │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  缺陷趨勢            測試覆蓋率          程式碼品質          │
│  ┌─────────┐        ┌─────────┐        ┌─────────┐         │
│  │ ╲       │        │    87%  │        │  A      │         │
│  │  ╲      │        │ ████████│        │ ████████│         │
│  │   ╲     │        │         │        │         │         │
│  │    ─────│        │         │        │         │         │
│  └─────────┘        └─────────┘        └─────────┘         │
│   ↓ 減少中           ↑ 持續提升          ✓ 良好             │
│                                                              │
│  ─────────────────────────────────────────────────────────  │
│                                                              │
│  Open Issues: 23    Blocked: 2    Critical: 0               │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

---

## 17.7 建立 SQA 計畫

### 17.7.1 SQA 計畫內容

| 章節 | 內容 |
|------|------|
| **目的** | SQA 計畫的目的和範圍 |
| **參考** | 引用的標準和文件 |
| **組織** | SQA 組織結構和職責 |
| **任務** | SQA 活動清單 |
| **標準** | 適用的標準和流程 |
| **審查** | 審查計畫 |
| **測試** | 測試計畫概述 |
| **問題報告** | 問題報告和處理流程 |
| **工具** | SQA 工具清單 |
| **培訓** | 培訓計畫 |
| **風險** | SQA 相關風險 |

### 17.7.2 SQA 計畫範例

```markdown
# SQA 計畫

## 1. 目的
確保 [專案名稱] 的開發流程和工作產品符合品質標準。

## 2. 品質目標
| 目標 | 度量 | 目標值 |
|------|------|--------|
| 缺陷密度 | Bugs/KLOC | < 1 |
| 測試覆蓋率 | Coverage % | > 80% |
| 審查覆蓋率 | Reviewed % | 100% |
| 上線後缺陷 | Post-release bugs | < 5/month |

## 3. SQA 活動
| 活動 | 頻率 | 負責人 |
|------|------|--------|
| 程式碼審查 | 每個 PR | 開發團隊 |
| 靜態分析 | 每次 commit | 自動化 |
| 單元測試 | 每次 commit | 自動化 |
| 整合測試 | 每日 | 自動化 |
| 流程稽核 | 每月 | SQA |

## 4. 工具
| 類型 | 工具 |
|------|------|
| CI/CD | GitHub Actions |
| 靜態分析 | SonarQube |
| 測試 | pytest, Cypress |
| 問題追蹤 | Jira |
| 度量 | Grafana |
```

---

## 17.8 本章總結

### 核心概念

| 概念 | 一句話解釋 |
|------|-----------|
| SQA | 確保流程和產品符合品質標準 |
| QA vs QC | QA 預防問題，QC 偵測問題 |
| PDCA | 規劃-執行-檢查-改善循環 |
| 靜態分析 | 不執行程式碼的分析 |
| 根因分析 | 找出問題的真正原因 |

### SQA 活動 Checklist

| 活動 | 問題 |
|------|------|
| 流程定義 | 有清楚的開發流程嗎？ |
| 標準制定 | 有編碼和文件標準嗎？ |
| 審查執行 | 有程式碼審查嗎？ |
| 測試自動化 | 有自動化測試嗎？ |
| 問題追蹤 | 有問題追蹤系統嗎？ |
| 度量收集 | 有品質指標嗎？ |
| 持續改善 | 有定期回顧改善嗎？ |

### 下一章預告

品質保證需要考慮安全性。下一章我們將學習「軟體安全工程」——如何在工程流程中內建安全。

---

## 延伸思考

1. 你的團隊有 SQA 計畫嗎？有多少活動是自動化的？

2. 你如何平衡 SQA 的投入和開發速度？

3. 在敏捷環境中，如何保持 SQA 的有效性？

---

*下一章：第18章　軟體安全工程*
