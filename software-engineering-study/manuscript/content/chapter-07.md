# 第7章　需求工程

> 「需求工程不是『記錄使用者說的話』，而是『發現使用者真正需要什麼』。」

---

## 7.1 需求：軟體成敗的根源

### 7.1.1 需求問題的代價

根據多項研究，軟體專案失敗的前三大原因：

| 排名 | 原因 | 類型 |
|------|------|------|
| 1 | 需求不完整或持續變更 | 需求 |
| 2 | 缺乏使用者參與 | 需求 |
| 3 | 不切實際的期望 | 需求/溝通 |

**觀察**：前三名都和需求直接相關。

### 7.1.2 需求問題的成本

需求階段的錯誤，修復成本隨時間指數增長：

| 發現階段 | 相對成本 |
|----------|----------|
| 需求階段 | 1x |
| 設計階段 | 3-6x |
| 編碼階段 | 10x |
| 測試階段 | 15-40x |
| 上線後 | 30-200x |

**結論**：投資在需求階段的時間，是最划算的投資。

### 7.1.3 什麼是需求？

**需求**（Requirement）：對系統必須具備的功能或特性的陳述。

需求有多個層次：

```
┌─────────────────────────────────────┐
│        業務需求（Business）          │
│   「為什麼要這個系統？」              │
├─────────────────────────────────────┤
│        使用者需求（User）            │
│   「使用者要完成什麼任務？」          │
├─────────────────────────────────────┤
│        系統需求（System）            │
│   「系統要提供什麼功能和限制？」      │
└─────────────────────────────────────┘
```

| 層次 | 關注點 | 利害關係人 | 例子 |
|------|--------|-----------|------|
| 業務需求 | 目標、價值 | 高階主管、投資人 | 「提高客服效率 30%」 |
| 使用者需求 | 任務、場景 | 終端使用者 | 「客服人員可以搜尋歷史對話」 |
| 系統需求 | 功能、限制 | 開發團隊 | 「搜尋結果在 2 秒內返回」 |

---

## 7.2 需求的類型

### 7.2.1 功能需求 vs. 非功能需求

**功能需求（Functional Requirements）**：系統應該做什麼。

> 「當使用者點擊『送出訂單』，系統應該建立訂單並發送確認郵件。」

**非功能需求（Non-Functional Requirements）**：系統應該如何運作。

也稱為品質屬性（Quality Attributes）。

| 類型 | 例子 |
|------|------|
| 效能 | 頁面載入時間 < 2 秒 |
| 可用性 | 99.9% uptime |
| 安全性 | 密碼須加密儲存 |
| 可用性（Usability） | 新使用者 10 分鐘內可完成首次購買 |
| 可維護性 | 新開發者 2 天內可完成第一個 bug fix |

### 7.2.2 FURPS+ 分類法

一個常用的需求分類法：

| 字母 | 類型 | 說明 |
|------|------|------|
| F | Functionality | 功能 |
| U | Usability | 可用性 |
| R | Reliability | 可靠性 |
| P | Performance | 效能 |
| S | Supportability | 可支援性 |
| + | 其他 | 設計約束、介面、實作限制 |

### 7.2.3 好需求的特徵（SMART）

| 特徵 | 說明 | 壞例子 | 好例子 |
|------|------|--------|--------|
| Specific | 具體 | 「系統要很快」 | 「頁面載入 < 2 秒」 |
| Measurable | 可度量 | 「使用者滿意」 | 「NPS > 40」 |
| Achievable | 可達成 | 「永不當機」 | 「99.9% uptime」 |
| Relevant | 相關 | 「用最新框架」 | 「支援 IE11」 |
| Traceable | 可追溯 | 散落的便條紙 | 有編號、有來源 |

---

## 7.3 需求工程的流程

需求工程是一個迭代的流程：

```
┌─────────────────────────────────────────────────────┐
│                                                     │
│   ┌─────────┐     ┌─────────┐     ┌─────────┐      │
│   │  發掘   │ ──► │  分析   │ ──► │  協商   │      │
│   │ Elicit  │     │ Analyze │     │Negotiate│      │
│   └─────────┘     └─────────┘     └─────────┘      │
│        ▲                               │           │
│        │                               ▼           │
│   ┌─────────┐                    ┌─────────┐      │
│   │  管理   │ ◄────────────────  │  規範   │      │
│   │ Manage  │                    │ Specify │      │
│   └─────────┘                    └─────────┘      │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 7.3.1 發掘（Elicitation）

**目標**：發現利害關係人的需求。

**挑戰**：
- 使用者不知道自己要什麼
- 使用者知道但說不清楚
- 使用者說的和想的不一樣
- 不同使用者要的不一樣

**常用技術**：

| 技術 | 適用情境 | 優點 | 缺點 |
|------|----------|------|------|
| **訪談** | 深入理解個別使用者 | 深入、靈活 | 耗時、依賴技巧 |
| **問卷** | 收集大量使用者意見 | 規模大、可量化 | 淺層、無法追問 |
| **觀察** | 理解實際工作流程 | 發現隱性需求 | 干擾、樣本有限 |
| **工作坊** | 快速建立共識 | 高效、多元觀點 | 強勢者主導 |
| **原型** | 驗證理解是否正確 | 具體、可測試 | 可能被誤解為完成品 |
| **文件分析** | 理解現有系統 | 不打擾使用者 | 可能過時 |

**訪談技巧**：

1. **開放式問題**：「告訴我你平常怎麼處理客訴？」（而非「你用系統處理客訴嗎？」）
2. **具體追問**：「可以給我一個最近的例子嗎？」
3. **確認理解**：「讓我確認一下，你的意思是...？」
4. **探索例外**：「如果遇到 X 情況，你會怎麼處理？」
5. **量化**：「這種情況多常發生？大概多少時間？」

### 7.3.2 分析（Analysis）

**目標**：理解、組織、識別問題。

**活動**：

1. **分類**：將需求分類（功能/非功能、業務/使用者/系統）
2. **建模**：用模型表達需求（使用案例圖、資料流圖）
3. **識別衝突**：找出矛盾的需求
4. **識別遺漏**：找出缺少的需求
5. **優先排序**：區分必要、想要、可選

**常見問題**：

| 問題 | 徵兆 | 處理方式 |
|------|------|----------|
| 模糊 | 「使用者友善」 | 定義具體標準 |
| 不完整 | 只描述正常流程 | 問「如果...會怎樣？」 |
| 不一致 | A 說要快，B 說要便宜 | 協商、權衡 |
| 不可行 | 「永遠不當機」 | 轉化為可達成的目標 |

### 7.3.3 協商（Negotiation）

**目標**：解決需求衝突，達成共識。

**衝突類型**：

| 類型 | 例子 | 處理方式 |
|------|------|----------|
| 資源衝突 | 預算不夠做全部 | 優先排序、分期 |
| 利益衝突 | A 部門和 B 部門要求不同 | 找共同目標 |
| 技術衝突 | 需求和技術限制矛盾 | 權衡、替代方案 |
| 時程衝突 | 要的太多、時間太少 | 分期、MVP |

**協商原則**：

1. **以使用者價值為中心**：最終目標是什麼？
2. **探索選項**：有沒有其他方式達成目標？
3. **用數據說話**：這個需求的影響是多少使用者？多少收入？
4. **接受權衡**：不可能全部都要
5. **記錄決策**：為什麼選擇 A 而非 B

### 7.3.4 規範（Specification）

**目標**：將需求記錄下來，成為可驗證的規格。

**形式**：

| 形式 | 特徵 | 適用情境 |
|------|------|----------|
| 自然語言 | 易讀、易寫 | 初期溝通、使用者故事 |
| 結構化模板 | 標準化、較精確 | 合約、驗收標準 |
| 模型（UML） | 視覺化、精確 | 設計溝通 |
| 原型 | 具體、可互動 | UI/UX 需求 |
| 形式語言 | 數學精確 | 安全關鍵系統 |

**使用者故事（User Story）**：

敏捷中最常用的需求規範形式。

```
作為 [角色]
我想要 [功能]
以便 [價值]
```

例子：
```
作為 客服人員
我想要 搜尋歷史對話記錄
以便 快速找到客戶過去的問題
```

**驗收標準（Acceptance Criteria）**：

搭配使用者故事，定義「完成」的標準。

```
Given [情境]
When [行動]
Then [結果]
```

例子：
```
Given 我有登入系統
When 我輸入客戶電話號碼並按搜尋
Then 顯示該客戶過去 90 天的所有對話記錄
```

### 7.3.5 管理（Management）

**目標**：追蹤、控制需求變更。

**活動**：

1. **版本控制**：追蹤需求的變化
2. **追溯**：需求 → 設計 → 程式碼 → 測試
3. **變更控制**：評估變更影響，正式核准
4. **狀態追蹤**：每個需求的實作狀態

**變更控制流程**：

```
變更請求 → 影響分析 → 評估決策 → 核准/拒絕 → 實作 → 驗證
```

**追溯矩陣**：

| 需求 ID | 設計元件 | 程式碼模組 | 測試案例 | 狀態 |
|---------|----------|------------|----------|------|
| REQ-001 | 搜尋服務 | search.py | TC-015 | 已實作 |
| REQ-002 | 通知服務 | notify.py | TC-022 | 進行中 |

---

## 7.4 利害關係人分析

### 7.4.1 誰是利害關係人？

**利害關係人**（Stakeholder）：對系統有興趣或受系統影響的人。

常見利害關係人：

| 類別 | 角色 | 關注點 |
|------|------|--------|
| **使用者** | 終端使用者 | 功能、易用性 |
| | 管理者 | 報表、控制 |
| **客戶** | 購買者 | 成本、時程 |
| | 決策者 | ROI、風險 |
| **開發** | 開發者 | 可行性、清晰度 |
| | 測試者 | 可測試性 |
| **營運** | 維運 | 可維護性 |
| | 支援 | 可支援性 |
| **外部** | 監管者 | 合規 |
| | 合作夥伴 | 介面、相容性 |

### 7.4.2 利害關係人分析

**步驟**：

1. **識別**：誰會使用、影響、被影響？
2. **分類**：影響力 vs. 利益
3. **理解**：他們要什麼？擔心什麼？
4. **策略**：如何溝通、管理期望

**利害關係人矩陣**：

```
        高影響力
            │
    密切管理 │ 重點溝通
            │
低利益─────┼─────高利益
            │
    最低關注 │ 保持告知
            │
        低影響力
```

| 象限 | 策略 |
|------|------|
| 高影響力、高利益 | 密切管理：頻繁溝通、參與決策 |
| 高影響力、低利益 | 重點溝通：保持滿意、定期更新 |
| 低影響力、高利益 | 保持告知：提供資訊、回應問題 |
| 低影響力、低利益 | 最低關注：監控、必要時溝通 |

---

## 7.5 需求發掘的實踐

### 7.5.1 使用案例（Use Case）

**定義**：描述使用者與系統互動以達成目標的步驟。

**元素**：

| 元素 | 說明 |
|------|------|
| 名稱 | 動詞 + 名詞（例：搜尋歷史對話） |
| 主要參與者 | 觸發使用案例的角色 |
| 前置條件 | 開始前必須滿足的條件 |
| 後置條件 | 完成後的系統狀態 |
| 主要流程 | 正常情況的步驟 |
| 替代流程 | 例外情況的處理 |

**範例**：

```
使用案例：搜尋歷史對話

主要參與者：客服人員
前置條件：使用者已登入系統
後置條件：顯示符合條件的對話列表

主要流程：
1. 客服人員進入搜尋頁面
2. 系統顯示搜尋表單
3. 客服人員輸入搜尋條件（客戶電話/姓名/日期）
4. 客服人員按下搜尋按鈕
5. 系統查詢符合條件的對話
6. 系統顯示結果列表

替代流程：
5a. 無符合結果：
    5a1. 系統顯示「無符合結果」訊息
    5a2. 提供修改搜尋條件的建議
    5a3. 返回步驟 3

4a. 未輸入任何條件：
    4a1. 系統提示「請至少輸入一個搜尋條件」
    4a2. 返回步驟 3
```

### 7.5.2 使用者故事映射（User Story Mapping）

**目的**：將使用者故事組織成視覺化地圖，理解全貌。

```
使用者活動（Walking Skeleton）
┌─────────┬─────────┬─────────┬─────────┐
│  登入   │  瀏覽   │  購買   │  追蹤   │
└────┬────┴────┬────┴────┬────┴────┬────┘
     │         │         │         │
     ▼         ▼         ▼         ▼
┌─────────┬─────────┬─────────┬─────────┐
│帳密登入 │瀏覽商品 │加入購物車│查看訂單 │ ← Release 1
├─────────┼─────────┼─────────┼─────────┤
│社交登入 │商品搜尋 │ 結帳    │追蹤物流 │ ← Release 2
├─────────┼─────────┼─────────┼─────────┤
│雙因素   │個人推薦 │分期付款 │ 退貨    │ ← Release 3
└─────────┴─────────┴─────────┴─────────┘
```

**好處**：
- 看到使用者旅程全貌
- 識別 MVP（最小可行產品）
- 規劃發布版本
- 發現遺漏的故事

### 7.5.3 工作坊技術

**JAD（Joint Application Development）**：

結構化的需求工作坊，將使用者和開發者聚在一起。

**議程範例（2 天）**：

| 時間 | 活動 |
|------|------|
| Day 1 上午 | 專案目標、利害關係人介紹 |
| Day 1 下午 | 現況分析、痛點收集 |
| Day 2 上午 | 需求腦力激盪、優先排序 |
| Day 2 下午 | 初步規格確認、後續步驟 |

**主持技巧**：
- 確保每個人有發言機會
- 用視覺化工具（便利貼、白板）
- 限制討論時間
- 記錄決策和未決事項
- 避免過早跳入解決方案

---

## 7.6 需求驗證

### 7.6.1 為什麼要驗證？

需求階段的錯誤，越晚發現越貴。驗證的目的是在開發前發現問題。

### 7.6.2 驗證技術

| 技術 | 說明 | 適用時機 |
|------|------|----------|
| **審查** | 正式檢視需求文件 | 需求規格完成後 |
| **原型** | 建立可互動的模型 | UI/UX 需求 |
| **模擬** | 模擬系統行為 | 複雜流程 |
| **測試案例** | 用測試案例驗證需求 | 驗收標準明確時 |

### 7.6.3 需求審查檢查清單

| 檢查項目 | 說明 |
|----------|------|
| **完整性** | 是否描述了正常流程和例外流程？ |
| **一致性** | 需求之間是否有矛盾？ |
| **可行性** | 技術上是否可實現？ |
| **可測試性** | 是否可以設計測試來驗證？ |
| **可追溯性** | 是否可以追溯到業務目標？ |
| **清晰性** | 是否有歧義？是否所有人理解一致？ |
| **必要性** | 這個需求真的需要嗎？ |

---

## 7.7 敏捷中的需求工程

### 7.7.1 敏捷的需求觀

傳統 vs. 敏捷的需求觀：

| 面向 | 傳統 | 敏捷 |
|------|------|------|
| 時機 | 開發前完成 | 持續演進 |
| 詳細度 | 越詳細越好 | 夠用就好 |
| 形式 | 正式文件 | 對話 + 簡短記錄 |
| 變更 | 控制變更 | 擁抱變更 |

### 7.7.2 敏捷需求實踐

**Product Backlog**：
- 所有需求的有序列表
- 由 Product Owner 管理
- 持續精煉（Grooming/Refinement）

**使用者故事**：
- 輕量級需求記錄
- 3C 原則：Card, Conversation, Confirmation
  - **Card**：簡短描述（便利貼大小）
  - **Conversation**：與使用者持續對話
  - **Confirmation**：驗收標準

**故事精煉**：
- 定期會議（每週 1-2 小時）
- 細化即將開發的故事
- 估算複雜度
- 識別依賴和風險

### 7.7.3 INVEST 原則

好的使用者故事應該符合 INVEST：

| 字母 | 原則 | 說明 |
|------|------|------|
| I | Independent | 獨立於其他故事 |
| N | Negotiable | 可以協商細節 |
| V | Valuable | 對使用者有價值 |
| E | Estimable | 可以估算大小 |
| S | Small | 足夠小，一個 Sprint 可完成 |
| T | Testable | 可以測試驗證 |

---

## 7.8 本章總結

### 核心概念

| 概念 | 一句話解釋 |
|------|-----------|
| 需求層次 | 業務 → 使用者 → 系統，層層細化 |
| 功能 vs. 非功能 | 做什麼 vs. 如何做（品質屬性） |
| 需求流程 | 發掘 → 分析 → 協商 → 規範 → 管理 |
| 利害關係人 | 識別、分類、理解、管理 |
| 使用者故事 | 作為...我想要...以便... |
| 驗收標準 | Given...When...Then... |
| 追溯性 | 需求 ↔ 設計 ↔ 程式碼 ↔ 測試 |

### 實踐指引

1. **投資發掘**：花時間理解使用者真正需要什麼
2. **多種技術**：訪談、觀察、原型、工作坊並用
3. **驗證需求**：在開發前確認需求正確
4. **擁抱變更**：但要有管理變更的流程
5. **保持追溯**：每個需求都要能追溯到業務目標

### 下一章預告

需求確定後，如何將需求模型化？下一章我們將學習「需求建模的推薦方法」——使用案例圖、活動圖、資料建模等技術。

---

## 延伸思考

1. 你的團隊如何發掘需求？有使用哪些技術？

2. 需求變更是你專案的主要問題嗎？如何管理？

3. 你有使用使用者故事嗎？有什麼挑戰？

---

*下一章：第8章　需求建模的推薦方法*
