# 第23章　軟體度量與分析

> 「You can't improve what you don't measure.（你無法改善你沒有度量的東西。）」

---

## 23.1 為什麼需要度量？

### 23.1.1 度量的目的

| 目的 | 說明 |
|------|------|
| **理解** | 了解現狀 |
| **控制** | 發現異常 |
| **改善** | 追蹤改善效果 |
| **預測** | 預估未來 |
| **溝通** | 和利害關係人對話 |

### 23.1.2 度量的陷阱

| 陷阱 | 說明 |
|------|------|
| **Goodhart's Law** | 當度量變成目標，它就不再是好的度量 |
| **虛榮指標** | 看起來好看但沒有意義 |
| **過度度量** | 度量太多，重點模糊 |
| **忽略情境** | 數字沒有背景 |

**Goodhart's Law 範例**：

```
目標：提高程式碼行數
結果：開發者寫更多不必要的程式碼

目標：減少 Bug 數量
結果：測試者不報告小 Bug
```

### 23.1.3 好的度量原則

| 原則 | 說明 |
|------|------|
| **可行動** | 能根據度量採取行動 |
| **可比較** | 能和過去/基準比較 |
| **可理解** | 利害關係人能理解 |
| **及時** | 能及時取得 |
| **平衡** | 不要只看單一指標 |

---

## 23.2 度量類型

### 23.2.1 過程度量

| 度量 | 定義 | 用途 |
|------|------|------|
| **Lead Time** | 從需求到上線的時間 | 衡量流程效率 |
| **Cycle Time** | 從開始到完成的時間 | 衡量開發效率 |
| **Throughput** | 單位時間完成的項目數 | 衡量產出 |
| **WIP** | 進行中的工作數量 | 識別瓶頸 |

### 23.2.2 產品度量

| 度量 | 定義 | 用途 |
|------|------|------|
| **程式碼行數** | Lines of Code (LOC) | 大小估計（有限） |
| **複雜度** | Cyclomatic Complexity | 程式碼複雜程度 |
| **覆蓋率** | 測試覆蓋的程式碼比例 | 測試充分性 |
| **技術債** | 需要修復的問題數量 | 程式碼健康 |

### 23.2.3 品質度量

| 度量 | 定義 | 用途 |
|------|------|------|
| **缺陷密度** | 缺陷數 / KLOC | 程式碼品質 |
| **MTBF** | 平均故障間隔時間 | 可靠性 |
| **MTTR** | 平均修復時間 | 可維護性 |
| **可用性** | 正常運行時間比例 | 服務品質 |

### 23.2.4 團隊度量

| 度量 | 定義 | 用途 |
|------|------|------|
| **速度** | Sprint 完成的故事點數 | 團隊產能 |
| **預測準確度** | 實際 vs 預估 | 估算能力 |
| **返工率** | 重做的工作比例 | 品質問題 |

---

## 23.3 DORA 指標

### 23.3.1 四個關鍵指標

**DORA（DevOps Research and Assessment）**研究識別的關鍵指標：

```
┌──────────────────────────────────────────────────────────────┐
│                     DORA 四大指標                            │
│                                                              │
│  ┌─────────────────────────────────────────────────────────┐│
│  │                    效能面                               ││
│  │                                                         ││
│  │   部署頻率                     變更前置時間              ││
│  │   (Deployment Frequency)       (Lead Time for Changes)  ││
│  │   多久部署一次？               從提交到上線多久？         ││
│  │                                                         ││
│  │   ┌─────────┐                  ┌─────────┐             ││
│  │   │ 高: 日  │                  │ 高: < 天 │             ││
│  │   │ 中: 週  │                  │ 中: 1週  │             ││
│  │   │ 低: 月  │                  │ 低: > 月 │             ││
│  │   └─────────┘                  └─────────┘             ││
│  └─────────────────────────────────────────────────────────┘│
│                                                              │
│  ┌─────────────────────────────────────────────────────────┐│
│  │                    穩定面                               ││
│  │                                                         ││
│  │   變更失敗率                   服務恢復時間              ││
│  │   (Change Failure Rate)        (MTTR)                   ││
│  │   多少部署會失敗？             失敗後多久恢復？           ││
│  │                                                         ││
│  │   ┌─────────┐                  ┌─────────┐             ││
│  │   │ 高: < 15%│                 │ 高: < 1hr│             ││
│  │   │ 中: 15-30│                 │ 中: < 1天│             ││
│  │   │ 低: > 30%│                 │ 低: > 週 │             ││
│  │   └─────────┘                  └─────────┘             ││
│  └─────────────────────────────────────────────────────────┘│
└──────────────────────────────────────────────────────────────┘
```

### 23.3.2 績效等級

| 等級 | 部署頻率 | 前置時間 | 失敗率 | 恢復時間 |
|------|----------|----------|--------|----------|
| **Elite** | 每天多次 | < 1 小時 | < 5% | < 1 小時 |
| **High** | 每天～每週 | < 1 天 | 6-15% | < 1 天 |
| **Medium** | 每週～每月 | 1-6 個月 | 16-30% | 1 天-1 週 |
| **Low** | 每月以上 | > 6 個月 | > 45% | > 6 個月 |

### 23.3.3 DORA 指標的關聯

```
     速度                            穩定性
      ↑                               ↑
      │                               │
┌─────────────┐               ┌─────────────┐
│  部署頻率   │               │  變更失敗率  │
│            │                │            │
│  前置時間   │               │  恢復時間   │
└─────────────┘               └─────────────┘
      │                               │
      └───────────────────────────────┘
                    │
                    ▼
            高績效團隊：
            速度和穩定性可以兼得
```

---

## 23.4 GQM 方法

### 23.4.1 什麼是 GQM？

**GQM（Goal-Question-Metric）**：從目標出發定義度量的方法。

```
┌──────────────────────────────────────────────────────────────┐
│                        GQM 結構                              │
│                                                              │
│                       Goal（目標）                           │
│                           │                                  │
│              ┌────────────┼────────────┐                    │
│              │            │            │                    │
│              ▼            ▼            ▼                    │
│        Question      Question      Question                 │
│        （問題）       （問題）       （問題）                  │
│              │            │            │                    │
│         ┌────┴────┐  ┌────┴────┐  ┌────┴────┐             │
│         │         │  │         │  │         │             │
│         ▼         ▼  ▼         ▼  ▼         ▼             │
│      Metric    Metric  Metric  Metric  Metric  Metric      │
│      （度量）   （度量） （度量） （度量） （度量） （度量）     │
└──────────────────────────────────────────────────────────────┘
```

### 23.4.2 GQM 範例

**Goal（目標）**：提高系統可靠性

| Question（問題） | Metric（度量） |
|------------------|----------------|
| 系統多常故障？ | MTBF（平均故障間隔） |
| 故障多快被發現？ | 故障偵測時間 |
| 故障多快被修復？ | MTTR（平均修復時間） |
| 系統可用率多少？ | 可用性（Uptime %） |
| 錯誤率多少？ | 錯誤請求 / 總請求 |

### 23.4.3 GQM 範例二

**Goal（目標）**：提高開發效率

| Question（問題） | Metric（度量） |
|------------------|----------------|
| 一個功能多久做完？ | Cycle Time |
| 多久部署一次？ | 部署頻率 |
| 等待多少時間？ | Lead Time - Cycle Time |
| 多少工作被擋住？ | WIP, Blocked items |
| 估計準確嗎？ | 實際 / 預估 比例 |

---

## 23.5 度量儀表板

### 23.5.1 儀表板設計原則

| 原則 | 說明 |
|------|------|
| **焦點** | 3-5 個核心指標 |
| **可視化** | 圖表優於數字 |
| **趨勢** | 顯示變化趨勢 |
| **目標** | 標示目標值 |
| **即時** | 自動更新 |

### 23.5.2 儀表板範例

```
┌──────────────────────────────────────────────────────────────┐
│                    工程效能儀表板                             │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  部署頻率            變更前置時間           變更失敗率        │
│  ┌─────────┐        ┌─────────┐           ┌─────────┐       │
│  │  15/週  │        │  2.5 天  │           │   8%    │       │
│  │ ████████│        │ ████████│           │ ████████│       │
│  │   ↑ 25% │        │   ↓ 30% │           │   ↓ 5%  │       │
│  └─────────┘        └─────────┘           └─────────┘       │
│   目標: 20           目標: < 2天            目標: < 10%       │
│                                                              │
│  ─────────────────────────────────────────────────────────  │
│                                                              │
│  測試覆蓋率趨勢                    缺陷趨勢                   │
│  ┌────────────────────────────┐   ┌────────────────────────┐│
│  │ 85%                    ────│   │         ────────       ││
│  │     ──────────────────     │   │     ────        ────   ││
│  │ 75% ────                   │   │ ────                   ││
│  └────────────────────────────┘   └────────────────────────┘│
│   Jan  Feb  Mar  Apr  May          Jan  Feb  Mar  Apr  May   │
│                                                              │
│  ─────────────────────────────────────────────────────────  │
│                                                              │
│  P0 Bugs: 0    P1 Bugs: 3    P2 Bugs: 12    Tech Debt: 15%  │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

### 23.5.3 度量工具

| 工具 | 用途 |
|------|------|
| **SonarQube** | 程式碼品質 |
| **Grafana** | 儀表板視覺化 |
| **Prometheus** | 指標收集 |
| **Jira** | 流程度量 |
| **Datadog** | 全面監控 |

---

## 23.6 度量分析與行動

### 23.6.1 分析流程

```
┌──────────────────────────────────────────────────────────────┐
│                     度量分析流程                              │
│                                                              │
│  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐ │
│  │  收集  │─►│  分析  │─►│  解讀  │─►│  行動  │─►│  驗證  │ │
│  └────────┘  └────────┘  └────────┘  └────────┘  └────────┘ │
│                                                              │
│      │           │           │           │           │       │
│      ▼           ▼           ▼           ▼           ▼       │
│   自動收集    識別異常     理解原因     採取行動     衡量效果   │
│   定期更新    趨勢分析     討論團隊     改善流程     調整目標   │
└──────────────────────────────────────────────────────────────┘
```

### 23.6.2 異常識別

| 類型 | 識別方式 |
|------|----------|
| **閾值** | 超過或低於設定值 |
| **趨勢** | 持續上升或下降 |
| **波動** | 異常的變化幅度 |
| **比較** | 和基準或同期比較 |

### 23.6.3 根因分析

當度量異常時：

1. **收集資料**：收集相關度量
2. **識別模式**：找出關聯性
3. **假設原因**：提出可能原因
4. **驗證假設**：用資料驗證
5. **採取行動**：解決根因

---

## 23.7 本章總結

### 核心概念

| 概念 | 一句話解釋 |
|------|-----------|
| 度量 | 量化軟體開發的各個面向 |
| DORA | 四個關鍵 DevOps 指標 |
| GQM | 從目標出發定義度量 |
| 儀表板 | 視覺化呈現度量 |
| Goodhart's Law | 度量變目標就失效 |

### 核心指標速查

| 類型 | 關鍵指標 |
|------|----------|
| **效能** | 部署頻率、前置時間 |
| **穩定** | 失敗率、恢復時間 |
| **品質** | 覆蓋率、缺陷密度 |
| **效率** | Cycle Time、Throughput |

### 下一章預告

Part 3（品質與安全）完成！接下來進入 Part 4（專案管理），我們將學習「專案管理的概念」。

---

## 延伸思考

1. 你的團隊追蹤哪些指標？足夠嗎？

2. 你有遇過 Goodhart's Law 的情況嗎？

3. 你的指標能指導行動嗎？

---

*Part 3 完成！下一章：第24章　專案管理的概念*
