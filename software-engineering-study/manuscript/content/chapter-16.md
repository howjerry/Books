# 第16章　審查（Review）的推薦方法

> 「Code Review 不是找錯，而是分享知識、提升品質、建立共識的過程。」

---

## 16.1 什麼是軟體審查？

### 16.1.1 審查的定義

**軟體審查（Software Review）**：對軟體工作產品進行系統性檢查，以發現問題並確保品質。

審查的對象：

| 對象 | 說明 |
|------|------|
| 程式碼 | Code Review |
| 需求 | 需求審查 |
| 設計 | 設計審查 |
| 測試計畫 | 測試審查 |
| 文件 | 文件審查 |

### 16.1.2 審查的價值

| 價值 | 說明 |
|------|------|
| **發現問題** | 比測試早發現問題 |
| **知識分享** | 團隊成員學習 |
| **提升品質** | 程式碼更好 |
| **建立共識** | 統一風格和標準 |
| **減少風險** | 多人確認 |

### 16.1.3 審查的成本效益

| 階段 | 發現成本 | 修復成本 |
|------|----------|----------|
| 審查 | 低 | 低 |
| 測試 | 中 | 中 |
| 上線後 | 高 | 高 |

**研究數據**：
- Code Review 可發現 60-90% 的缺陷
- 審查投資回報率：4-8 倍

---

## 16.2 審查類型

### 16.2.1 正式審查（Formal Review）

```
┌──────────────────────────────────────────────────┐
│               正式審查流程                         │
├──────────────────────────────────────────────────┤
│  規劃 → 準備 → 會議 → 修正 → 追蹤                  │
│                                                  │
│  • 有明確角色（主持人、作者、審查者）               │
│  • 有會議記錄                                     │
│  • 有追蹤機制                                     │
│  • 用於關鍵或高風險項目                            │
└──────────────────────────────────────────────────┘
```

**角色**：

| 角色 | 職責 |
|------|------|
| 主持人 | 主持會議、確保流程 |
| 作者 | 說明工作產品 |
| 審查者 | 發現問題、提供回饋 |
| 記錄員 | 記錄問題和決議 |

### 16.2.2 走查（Walkthrough）

| 特點 | 說明 |
|------|------|
| 主導者 | 作者 |
| 目的 | 說明和教育 |
| 正式度 | 中等 |
| 適用 | 複雜邏輯、新功能 |

### 16.2.3 同儕審查（Peer Review）

| 特點 | 說明 |
|------|------|
| 主導者 | 審查者 |
| 目的 | 發現問題 |
| 正式度 | 低 |
| 適用 | 日常開發 |

### 16.2.4 比較

| 類型 | 正式度 | 時間 | 效果 | 適用 |
|------|--------|------|------|------|
| 正式審查 | 高 | 長 | 高 | 關鍵項目 |
| 走查 | 中 | 中 | 中 | 複雜功能 |
| 同儕審查 | 低 | 短 | 中 | 日常開發 |

---

## 16.3 Code Review 實踐

### 16.3.1 為什麼做 Code Review？

| 目的 | 說明 |
|------|------|
| **品質** | 發現 bug、改善設計 |
| **知識** | 分享知識、學習他人程式碼 |
| **標準** | 確保符合編碼標準 |
| **備援** | 多人熟悉程式碼 |
| **指導** | 資深帶新手 |

### 16.3.2 Code Review 流程

```
┌─────────────────────────────────────────────────────────┐
│                   Code Review 流程                       │
│                                                         │
│  ┌────────┐    ┌────────┐    ┌────────┐    ┌────────┐  │
│  │  開發  │───►│ 自我審 │───►│ 提交PR │───►│ 分配   │  │
│  │        │    │        │    │        │    │ 審查者 │  │
│  └────────┘    └────────┘    └────────┘    └────────┘  │
│                                                   │     │
│  ┌────────┐    ┌────────┐    ┌────────┐          │     │
│  │  合併  │◄───│  核准  │◄───│  審查  │◄─────────┘     │
│  │        │    │        │    │        │                │
│  └────────┘    └────────┘    └───┬────┘                │
│                                  │                      │
│                                  ▼                      │
│                            需要修改？                    │
│                            ┌─────┐                      │
│                            │ 修改 │                      │
│                            └──┬──┘                      │
│                               │                         │
│                               ▼                         │
│                            重新審查                      │
└─────────────────────────────────────────────────────────┘
```

### 16.3.3 審查者檢查什麼？

| 類別 | 檢查項目 |
|------|----------|
| **正確性** | 邏輯正確嗎？邊界情況處理了嗎？ |
| **設計** | 設計合理嗎？是否過度設計？ |
| **可讀性** | 程式碼容易理解嗎？命名清楚嗎？ |
| **可維護性** | 容易修改嗎？有重複嗎？ |
| **效能** | 有效能問題嗎？ |
| **安全性** | 有安全漏洞嗎？ |
| **測試** | 有測試嗎？測試有效嗎？ |
| **標準** | 符合編碼標準嗎？ |

### 16.3.4 審查者的態度

**好的審查**：

| 做法 | 說明 |
|------|------|
| 問問題 | 「這裡為什麼這樣做？」 |
| 建議 | 「可以考慮...」 |
| 解釋 | 說明為什麼有問題 |
| 肯定 | 看到好的地方也說 |
| 對事不對人 | 討論程式碼，不是人 |

**壞的審查**：

| 做法 | 問題 |
|------|------|
| 「這是錯的」 | 沒有解釋 |
| 「你應該...」 | 命令語氣 |
| 「這很蠢」 | 人身攻擊 |
| 只挑毛病 | 沒有建設性 |
| 吹毛求疵 | 浪費時間 |

### 16.3.5 作者的態度

| 做法 | 說明 |
|------|------|
| 開放心態 | 接受回饋 |
| 不防禦 | 不要辯護 |
| 解釋背景 | 說明為什麼這樣做 |
| 感謝 | 感謝審查者的時間 |
| 學習 | 從回饋中學習 |

---

## 16.4 有效的 Code Review

### 16.4.1 Review 的大小

| PR 大小 | 建議 |
|---------|------|
| < 200 行 | 理想 |
| 200-400 行 | 可接受 |
| > 400 行 | 應該拆分 |

**為什麼要小？**
- 審查者注意力有限
- 大 PR 審查品質下降
- 難以理解上下文

### 16.4.2 Review 的時間

| 指標 | 建議 |
|------|------|
| 等待時間 | < 24 小時 |
| 審查時間 | 30-60 分鐘/次 |
| 每日時間 | 不超過 1-2 小時 |

**時間管理**：
- 設定每日固定 Review 時間
- 小 PR 優先處理
- 使用工具通知

### 16.4.3 自動化輔助

| 工具 | 功能 |
|------|------|
| Linter | 程式碼風格檢查 |
| 靜態分析 | 潛在問題偵測 |
| 自動測試 | 確保測試通過 |
| 覆蓋率 | 測試覆蓋率檢查 |
| Bot | 自動分配審查者 |

**原則**：能自動化的不要人工做。

### 16.4.4 Checklist

**審查者 Checklist**：

```markdown
## 正確性
- [ ] 邏輯正確
- [ ] 邊界情況處理
- [ ] 錯誤處理適當

## 設計
- [ ] 設計合理
- [ ] 沒有過度設計
- [ ] 符合現有架構

## 可讀性
- [ ] 命名清楚
- [ ] 程式碼容易理解
- [ ] 註解適當

## 可維護性
- [ ] 沒有重複
- [ ] 模組化良好
- [ ] 容易修改

## 測試
- [ ] 有適當的測試
- [ ] 測試有意義

## 安全
- [ ] 沒有安全漏洞
- [ ] 敏感資料保護
```

---

## 16.5 設計審查

### 16.5.1 什麼時候做設計審查？

| 情況 | 需要設計審查 |
|------|-------------|
| 新功能 | 是 |
| 架構變更 | 是 |
| 大規模重構 | 是 |
| 小 bug fix | 通常不需要 |

### 16.5.2 設計審查內容

| 類別 | 問題 |
|------|------|
| 需求 | 設計滿足需求嗎？ |
| 架構 | 符合現有架構嗎？ |
| 介面 | API 設計合理嗎？ |
| 效能 | 效能考量足夠嗎？ |
| 安全 | 安全考量足夠嗎？ |
| 可維護 | 容易維護嗎？ |
| 替代方案 | 考慮過其他方案嗎？ |

### 16.5.3 設計文件審查

**RFC（Request for Comments）**：

```markdown
# RFC: 新功能設計

## 背景
為什麼需要這個功能？

## 目標
要達成什麼？

## 設計
技術設計細節

## 替代方案
考慮過的其他方案

## 風險
潛在風險和緩解措施

## 開放問題
需要討論的問題
```

---

## 16.6 建立審查文化

### 16.6.1 好的審查文化

| 特徵 | 說明 |
|------|------|
| 心理安全 | 提問不會被嘲笑 |
| 學習導向 | 從審查中學習 |
| 及時回應 | 不讓人久等 |
| 尊重 | 對事不對人 |
| 感謝 | 感謝審查者的時間 |

### 16.6.2 避免的問題

| 問題 | 解決 |
|------|------|
| 審查變成關卡 | 設定時間限制 |
| 審查變成批鬥 | 建立溝通準則 |
| 只有資深審查 | 讓新人也參與 |
| 審查流於形式 | 使用 Checklist |
| 審查太慢 | 設定 SLA |

### 16.6.3 審查 SLA

| 項目 | 目標 |
|------|------|
| 首次回應 | < 4 小時 |
| 完成審查 | < 24 小時 |
| 緊急 PR | < 2 小時 |

---

## 16.7 本章總結

### 核心概念

| 概念 | 一句話解釋 |
|------|-----------|
| 審查 | 系統性檢查工作產品 |
| Code Review | 同儕檢查程式碼 |
| 審查價值 | 發現問題 + 知識分享 |
| 審查態度 | 對事不對人、建設性 |

### Code Review Checklist

| 項目 | 問題 |
|------|------|
| 正確性 | 邏輯對嗎？邊界處理了嗎？ |
| 設計 | 設計合理嗎？ |
| 可讀 | 容易理解嗎？ |
| 測試 | 有測試嗎？ |
| 安全 | 有漏洞嗎？ |

### 下一章預告

審查是品質保證的一部分，但不是全部。下一章我們將學習「軟體品質保證」——完整的品質保證流程。

---

## 延伸思考

1. 你的團隊 Code Review 做得如何？有什麼問題？

2. 你遇過不好的 Review 經驗嗎？如何改善？

3. 如何在速度和審查品質之間取得平衡？

---

*下一章：第17章　軟體品質保證*
