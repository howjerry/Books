# 第23章　軟體度量與分析 — 學習筆記

> **狀態**：✅ 已完成
> **閱讀日期**：2025-12-27
> **教材位置**：[content/chapter-23.md](../content/chapter-23.md)

---

## 章前預測（5 分鐘）

### 這章應該回答什麼問題？

1. 應該度量什麼？
2. 如何選擇正確的指標？
3. DORA 指標是什麼？
4. 如何使用度量來改善？

### 我現在的理解是什麼？

閱讀前，我的理解：
- 度量 = 計算程式碼行數
- 覆蓋率越高越好
- 速度越快越好

### 我遇過哪些相關痛點？

1. **度量變目標**：為了覆蓋率而寫無意義的測試
2. **不知道度量什麼**：太多數字但不知道怎麼用
3. **度量沒有行動**：看了數字但沒有改變

---

## 本章一句話

> **度量是為了理解、控制和改善。使用 GQM 方法從目標出發定義度量，關注 DORA 四大指標，避免 Goodhart's Law 陷阱。度量必須能指導行動。**

---

## 3 個關鍵概念

### 概念 1：Goodhart's Law

**書中定義**：

> 「當度量變成目標，它就不再是好的度量。」

**我的理解**：

這解釋了為什麼很多度量最後都失效。

**範例**：

| 度量目標 | 扭曲行為 |
|----------|----------|
| 增加程式碼行數 | 寫冗長程式碼 |
| 減少 Bug 數量 | 不報告小 Bug |
| 提高覆蓋率 | 寫無意義的測試 |
| 增加 PR 數量 | 拆成很多小 PR |

**如何避免**：

1. **多指標平衡**：不要只看單一指標
2. **關注結果**：度量是手段，不是目的
3. **定期檢視**：指標是否還有意義

**經驗法則**：
> 「如果指標容易被『玩』，它可能不是好指標。」

---

### 概念 2：DORA 四大指標

**書中定義**：

| 指標 | 定義 | 高績效標準 |
|------|------|-----------|
| 部署頻率 | 多久部署一次 | 每天多次 |
| 前置時間 | 提交到上線 | < 1 小時 |
| 失敗率 | 部署導致問題 | < 5% |
| 恢復時間 | 問題到恢復 | < 1 小時 |

**我的理解**：

DORA 的價值：
- 基於大量研究數據
- 平衡速度和穩定性
- 可以和業界比較

**我們的現狀**：

| 指標 | 現狀 | 目標 |
|------|------|------|
| 部署頻率 | 每週 1-2 次 | 每天 |
| 前置時間 | 3-5 天 | < 1 天 |
| 失敗率 | 15% | < 10% |
| 恢復時間 | 4-8 小時 | < 1 小時 |

**改善優先級**：
1. 前置時間（自動化部署）
2. 恢復時間（加強監控）
3. 部署頻率（小批量發布）

---

### 概念 3：GQM 方法

**書中定義**：

Goal → Question → Metric

1. 先定義目標
2. 再問問題
3. 最後選指標

**我的理解**：

這解決了「不知道度量什麼」的問題。

**範例**：

**Goal**：提高客戶滿意度

| Question | Metric |
|----------|--------|
| 使用者遇到多少錯誤？ | 錯誤率 |
| 系統多常無法使用？ | 可用性 |
| 使用者等多久？ | 回應時間 |
| 使用者給幾分？ | NPS |

**經驗法則**：
> 「如果不知道度量什麼，先問『我想達成什麼目標？』」

---

## 原則、方法、護欄

### 度量選擇速查表

| 目標 | 建議度量 |
|------|----------|
| 衡量效率 | Cycle Time, Throughput |
| 衡量品質 | 缺陷密度, 覆蓋率 |
| 衡量可靠性 | MTBF, MTTR, 可用性 |
| 衡量 DevOps | DORA 四指標 |
| 衡量團隊 | 速度, 預測準確度 |

---

### 護欄（Guardrail）

| 危險信號 | 可能的問題 | 修正方式 |
|----------|-----------|----------|
| 只看一個指標 | 被扭曲 | 多指標平衡 |
| 指標太多 | 失去焦點 | 精簡到 3-5 個 |
| 沒有基準 | 不知道好壞 | 建立基準線 |
| 沒有行動 | 度量沒意義 | 定義行動閾值 |
| 手動收集 | 不及時 | 自動化 |

---

## 1 個決策點

### 決策情境

**追蹤多少指標？**

### 選項對比

| 策略 | 優點 | 缺點 |
|------|------|------|
| 少量（3-5） | 焦點明確 | 可能遺漏 |
| 中等（6-10） | 較完整 | 需要管理 |
| 大量（10+） | 很完整 | 難以聚焦 |

### 決策準則

| 情境 | 建議 |
|------|------|
| 小團隊 | 3-5 個核心指標 |
| 中型團隊 | 5-8 個 |
| 大型組織 | 分層：團隊級 + 組織級 |

**我的選擇**：

**核心指標（每天看）**：
1. 部署頻率
2. 失敗率
3. 開放 P0/P1 Bug 數

**次要指標（每週看）**：
4. 前置時間
5. 覆蓋率
6. 技術債

---

## 1 個反模式（Anti-pattern）

### 反模式名稱

**「虛榮指標」症候群**

### 錯誤做法

追蹤看起來好看但沒意義的指標：
- 總程式碼行數：越多越「好」？
- 總 PR 數量：越多越「忙」？
- 總 Commit 數：越多越「努力」？

### 後果

1. **誤導決策**：數字好看但問題沒解決
2. **錯誤激勵**：追求數字而非價值
3. **浪費精力**：收集沒用的資料
4. **失去信任**：團隊不相信度量

### 正確做法

**選擇可行動指標**：

| 虛榮指標 | 可行動指標 |
|----------|-----------|
| 總程式碼行數 | 功能完成率 |
| 總 PR 數量 | 部署頻率 |
| 總測試數量 | 關鍵路徑覆蓋率 |
| 總 Bug 數量 | 逃逸 Bug 率 |

**檢驗標準**：
> 「這個指標異常時，我們會採取什麼行動？」

如果答案是「不知道」，那可能是虛榮指標。

---

## 可落地 Checklist（至少 5 條）

建立度量時檢查：

- [x] **GQM**：從目標出發定義指標嗎？
- [x] **可行動**：指標能指導行動嗎？
- [x] **平衡**：有多個指標平衡嗎？
- [x] **自動化**：指標自動收集嗎？
- [x] **可視化**：有儀表板嗎？
- [x] **定期檢視**：定期看指標嗎？
- [x] **行動閾值**：知道什麼時候該行動嗎？

---

## 章後練習

### 練習：用 GQM 定義你的度量

> 目標：為你的專案定義度量體系

**我的 GQM**：

**Goal 1**：提高發布效率

| Question | Metric | 目標 |
|----------|--------|------|
| 發布多久一次？ | 部署頻率 | 每天 |
| 等待多久？ | Lead Time | < 1 天 |
| 多少失敗？ | 失敗率 | < 10% |

**Goal 2**：提高程式碼品質

| Question | Metric | 目標 |
|----------|--------|------|
| 有多少 Bug？ | 缺陷密度 | < 1/KLOC |
| 測試夠嗎？ | 覆蓋率 | > 80% |
| 技術債多少？ | SonarQube 債務 | < 5% |

**Goal 3**：提高系統可靠性

| Question | Metric | 目標 |
|----------|--------|------|
| 多常故障？ | Incident 數 | < 2/月 |
| 多快恢復？ | MTTR | < 1 小時 |
| 可用率？ | Uptime | > 99.9% |

---

## 延伸思考

### 如何讓團隊接受度量？

**我的策略**：

1. **從團隊目標出發**
   - 「我們想改善什麼？」
   - 不是「公司要我們度量」

2. **度量是工具不是評價**
   - 用來改善，不是打績效
   - 公開透明

3. **從少量開始**
   - 先 3 個核心指標
   - 證明價值後再擴展

4. **慶祝改善**
   - 指標改善時慶祝
   - 正向強化

### 度量多久看一次？

**我的建議**：

| 指標類型 | 頻率 | 方式 |
|----------|------|------|
| 即時監控 | 即時 | 告警 |
| 核心指標 | 每天 | 儀表板 |
| 趨勢指標 | 每週 | 週會 |
| 策略指標 | 每月 | 月度回顧 |

---

## Part 3 完成回顧

### 完成章節

| 章節 | 主題 |
|------|------|
| 15 | 品質的概念 |
| 16 | 審查的推薦方法 |
| 17 | 軟體品質保證 |
| 18 | 軟體安全工程 |
| 19 | 元件層級測試 |
| 20 | 整合層級測試 |
| 21 | 行動/特定領域測試 |
| 22 | 組態管理 |
| 23 | 度量與分析 |

### 核心收穫

1. **品質是設計出來的**，不是測試出來的
2. **安全要內建**，不是事後補
3. **測試金字塔**：單元多、整合中、E2E 少
4. **度量要可行動**，避免虛榮指標

---

## 完成確認

- [x] 完成章前預測
- [x] 讀完本章
- [x] 填寫本章一句話
- [x] 填寫 3 個關鍵概念
- [x] 填寫原則、方法、護欄
- [x] 填寫 1 個決策點
- [x] 填寫 1 個反模式
- [x] 填寫 Checklist
- [x] 完成章後練習
- [x] 完成延伸思考

**完成日期**：2025-12-27
