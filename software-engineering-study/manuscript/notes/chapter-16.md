# 第16章　審查（Review）的推薦方法 — 學習筆記

> **狀態**：✅ 已完成
> **閱讀日期**：2025-12-27
> **教材位置**：[content/chapter-16.md](../content/chapter-16.md)

---

## 章前預測（5 分鐘）

### 這章應該回答什麼問題？

1. Code Review 的目的是什麼？
2. 如何做有效的 Code Review？
3. 審查者和作者各自的角色是什麼？
4. 如何建立好的審查文化？

### 我現在的理解是什麼？

閱讀前，我的理解：
- Code Review 是找 bug 的
- Review 會拖慢開發速度
- 資深工程師審查新手的程式碼

### 我遇過哪些相關痛點？

1. **Review 變成關卡**：PR 等好幾天沒人看
2. **審查不具建設性**：只說「這樣不好」，沒說為什麼
3. **流於形式**：LGTM（Looks Good To Me）就過了

---

## 本章一句話

> **Code Review 不是找錯，而是分享知識、提升品質、建立共識的過程。好的審查文化需要及時回應、建設性回饋、對事不對人。**

---

## 3 個關鍵概念

### 概念 1：審查的多重價值

**書中定義**：

審查不只是找 bug，還有：

| 價值 | 說明 |
|------|------|
| 發現問題 | 比測試早發現問題 |
| 知識分享 | 團隊成員互相學習 |
| 提升品質 | 程式碼更好 |
| 建立共識 | 統一風格和標準 |
| 減少風險 | 多人確認 |

**我的理解**：

以前把 Review 當作「品質關卡」，現在理解它是「知識交流」。

**實際效益**：

| 投資 | 回報 |
|------|------|
| 30 分鐘 Review | 避免上線後 4 小時 debug |
| 早發現設計問題 | 避免重構 2 天 |
| 知識分享 | 減少「只有一人懂」風險 |

**研究數據**：
- Code Review 可發現 60-90% 的缺陷
- 審查投資回報率：4-8 倍

---

### 概念 2：PR 大小與審查品質

**書中定義**：

| PR 大小 | 建議 |
|---------|------|
| < 200 行 | 理想 |
| 200-400 行 | 可接受 |
| > 400 行 | 應該拆分 |

**我的理解**：

大 PR 的問題：
- 審查者注意力有限
- 難以理解上下文
- 審查品質下降
- 更容易「LGTM」敷衍過去

**拆分策略**：

```
大功能 → 拆成多個 PR
│
├─ PR 1: 資料模型（先合併）
├─ PR 2: API 層（基於 PR 1）
├─ PR 3: 前端 UI（基於 PR 2）
└─ PR 4: 測試補充
```

**經驗法則**：
> 「如果 PR 大到需要一個小時才能看完，那它太大了。」

---

### 概念 3：審查者的態度

**書中定義**：

**好的審查**：

| 做法 | 範例 |
|------|------|
| 問問題 | 「這裡為什麼這樣做？」 |
| 建議 | 「可以考慮...」 |
| 解釋 | 說明為什麼有問題 |
| 肯定 | 「這個設計很棒！」 |
| 對事不對人 | 討論程式碼，不是人 |

**壞的審查**：

| 做法 | 問題 |
|------|------|
| 「這是錯的」 | 沒有解釋 |
| 「你應該...」 | 命令語氣 |
| 「這很蠢」 | 人身攻擊 |
| 只挑毛病 | 沒有建設性 |

**我的理解**：

審查是**對話**，不是**裁判**。

**溝通改善範例**：

| 壞的 | 好的 |
|------|------|
| 「這樣寫不對」 | 「這裡可能有邊界問題，如果 x 是 null 會怎樣？」 |
| 「這太複雜」 | 「我看了幾次才懂這段，可以考慮拆成兩個函式嗎？」 |
| 「為什麼不用 X？」 | 「我之前用過 X 處理類似問題，你覺得適合嗎？」 |

---

## 原則、方法、護欄

### Code Review Checklist

| 類別 | 檢查項目 |
|------|----------|
| **正確性** | 邏輯正確嗎？邊界情況處理了嗎？ |
| **設計** | 設計合理嗎？是否過度設計？ |
| **可讀性** | 程式碼容易理解嗎？命名清楚嗎？ |
| **可維護性** | 容易修改嗎？有重複嗎？ |
| **效能** | 有效能問題嗎？ |
| **安全性** | 有安全漏洞嗎？ |
| **測試** | 有測試嗎？測試有效嗎？ |
| **標準** | 符合編碼標準嗎？ |

---

### 護欄（Guardrail）

| 危險信號 | 可能的問題 | 修正方式 |
|----------|-----------|----------|
| PR 等很久 | 審查成為瓶頸 | 設定 SLA（< 24 小時） |
| 只說 LGTM | 審查流於形式 | 使用 Checklist |
| 批評很多 | 審查變成批鬥 | 建立溝通準則 |
| 只有資深審 | 新人沒參與 | 讓新人也審查 |
| 每次都趕 | 沒時間好好審 | 減少 PR 大小 |

---

## 1 個決策點

### 決策情境

**如何分配審查者？**

### 選項對比

| 模式 | 優點 | 缺點 |
|------|------|------|
| **固定審查者** | 熟悉程式碼 | 瓶頸、知識集中 |
| **輪流審查** | 知識分散 | 可能不熟悉 |
| **領域專家** | 品質高 | 等待時間長 |
| **任何人可審** | 速度快 | 品質不一 |

### 決策準則

**根據 PR 類型選擇**：

| PR 類型 | 審查者 |
|---------|--------|
| 架構變更 | 技術負責人 + 領域專家 |
| 核心邏輯 | 熟悉該模組的人 |
| 一般功能 | 任何團隊成員 |
| 文件更新 | 任何人 |

**經驗法則**：
> 「關鍵的找專家，日常的輪流做。」

---

## 1 個反模式（Anti-pattern）

### 反模式名稱

**「橡皮圖章」審查（Rubber Stamping）**

### 錯誤做法

審查變成形式：
- 看一眼就 Approve
- 只看標題不看程式碼
- 「反正他比我資深」
- 趕時間敷衍了事

### 後果

1. **問題沒發現**：bug 進入主分支
2. **沒有知識傳遞**：沒人學到東西
3. **品質下降**：大家都不認真
4. **信任破壞**：Review 變成笑話

### 正確做法

1. **設定時間**：每天固定 30-60 分鐘 Review
2. **使用 Checklist**：有明確檢查項目
3. **留下評論**：至少問一個問題或給一個建議
4. **小 PR 優先**：容易認真看完
5. **培養文化**：審查是工作的一部分，不是額外負擔

**檢驗標準**：
> 「如果這段程式碼出問題，我的名字也在 Approve 上面，我還會這樣審嗎？」

---

## 可落地 Checklist（至少 5 條）

審查時用這份清單：

- [x] **PR 大小**：< 400 行嗎？太大應該拆分
- [x] **正確性**：邏輯對嗎？邊界情況處理了嗎？
- [x] **可讀性**：我看得懂嗎？命名清楚嗎？
- [x] **測試**：有測試嗎？測試有意義嗎？
- [x] **安全**：有明顯的安全問題嗎？
- [x] **回饋品質**：我的評論有建設性嗎？
- [x] **及時回應**：24 小時內回覆了嗎？

---

## 章後練習

### 練習：評估你的審查流程

> 目標：用本章原則評估你團隊的 Code Review

**自我評估**：

| 項目 | 現狀 | 目標 | 改善 |
|------|------|------|------|
| 平均等待時間 | 2-3 天 | < 24 小時 | 設定 SLA |
| 平均 PR 大小 | 500+ 行 | < 400 行 | 拆分 PR |
| 有用 Checklist | 沒有 | 有 | 建立 Checklist |
| 新人參與審查 | 很少 | 經常 | 輪流制 |
| 審查有建設性 | 有時 | 總是 | 溝通訓練 |

**改善計畫**：

1. **這週**：建立團隊 Review Checklist
2. **下週**：設定 PR < 400 行的規範
3. **這個月**：讓新人也參與審查
4. **持續**：每次 Retro 檢視審查品質

---

## 延伸思考

### 你遇過不好的 Review 經驗嗎？

**我的經歷**：

1. **被批評的經驗**
   - 收到「這樣不行」的評論
   - 沒說為什麼，也沒說怎麼改
   - 感覺被否定而不是被幫助

2. **等太久的經驗**
   - PR 等了一週沒人看
   - 不斷提醒很尷尬
   - 最後匆忙 Approve

**我的改變**：
- 審查時解釋「為什麼」
- 同時給正面回饋
- 設定每日 Review 時間

### 如何在速度和審查品質之間取得平衡？

**我的策略**：

1. **小 PR**：每個 PR < 400 行，容易認真審
2. **自動化**：Linter、靜態分析先跑，人審更有價值的
3. **分級審查**：
   - 架構變更：仔細審
   - 一般功能：正常審
   - 小修正：快速審
4. **時間投資**：每天固定 1 小時 Review

---

## 完成確認

- [x] 完成章前預測
- [x] 讀完本章
- [x] 填寫本章一句話
- [x] 填寫 3 個關鍵概念
- [x] 填寫原則、方法、護欄
- [x] 填寫 1 個決策點
- [x] 填寫 1 個反模式
- [x] 填寫 Checklist
- [x] 完成章後練習
- [x] 完成延伸思考

**完成日期**：2025-12-27
