# 附錄 D：最佳實踐清單

## D.1 Skills 開發清單

### D.1.1 設計階段

#### Skill 命名
- [ ] 使用清晰、描述性的名稱
- [ ] 遵循命名慣例（snake_case for files, PascalCase for classes）
- [ ] 名稱反映 Skill 的核心功能
- [ ] 避免過於通用的名稱（如 `test`、`check`）

#### SKILL.md 文檔
- [ ] 包含完整的描述（1-2 句話）
- [ ] 明確列出使用時機
- [ ] 詳細定義所有參數（類型、預設值、範圍）
- [ ] 說明返回值結構
- [ ] 提供至少 2 個使用範例
- [ ] 描述錯誤處理策略
- [ ] 列出所有依賴
- [ ] 使用適當的標籤（tags）

#### 架構設計
- [ ] 遵循單一職責原則
- [ ] 設計可組合的 Skills
- [ ] 考慮可擴展性
- [ ] 預留未來功能空間

### D.1.2 實作階段

#### 代碼品質
- [ ] 遵循 PEP 8（Python）或 ESLint（JavaScript）
- [ ] 使用類型提示（Type Hints）
- [ ] 編寫清晰的 docstrings
- [ ] 保持函數簡潔（<50 行）
- [ ] 適當的代碼註解（解釋「為什麼」而非「什麼」）

#### 參數驗證
- [ ] 使用 Pydantic 或類似工具驗證輸入
- [ ] 提供清晰的錯誤訊息
- [ ] 驗證資料範圍和格式
- [ ] 處理邊緣案例

#### 錯誤處理
- [ ] 實作完整的 try-except 塊
- [ ] 使用具體的異常類型
- [ ] 記錄錯誤詳情
- [ ] 提供可操作的錯誤訊息
- [ ] 實作重試機制（適當時）

#### 日誌記錄
- [ ] 使用適當的日誌級別（DEBUG, INFO, WARNING, ERROR）
- [ ] 記錄關鍵操作
- [ ] 包含上下文資訊（時間戳、參數等）
- [ ] 避免記錄敏感資訊

#### 測試
- [ ] 編寫單元測試（覆蓋率 > 80%）
- [ ] 編寫整合測試
- [ ] 測試邊緣案例
- [ ] 測試錯誤處理
- [ ] 使用 fixtures 管理測試數據

### D.1.3 部署階段

#### 性能優化
- [ ] 添加適當的快取
- [ ] 優化資料庫查詢
- [ ] 實作連接池
- [ ] 考慮並行執行
- [ ] 監控資源使用

#### 安全性
- [ ] 不硬編碼敏感資訊
- [ ] 使用環境變數管理配置
- [ ] 驗證和清理輸入
- [ ] 實作適當的權限檢查
- [ ] 加密敏感數據

#### 文檔
- [ ] 更新 SKILL.md
- [ ] 編寫使用範例
- [ ] 記錄已知限制
- [ ] 提供故障排除指南
- [ ] 維護變更日誌

## D.2 安全檢查清單

### D.2.1 API 安全

#### 認證與授權
- [ ] 使用強密碼策略
- [ ] 實作 API 金鑰管理
- [ ] 定期輪換金鑰
- [ ] 實作細粒度權限控制
- [ ] 記錄所有認證嘗試

#### 數據保護
- [ ] 加密傳輸中的數據（TLS 1.3+）
- [ ] 加密靜態敏感數據
- [ ] 使用安全的加密演算法（AES-256, RSA-2048+）
- [ ] 安全存儲加密金鑰
- [ ] 實作數據遮罩

#### 輸入驗證
- [ ] 驗證所有外部輸入
- [ ] 防止 SQL 注入
- [ ] 防止 XSS 攻擊
- [ ] 防止 CSRF 攻擊
- [ ] 限制輸入長度

### D.2.2 應用安全

#### 依賴管理
- [ ] 定期更新依賴套件
- [ ] 掃描已知漏洞（npm audit, safety）
- [ ] 使用鎖定文件（poetry.lock, package-lock.json）
- [ ] 審查第三方套件
- [ ] 最小化依賴數量

#### 秘密管理
- [ ] 使用秘密管理工具（Vault, AWS Secrets Manager）
- [ ] 永不提交秘密到版本控制
- [ ] 在 CI/CD 中安全注入秘密
- [ ] 定期審計秘密使用
- [ ] 實作秘密過期策略

#### 存取控制
- [ ] 實作最小權限原則
- [ ] 使用 RBAC 或 ABAC
- [ ] 審計存取日誌
- [ ] 定期審查權限
- [ ] 實作多因素認證（MFA）

### D.2.3 基礎設施安全

#### 網路安全
- [ ] 使用防火牆
- [ ] 配置安全組（Security Groups）
- [ ] 實作 DDoS 防護
- [ ] 使用 VPN 或 VPC
- [ ] 監控異常流量

#### 容器安全
- [ ] 使用官方基礎鏡像
- [ ] 定期更新鏡像
- [ ] 掃描鏡像漏洞
- [ ] 最小化鏡像大小
- [ ] 不以 root 運行容器

#### 備份與恢復
- [ ] 定期備份數據
- [ ] 測試恢復流程
- [ ] 加密備份數據
- [ ] 異地備份
- [ ] 記錄備份狀態

## D.3 性能優化清單

### D.3.1 代碼層級

#### 演算法優化
- [ ] 選擇適當的數據結構
- [ ] 避免不必要的迴圈
- [ ] 使用生成器（generators）處理大數據
- [ ] 快取昂貴的計算
- [ ] 避免過早優化

#### 並行與非同步
- [ ] 使用 asyncio 處理 I/O 密集任務
- [ ] 使用 multiprocessing 處理 CPU 密集任務
- [ ] 避免阻塞操作
- [ ] 使用連接池
- [ ] 實作適當的超時

#### 資料庫優化
- [ ] 創建適當的索引
- [ ] 優化查詢（避免 N+1 問題）
- [ ] 使用查詢結果快取
- [ ] 實作連接池
- [ ] 批次處理寫入操作

### D.3.2 系統層級

#### 資源管理
- [ ] 設置適當的資源限制
- [ ] 監控記憶體使用
- [ ] 監控 CPU 使用
- [ ] 監控網路頻寬
- [ ] 實作自動擴展

#### 快取策略
- [ ] 實作多層快取
- [ ] 選擇適當的快取策略（LRU, LFU）
- [ ] 設置適當的 TTL
- [ ] 實作快取預熱
- [ ] 處理快取失效

#### 負載平衡
- [ ] 使用負載平衡器
- [ ] 實作健康檢查
- [ ] 配置適當的路由策略
- [ ] 實作會話持久性（如需要）
- [ ] 監控負載分佈

## D.4 部署檢查清單

### D.4.1 部署前

#### 代碼審查
- [ ] 所有 PR 已審查
- [ ] 通過所有 CI 檢查
- [ ] 代碼覆蓋率達標
- [ ] 無高危漏洞
- [ ] 文檔已更新

#### 測試驗證
- [ ] 單元測試通過
- [ ] 整合測試通過
- [ ] E2E 測試通過
- [ ] 性能測試通過
- [ ] 安全掃描通過

#### 環境準備
- [ ] 環境變數已配置
- [ ] 秘密已注入
- [ ] 數據庫遷移已準備
- [ ] 依賴服務已確認
- [ ] 備份已完成

### D.4.2 部署中

#### 部署流程
- [ ] 使用藍綠部署或滾動更新
- [ ] 監控部署進度
- [ ] 驗證健康檢查
- [ ] 檢查日誌錯誤
- [ ] 準備回滾計劃

#### 數據遷移
- [ ] 備份現有數據
- [ ] 測試遷移腳本
- [ ] 執行遷移
- [ ] 驗證數據完整性
- [ ] 保留回滾腳本

#### 監控
- [ ] 監控應用指標
- [ ] 監控錯誤率
- [ ] 監控回應時間
- [ ] 監控資源使用
- [ ] 設置告警

### D.4.3 部署後

#### 驗證
- [ ] 冒煙測試
- [ ] 關鍵路徑測試
- [ ] 性能基準測試
- [ ] 檢查日誌
- [ ] 用戶反饋收集

#### 文檔更新
- [ ] 更新變更日誌
- [ ] 更新版本號
- [ ] 更新部署文檔
- [ ] 通知相關方
- [ ] 記錄經驗教訓

#### 清理
- [ ] 刪除舊版本（保留 N 個）
- [ ] 清理臨時文件
- [ ] 驗證備份
- [ ] 更新監控儀表板
- [ ] 記錄部署時間

## D.5 監控配置清單

### D.5.1 應用監控

#### 基礎指標
- [ ] 請求率（RPS）
- [ ] 錯誤率
- [ ] 平均回應時間
- [ ] P95/P99 延遲
- [ ] 並發連接數

#### 業務指標
- [ ] 測試執行數
- [ ] 測試成功率
- [ ] 平均測試時間
- [ ] API 使用量
- [ ] 成本追蹤

#### 告警配置
- [ ] 錯誤率 > 5%
- [ ] 回應時間 > 2秒
- [ ] CPU 使用 > 80%
- [ ] 記憶體使用 > 85%
- [ ] 磁碟使用 > 90%

### D.5.2 基礎設施監控

#### 資源監控
- [ ] CPU 使用率
- [ ] 記憶體使用率
- [ ] 磁碟 I/O
- [ ] 網路流量
- [ ] 容器健康狀態

#### 服務監控
- [ ] 資料庫連接池
- [ ] Redis 記憶體使用
- [ ] 佇列長度
- [ ] 背景任務狀態
- [ ] 外部服務可用性

## D.6 故障排除指南

### D.6.1 常見問題

#### API 連接問題
**症狀**: "Connection timeout" 或 "API key invalid"
**檢查清單**:
- [ ] 驗證 API 金鑰格式
- [ ] 檢查網路連接
- [ ] 確認 API 配額
- [ ] 檢查環境變數
- [ ] 驗證 API 端點

#### 測試失敗
**症狀**: 測試意外失敗或超時
**檢查清單**:
- [ ] 檢查網站可訪問性
- [ ] 驗證測試數據
- [ ] 檢查瀏覽器版本
- [ ] 查看詳細日誌
- [ ] 檢查並行執行衝突

#### 性能問題
**症狀**: 執行緩慢或資源耗盡
**檢查清單**:
- [ ] 分析資源使用
- [ ] 檢查資料庫查詢
- [ ] 驗證快取效率
- [ ] 檢查並行配置
- [ ] 審查慢日誌

### D.6.2 調試策略

#### 逐步調試
1. **重現問題**
   - [ ] 記錄錯誤訊息
   - [ ] 收集日誌
   - [ ] 確認環境
   - [ ] 嘗試重現

2. **隔離問題**
   - [ ] 最小化測試案例
   - [ ] 排除外部因素
   - [ ] 測試單一組件
   - [ ] 二分查找問題點

3. **分析原因**
   - [ ] 檢查日誌
   - [ ] 查看堆疊追蹤
   - [ ] 檢查資源使用
   - [ ] 審查最近變更

4. **修復驗證**
   - [ ] 實作修復
   - [ ] 編寫測試
   - [ ] 驗證修復
   - [ ] 文檔記錄

## D.7 持續改進清單

### D.7.1 定期審查

#### 每週
- [ ] 審查錯誤日誌
- [ ] 檢查性能指標
- [ ] 更新依賴套件
- [ ] 團隊同步
- [ ] 優先級調整

#### 每月
- [ ] 代碼品質審查
- [ ] 測試覆蓋率分析
- [ ] 技術債務評估
- [ ] 安全掃描
- [ ] 文檔更新

#### 每季
- [ ] 架構審查
- [ ] 技術棧評估
- [ ] 工具效能評估
- [ ] 培訓需求評估
- [ ] ROI 分析

### D.7.2 知識管理

#### 文檔維護
- [ ] 保持文檔最新
- [ ] 記錄決策原因
- [ ] 分享經驗教訓
- [ ] 創建故障排除指南
- [ ] 維護 FAQ

#### 團隊成長
- [ ] 定期技術分享
- [ ] 程式碼審查
- [ ] 配對編程
- [ ] 技術培訓
- [ ] 外部學習

---

*這些清單應根據團隊和專案的實際情況調整。定期審查和更新最佳實踐是持續改進的關鍵。*
