# ç¬¬ 3 ç« ï¼šSkills æ ¸å¿ƒæ¦‚å¿µèˆ‡ SKILL.md èªæ³•

> *ã€ŒSimplicity is the ultimate sophistication.ã€ - Leonardo da Vinci*

åœ¨ç¬¬ 2 ç« ä¸­ï¼Œæˆ‘å€‘å‰µå»ºäº†ç¬¬ä¸€å€‹ Skillâ€”â€”ç¶²ç«™å¥åº·æª¢æŸ¥ã€‚ä½†é‚£åªæ˜¯å†°å±±ä¸€è§’ã€‚è¦çœŸæ­£æŒæ¡ Claude Code Skills é–‹ç™¼ï¼Œä½ éœ€è¦æ·±å…¥ç†è§£ Skills çš„æ ¸å¿ƒæ¶æ§‹ã€è¨­è¨ˆåŸå‰‡å’Œæœ€ä½³å¯¦è¸ã€‚

æœ¬ç« å°‡å¸¶ä½ æ·±å…¥æ¢è¨ï¼š

- **SKILL.md å®Œæ•´èªæ³•è¦ç¯„**ï¼šå¦‚ä½•æ’°å¯«æ¸…æ™°ã€å®Œæ•´çš„ Skill å®šç¾©
- **ä¸‰å±¤æ¼¸é€²å¼æ­éœ²ç³»çµ±**ï¼šClaude å¦‚ä½•é«˜æ•ˆç™¼ç¾å’Œä½¿ç”¨ Skills
- **Skills ç”Ÿå‘½é€±æœŸ**ï¼šå¾ç™¼ç¾åˆ°åŸ·è¡Œçš„å®Œæ•´æµç¨‹
- **åƒæ•¸é©—è­‰èˆ‡éŒ¯èª¤è™•ç†**ï¼šæ‰“é€ å¥å£¯çš„ç”Ÿç”¢ç´š Skills
- **é–‹ç™¼æœ€ä½³å¯¦è¸**ï¼šç¶“éé©—è­‰çš„è¨­è¨ˆæ¨¡å¼å’Œç­–ç•¥

å­¸å®Œæœ¬ç« ï¼Œä½ å°‡å…·å‚™è¨­è¨ˆå’Œå¯¦ä½œå°ˆæ¥­ç´š Skills çš„èƒ½åŠ›ã€‚

## 3.1 SKILL.md å®Œæ•´èªæ³•è¦ç¯„

SKILL.md æ˜¯ Skills ç³»çµ±çš„æ ¸å¿ƒã€‚å®ƒä¸åƒ…æ˜¯æ–‡æª”ï¼Œæ›´æ˜¯ Claude ç†è§£å’Œä½¿ç”¨ Skill çš„é—œéµä»‹é¢ã€‚ä¸€å€‹è¨­è¨ˆè‰¯å¥½çš„ SKILL.md èƒ½è®“ Claude æº–ç¢ºç†è§£ Skill çš„ç”¨é€”ã€æ­£ç¢ºæº–å‚™åƒæ•¸ã€å„ªé›…è™•ç†éŒ¯èª¤ã€‚

### 3.1.1 åŸºæœ¬çµæ§‹

SKILL.md éµå¾ªæ¨™æº–çš„ Markdown æ ¼å¼ï¼Œä½†æœ‰ç‰¹å®šçš„ç« ç¯€çµæ§‹ï¼š

```markdown
# Skill Name

## Description
[ç°¡çŸ­æè¿°ï¼Œ1-2 å¥è©±ï¼Œæ¸…æ™°èªªæ˜ Skill çš„æ ¸å¿ƒåŠŸèƒ½]

## When to use
[ä½¿ç”¨æ™‚æ©Ÿï¼Œåˆ—è¡¨å½¢å¼ï¼Œå¹«åŠ© Claude å¿«é€Ÿåˆ¤æ–·æ˜¯å¦é©ç”¨]

## Parameters
[åƒæ•¸å®šç¾©ï¼ŒåŒ…å«é¡å‹ã€æè¿°ã€é è¨­å€¼ã€ç¯„åœ]

## Returns
[è¿”å›å€¼èªªæ˜ï¼Œè©³ç´°æè¿°è¿”å›æ•¸æ“šçš„çµæ§‹]

## Implementation
[å¯¦ä½œèªªæ˜ï¼Œè§£é‡‹ Skill çš„åŸ·è¡Œé‚è¼¯]

## Examples
[ä½¿ç”¨ç¯„ä¾‹ï¼ŒåŒ…å«è¼¸å…¥å’Œè¼¸å‡º]

## Error handling
[éŒ¯èª¤è™•ç†ç­–ç•¥ï¼Œèªªæ˜å„ç¨®éŒ¯èª¤æƒ…æ³çš„è™•ç†æ–¹å¼]

## Dependencies
[ä¾è³´å¥—ä»¶ï¼Œåˆ—å‡ºæ‰€æœ‰å¤–éƒ¨ä¾è³´]

## Metadata
[å…ƒæ•¸æ“šï¼ŒåŒ…å«ä½œè€…ã€ç‰ˆæœ¬ã€ç©©å®šæ€§ç­‰è³‡è¨Š]

## Tags
[æ¨™ç±¤ï¼Œç”¨æ–¼æœç´¢å’Œåˆ†é¡]
```

é€™å€‹çµæ§‹çœ‹ä¼¼ç°¡å–®ï¼Œä½†æ¯å€‹ç« ç¯€éƒ½æœ‰å…¶ç‰¹å®šç›®çš„ã€‚è®“æˆ‘å€‘é€ä¸€æ·±å…¥æ¢è¨ã€‚

### 3.1.2 Descriptionï¼šç¬¬ä¸€å°è±¡å¾ˆé‡è¦

**Description** æ˜¯ Claude çœ‹åˆ°çš„ç¬¬ä¸€ä»¶äº‹ã€‚å®ƒå¿…é ˆåœ¨ 1-2 å¥è©±å…§æ¸…æ™°å‚³é” Skill çš„æ ¸å¿ƒåŠŸèƒ½ã€‚

**å¥½çš„æè¿°ç¯„ä¾‹**ï¼š

```markdown
## Description
Performs comprehensive health checks on websites, including HTTP status verification,
response time measurement, and basic HTML structure validation.
```

é€™å€‹æè¿°ï¼š
- âœ… æ˜ç¢ºèªªæ˜åšä»€éº¼ï¼ˆhealth checks on websitesï¼‰
- âœ… åˆ—å‡ºé—œéµåŠŸèƒ½ï¼ˆHTTP status, response time, HTML validationï¼‰
- âœ… ç°¡æ½”ä½†è³‡è¨Šè±å¯Œ

**ä¸å¥½çš„æè¿°ç¯„ä¾‹**ï¼š

```markdown
## Description
This skill checks if a website is working.
```

é€™å€‹æè¿°ï¼š
- âŒ å¤ªæ¨¡ç³Šï¼ˆ"working" æ˜¯ä»€éº¼æ„æ€ï¼Ÿï¼‰
- âŒ ç¼ºå°‘ç´°ç¯€ï¼ˆæª¢æŸ¥ä»€éº¼ï¼Ÿå¦‚ä½•æª¢æŸ¥ï¼Ÿï¼‰
- âŒ ä¸å°ˆæ¥­ï¼ˆå¤ªå£èªåŒ–ï¼‰

### 3.1.3 When to useï¼šç²¾æº–åŒ¹é…å ´æ™¯

**When to use** å¹«åŠ© Claude åˆ¤æ–·æ˜¯å¦æ‡‰è©²ä½¿ç”¨é€™å€‹ Skillã€‚å®ƒæ‡‰è©²åˆ—å‡ºå…·é«”çš„ä½¿ç”¨å ´æ™¯ï¼Œè€ŒéæŠ½è±¡çš„æè¿°ã€‚

**å¥½çš„ç¯„ä¾‹**ï¼š

```markdown
## When to use
- Verify website accessibility after deployment
- Monitor production services uptime
- Validate HTTP endpoints in CI/CD pipelines
- Check website response time for performance monitoring
- Ensure websites return expected HTTP status codes
```

é€™äº›å ´æ™¯ï¼š
- âœ… å…·é«”ä¸”å¯æ“ä½œ
- âœ… æ¶µè“‹ä¸åŒçš„ä½¿ç”¨æƒ…å¢ƒ
- âœ… ä½¿ç”¨å‹•è©é–‹é ­ï¼ˆVerify, Monitor, Validateï¼‰
- âœ… åŒ…å«ä¸Šä¸‹æ–‡ï¼ˆdeployment, CI/CD, performanceï¼‰

**ä¸å¥½çš„ç¯„ä¾‹**ï¼š

```markdown
## When to use
- When you want to check websites
- For testing
- Any time you need to see if a site is up
```

é€™äº›å ´æ™¯ï¼š
- âŒ å¤ªæ¨¡ç³Š
- âŒ ç¼ºå°‘å…·é«”ä¸Šä¸‹æ–‡
- âŒ æ²’æœ‰å¹«åŠ© Claude åšå‡ºæ˜ç¢ºåˆ¤æ–·

### 3.1.4 Parametersï¼šæ¸…æ™°çš„ä»‹é¢å®šç¾©

åƒæ•¸å®šç¾©æ˜¯ Skill ä»‹é¢çš„æ ¸å¿ƒã€‚æ¯å€‹åƒæ•¸éƒ½æ‡‰è©²åŒ…å«ï¼š

1. **åç¨±**ï¼šä½¿ç”¨ snake_case
2. **å¿…è¦æ€§**ï¼šrequired æˆ– optional
3. **é¡å‹**ï¼šstring, integer, boolean, array, object
4. **æè¿°**ï¼šæ¸…æ™°èªªæ˜ç”¨é€”
5. **ç´„æŸ**ï¼šç¯„åœã€æ ¼å¼ã€é è¨­å€¼
6. **ç¯„ä¾‹**ï¼šå…·é«”çš„ä½¿ç”¨ä¾‹å­

**å®Œæ•´çš„åƒæ•¸å®šç¾©ç¯„ä¾‹**ï¼š

```markdown
## Parameters

### url
- **Required**: Yes
- **Type**: string
- **Description**: The website URL to check
- **Format**: Must be a valid HTTP or HTTPS URL
- **Example**: `"https://example.com"` or `"http://api.example.com/health"`

### expected_status
- **Required**: No
- **Type**: integer
- **Description**: Expected HTTP status code to validate against
- **Default**: `200`
- **Range**: 100-599 (valid HTTP status codes)
- **Example**: `200`, `201`, `204`
- **Note**: Use 200 for standard pages, 201 for resource creation endpoints

### timeout
- **Required**: No
- **Type**: integer
- **Description**: Maximum wait time in seconds before considering the request failed
- **Default**: `30`
- **Range**: 1-300 seconds
- **Example**: `60`
- **Recommendation**: Use 10-30s for fast sites, 60s+ for slower APIs

### retry_count
- **Required**: No
- **Type**: integer
- **Description**: Number of retry attempts on failure before giving up
- **Default**: `3`
- **Range**: 0-10
- **Example**: `5`
- **Note**: Retries use exponential backoff (2^n seconds between attempts)

### headers
- **Required**: No
- **Type**: object (key-value pairs)
- **Description**: Custom HTTP headers to include in the request
- **Default**: `null`
- **Example**: `{"Authorization": "Bearer token123", "User-Agent": "WebGuard/1.0"}`
- **Note**: Common use cases include authentication tokens and custom user agents
```

é€™ç¨®è©³ç´°ç¨‹åº¦ç¢ºä¿ï¼š
- Claude èƒ½å¤ æ­£ç¢ºæº–å‚™åƒæ•¸
- ç”¨æˆ¶ç†è§£å¦‚ä½•ä½¿ç”¨ Skill
- è‡ªå‹•é©—è­‰æˆç‚ºå¯èƒ½
- éŒ¯èª¤è¨Šæ¯å¯ä»¥æ›´å…·é«”

### 3.1.5 Returnsï¼šæ˜ç¢ºçš„è¼¸å‡ºå¥‘ç´„

è¿”å›å€¼å®šç¾©æ‡‰è©²åƒ API æ–‡æª”ä¸€æ¨£æ¸…æ™°ã€‚ä½¿ç”¨çµæ§‹åŒ–æ ¼å¼èªªæ˜è¿”å›æ•¸æ“šçš„æ¯å€‹æ¬„ä½ã€‚

**å®Œæ•´çš„è¿”å›å€¼å®šç¾©ç¯„ä¾‹**ï¼š

```markdown
## Returns

Returns a JSON object with the following structure:

```json
{
  "is_healthy": boolean,
  "status_code": integer,
  "response_time_ms": float,
  "page_title": string | null,
  "errors": array of strings,
  "url": string,
  "checked_at": string (ISO 8601 timestamp)
}
```

### Field Descriptions

**is_healthy** (boolean)
- `true`: Website is accessible and returned expected status
- `false`: Website is inaccessible, returned unexpected status, or encountered errors

**status_code** (integer)
- HTTP status code received from the server
- `0` if no response was received (timeout or connection error)
- Range: 0, 100-599

**response_time_ms** (float)
- Time taken to receive the response, in milliseconds
- Measured from request initiation to first byte received
- `0` if request failed before receiving response

**page_title** (string | null)
- Title extracted from HTML `<title>` tag
- `null` if:
  - Page has no title tag
  - Response is not HTML
  - Request failed

**errors** (array of strings)
- List of error messages encountered during the check
- Empty array `[]` if no errors
- Common errors:
  - `"Connection timeout (>30s)"`
  - `"Invalid URL format"`
  - `"Unexpected status code: 404 (expected 200)"`
  - `"Failed to parse HTML"`

**url** (string)
- The URL that was checked (echoed back for confirmation)

**checked_at** (string)
- ISO 8601 timestamp of when the check was performed
- Example: `"2025-01-15T10:30:22.123Z"`
- Timezone: UTC
```

### 3.1.6 Examplesï¼šå¯¦éš›ä½¿ç”¨æ¼”ç¤º

ç¯„ä¾‹æ˜¯æœ€æœ‰åŠ›çš„æ–‡æª”ã€‚æä¾›å¤šå€‹ç¯„ä¾‹ï¼Œæ¶µè“‹å¸¸è¦‹å ´æ™¯å’Œé‚Šç·£æ¡ˆä¾‹ã€‚

**å®Œæ•´çš„ç¯„ä¾‹ç« ç¯€**ï¼š

```markdown
## Examples

### Example 1: Basic Health Check (Success)

**Scenario**: Check if a production website is accessible

**Input**:
```json
{
  "url": "https://example.com"
}
```

**Process**:
1. Validate URL format âœ“
2. Send GET request to https://example.com
3. Receive response in 245ms
4. Status code: 200 (matches default expected_status)
5. Parse HTML and extract title
6. Mark as healthy

**Output**:
```json
{
  "is_healthy": true,
  "status_code": 200,
  "response_time_ms": 245.67,
  "page_title": "Example Domain",
  "errors": [],
  "url": "https://example.com",
  "checked_at": "2025-01-15T10:30:22.123Z"
}
```

---

### Example 2: Custom Status Code and Timeout

**Scenario**: Check API endpoint that returns 201 on success

**Input**:
```json
{
  "url": "https://api.example.com/health",
  "expected_status": 201,
  "timeout": 60
}
```

**Output**:
```json
{
  "is_healthy": true,
  "status_code": 201,
  "response_time_ms": 523.89,
  "page_title": null,
  "errors": [],
  "url": "https://api.example.com/health",
  "checked_at": "2025-01-15T10:31:45.789Z"
}
```

**Note**: page_title is null because API returns JSON, not HTML

---

### Example 3: Timeout Failure with Retries

**Scenario**: Website is slow and exceeds timeout

**Input**:
```json
{
  "url": "https://very-slow-site.com",
  "timeout": 5,
  "retry_count": 3
}
```

**Process**:
1. Attempt 1: Timeout after 5s
2. Wait 2s (exponential backoff)
3. Attempt 2: Timeout after 5s
4. Wait 4s (exponential backoff)
5. Attempt 3: Timeout after 5s
6. Wait 8s (exponential backoff)
7. Attempt 4: Timeout after 5s
8. Max retries reached, mark as unhealthy

**Output**:
```json
{
  "is_healthy": false,
  "status_code": 0,
  "response_time_ms": 5000,
  "page_title": null,
  "errors": [
    "Connection timeout (>5s)",
    "Maximum retry attempts (3) reached"
  ],
  "url": "https://very-slow-site.com",
  "checked_at": "2025-01-15T10:35:47.456Z"
}
```

---

### Example 4: Invalid URL

**Scenario**: User provides malformed URL

**Input**:
```json
{
  "url": "not-a-valid-url"
}
```

**Output**:
```json
{
  "is_healthy": false,
  "status_code": 0,
  "response_time_ms": 0,
  "page_title": null,
  "errors": [
    "Invalid URL format: must start with http:// or https://"
  ],
  "url": "not-a-valid-url",
  "checked_at": "2025-01-15T10:36:12.789Z"
}
```

**Note**: Early validation prevents unnecessary network requests

---

### Example 5: Unexpected Status Code

**Scenario**: Website returns 404 but we expected 200

**Input**:
```json
{
  "url": "https://example.com/nonexistent-page",
  "expected_status": 200
}
```

**Output**:
```json
{
  "is_healthy": false,
  "status_code": 404,
  "response_time_ms": 187.23,
  "page_title": "404 - Page Not Found",
  "errors": [
    "Unexpected status code: 404 (expected 200)"
  ],
  "url": "https://example.com/nonexistent-page",
  "checked_at": "2025-01-15T10:37:33.012Z"
}
```

**Note**: Still captures response details even though status doesn't match
```

é€™äº›ç¯„ä¾‹ï¼š
- âœ… æ¶µè“‹æˆåŠŸå’Œå¤±æ•—æƒ…æ³
- âœ… é¡¯ç¤ºå¯¦éš›çš„è¼¸å…¥/è¼¸å‡º
- âœ… è§£é‡‹åŸ·è¡Œæµç¨‹
- âœ… åŒ…å«å¯¦ç”¨çš„è¨»è§£

### 3.1.7 Error Handlingï¼šå„ªé›…çš„å¤±æ•—

éŒ¯èª¤è™•ç†ç« ç¯€æ‡‰è©²èªªæ˜ Skill å¦‚ä½•è™•ç†å„ç¨®ç•°å¸¸æƒ…æ³ã€‚

```markdown
## Error Handling

This skill implements comprehensive error handling with graceful degradation:

### Error Categories

**1. Validation Errors** (fail fast, no retries)
- Invalid URL format â†’ Return immediately with clear error message
- Invalid parameter types â†’ Return validation error
- Out-of-range values â†’ Return constraint violation error

**2. Network Errors** (retry with exponential backoff)
- Connection timeout â†’ Retry up to `retry_count` times
- DNS resolution failure â†’ Retry with backoff
- SSL/TLS errors â†’ Retry once, then report error

**3. HTTP Errors** (context-dependent)
- 4xx Client Errors (400-499) â†’ No retry, report as unhealthy
- 5xx Server Errors (500-599) â†’ Retry up to `retry_count` times
- Unexpected status codes â†’ Report but don't fail completely

**4. Parsing Errors** (graceful degradation)
- Invalid HTML â†’ Mark page_title as null, continue check
- Missing title tag â†’ Set page_title to null, mark as healthy if status matches

### Retry Strategy

Uses **exponential backoff** for transient errors:

```
Attempt 1: Immediate
Attempt 2: Wait 2^1 = 2 seconds
Attempt 3: Wait 2^2 = 4 seconds
Attempt 4: Wait 2^3 = 8 seconds
...
Maximum wait: 60 seconds (capped)
```

### Error Message Format

All errors are returned in a structured format:

```json
{
  "is_healthy": false,
  "errors": [
    "<Error Type>: <Specific Details>",
    "<Actionable Suggestion (if applicable)>"
  ]
}
```

**Examples**:
- `"Connection timeout (>30s)"`
- `"Invalid URL format: must start with http:// or https://"`
- `"Unexpected status code: 404 (expected 200)"`
- `"Maximum retry attempts (3) reached"`

### Logging

All errors are logged with appropriate levels:
- **ERROR**: Connection failures, timeouts after retries
- **WARNING**: Unexpected status codes, parsing failures
- **INFO**: Successful retries, validation warnings
```

## 3.2 ä¸‰å±¤æ¼¸é€²å¼æ­éœ²ç³»çµ±è©³è§£

Claude Code Skills ä½¿ç”¨**ä¸‰å±¤æ¼¸é€²å¼æ­éœ²ï¼ˆProgressive Disclosureï¼‰**ç³»çµ±ï¼Œé€™æ˜¯ä¸€å€‹ç¶“éç²¾å¿ƒè¨­è¨ˆçš„æ¶æ§‹ï¼Œèƒ½å¤ åœ¨æ€§èƒ½ã€å¯ç”¨æ€§å’ŒåŠŸèƒ½æ€§ä¹‹é–“å–å¾—å®Œç¾å¹³è¡¡ã€‚

### 3.2.1 ç‚ºä»€éº¼éœ€è¦æ¼¸é€²å¼æ­éœ²ï¼Ÿ

æƒ³åƒä¸€ä¸‹ï¼Œå¦‚æœ Claude æ¯æ¬¡éœ€è¦é¸æ“‡ Skill æ™‚ï¼Œéƒ½è¦è¼‰å…¥æ‰€æœ‰ Skills çš„å®Œæ•´æ–‡æª”â€”â€”åŒ…æ‹¬è©³ç´°çš„å¯¦ä½œèªªæ˜ã€å®Œæ•´çš„ç¯„ä¾‹ã€éŒ¯èª¤è™•ç†é‚è¼¯ç­‰ã€‚é€™æœƒå°è‡´ï¼š

- ğŸŒ **æ€§èƒ½å•é¡Œ**ï¼šå¤§é‡ä¸å¿…è¦çš„ token ä½¿ç”¨
- ğŸ’° **æˆæœ¬å•é¡Œ**ï¼šAPI èª¿ç”¨æˆæœ¬é¡¯è‘—å¢åŠ 
- ğŸ˜µ **æ±ºç­–å›°é›£**ï¼šè³‡è¨Šéè¼‰å°è‡´é¸æ“‡å›°é›£

æ¼¸é€²å¼æ­éœ²è§£æ±ºäº†é€™äº›å•é¡Œã€‚Claude åªåœ¨éœ€è¦æ™‚æ‰è¼‰å…¥æ›´æ·±å±¤çš„è³‡è¨Šï¼Œå°±åƒä½ ç€è¦½ç¶²ç«™æ™‚åªçœ‹æ¨™é¡Œï¼Œé»æ“Šå¾Œæ‰è¼‰å…¥å®Œæ•´å…§å®¹ã€‚

### 3.2.2 Layer 1: ç™¼ç¾å±¤ï¼ˆDiscovery Layerï¼‰

**ç›®çš„**ï¼šå¹«åŠ© Claude **å¿«é€Ÿæ±ºå®š**æ˜¯å¦ä½¿ç”¨æ­¤ Skill

**åŒ…å«å…§å®¹**ï¼š
- Skill åç¨±
- ç°¡çŸ­æè¿°ï¼ˆ1-2 å¥è©±ï¼‰
- ä½¿ç”¨æ™‚æ©Ÿï¼ˆWhen to useï¼‰
- Tagsï¼ˆæ¨™ç±¤ï¼‰

**ç¯„ä¾‹**ï¼š

```markdown
# Web Health Check

Performs comprehensive health checks on websites, including HTTP status
verification, response time measurement, and basic HTML structure validation.

## When to use
- Verify website accessibility after deployment
- Monitor production services uptime
- Validate HTTP endpoints in CI/CD pipelines

## Tags
web, monitoring, health-check, http, reliability
```

**è¨­è¨ˆåŸå‰‡**ï¼š

1. **ç°¡æ½”æ˜äº†**ï¼š
   - æ¯å€‹å¥å­éƒ½è¦æœ‰æ„ç¾©
   - é¿å…å†—é•·çš„æè¿°
   - ä½¿ç”¨æ¸…æ™°çš„å°ˆæ¥­è¡“èª

2. **é—œéµè©è±å¯Œ**ï¼š
   - Tags åŒ…å«æœç´¢é—œéµè©
   - æè¿°ä¸­ä½¿ç”¨é ˜åŸŸè¡“èªï¼ˆHTTP, deployment, CI/CDï¼‰
   - ä½¿ç”¨æ™‚æ©Ÿè¦†è“‹ä¸»è¦å ´æ™¯

3. **å¿«é€Ÿæƒæ**ï¼š
   - çµæ§‹æ¸…æ™°
   - åˆ—è¡¨æ ¼å¼æ˜“æ–¼é–±è®€
   - è¦–è¦ºå±¤æ¬¡åˆ†æ˜

**å¯¦éš›æ•ˆæœ**ï¼š

ç•¶ç”¨æˆ¶èªªã€Œæª¢æŸ¥æˆ‘çš„ç¶²ç«™æ˜¯å¦æ­£å¸¸é‹è¡Œã€æ™‚ï¼ŒClaude æœƒï¼š
1. æƒææ‰€æœ‰ Skills çš„ Layer 1
2. è­˜åˆ¥åˆ° "Web Health Check" åŒ…å«é—œéµè© "website"ã€"monitoring"
3. ç¢ºèª "When to use" ä¸­æœ‰ "Monitor production services uptime"
4. **æ±ºå®šä½¿ç”¨é€™å€‹ Skill**ï¼Œé€²å…¥ Layer 2

æ•´å€‹éç¨‹åªéœ€è¼‰å…¥å¹¾ç™¾å€‹ tokensï¼Œæ±ºç­–é€Ÿåº¦æ¥µå¿«ã€‚

### 3.2.3 Layer 2: æº–å‚™å±¤ï¼ˆPreparation Layerï¼‰

**ç›®çš„**ï¼šæä¾›**è¶³å¤ è³‡è¨Š**æº–å‚™åŸ·è¡Œ

**åŒ…å«å…§å®¹**ï¼š
- å®Œæ•´åƒæ•¸å®šç¾©
- è¿”å›å€¼èªªæ˜
- åŸºæœ¬ç¯„ä¾‹
- ä¾è³´èªªæ˜

**ç¯„ä¾‹**ï¼š

```markdown
## Parameters

### url (required, string)
The website URL to check. Must be a valid HTTP/HTTPS URL.
Example: `"https://example.com"`

### expected_status (optional, integer)
Expected HTTP status code. Default: `200`. Range: 100-599.

### timeout (optional, integer)
Timeout in seconds. Default: `30`. Range: 1-300.

## Returns
```json
{
  "is_healthy": boolean,
  "status_code": integer,
  "response_time_ms": float,
  "page_title": string | null,
  "errors": array
}
```

## Dependencies
- requests>=2.31.0
- beautifulsoup4>=4.12.0

## Basic Example
```json
Input: {"url": "https://example.com"}
Output: {"is_healthy": true, "status_code": 200, ...}
```
```

**è¨­è¨ˆåŸå‰‡**ï¼š

1. **è¶³å¤ çš„ä¸Šä¸‹æ–‡**ï¼š
   - åƒæ•¸èªªæ˜æ¸…æ¥šä½†ä¸å†—é•·
   - æä¾›å¿…è¦çš„ç´„æŸè³‡è¨Š
   - åŒ…å«ä¸€å€‹åŸºæœ¬ç¯„ä¾‹

2. **æ¸…æ™°çš„ä»‹é¢å®šç¾©**ï¼š
   - æ˜ç¢ºå€åˆ† required/optional
   - èªªæ˜é è¨­å€¼å’Œç¯„åœ
   - è¿”å›å€¼çµæ§‹æ¸…æ™°

3. **æœ€å°å¿…è¦è³‡è¨Š**ï¼š
   - ä¸åŒ…å«è©³ç´°å¯¦ä½œé‚è¼¯
   - ä¸åŒ…å«æ‰€æœ‰é‚Šç·£æ¡ˆä¾‹
   - åªæä¾›æº–å‚™åŸ·è¡Œæ‰€éœ€çš„è³‡è¨Š

**å¯¦éš›æ•ˆæœ**ï¼š

Claude å·²ç¶“æ±ºå®šä½¿ç”¨é€™å€‹ Skillï¼Œç¾åœ¨éœ€è¦æº–å‚™åƒæ•¸ï¼š
1. è¼‰å…¥ Layer 2
2. è§£æç”¨æˆ¶è«‹æ±‚ï¼šã€Œæª¢æŸ¥ https://example.com æ˜¯å¦æ­£å¸¸ã€
3. æå–åƒæ•¸ï¼š`url = "https://example.com"`
4. æŸ¥çœ‹å…¶ä»–åƒæ•¸æ˜¯å¦éœ€è¦ï¼štimeout? expected_status?
5. ä½¿ç”¨é è¨­å€¼ï¼š`timeout=30, expected_status=200`
6. **æº–å‚™å°±ç·’**ï¼Œé€²å…¥åŸ·è¡Œéšæ®µ

### 3.2.4 Layer 3: åŸ·è¡Œå±¤ï¼ˆExecution Layerï¼‰

**ç›®çš„**ï¼šæä¾›**å®Œæ•´çš„å¯¦ä½œé‚è¼¯**å’Œè©³ç´°èªªæ˜

**åŒ…å«å…§å®¹**ï¼š
- è©³ç´°çš„å¯¦ä½œèªªæ˜ï¼ˆImplementationï¼‰
- å®Œæ•´çš„ç¯„ä¾‹ï¼ˆåŒ…å«å¤šç¨®å ´æ™¯ï¼‰
- éŒ¯èª¤è™•ç†ç­–ç•¥
- é‚Šç·£æ¡ˆä¾‹è™•ç†
- æ€§èƒ½è€ƒé‡
- æ•…éšœæ’é™¤æŒ‡å—

**ç¯„ä¾‹**ï¼š

```markdown
## Implementation

This skill performs health checks through the following steps:

### Step 1: URL Validation
- Verify URL starts with http:// or https://
- Parse URL structure using urllib.parse
- Return early if URL is invalid (no network request)

**Code snippet**:
```python
from urllib.parse import urlparse

def validate_url(url: str) -> bool:
    try:
        result = urlparse(url)
        return all([result.scheme in ('http', 'https'), result.netloc])
    except:
        return False
```

### Step 2: HTTP Request with Retry
- Create HTTP session with connection pooling
- Send GET request with custom User-Agent
- Implement exponential backoff retry (max 3 attempts)
- Handle timeouts gracefully

**Retry Logic**:
```python
for attempt in range(retry_count + 1):
    try:
        response = session.get(url, timeout=timeout)
        break  # Success
    except requests.Timeout:
        if attempt == retry_count:
            raise  # Max retries reached
        wait_time = 2 ** attempt
        time.sleep(wait_time)
```

### Step 3: Response Validation
- Check HTTP status code
- Measure response time (first byte)
- Parse HTML structure (if content-type is text/html)
- Extract page title from <title> tag

### Step 4: Health Assessment
Mark as healthy if:
- âœ“ Response received (not timeout)
- âœ“ Status code matches expected_status
- âœ“ HTML is parseable (if applicable)

Mark as unhealthy if:
- âœ— Timeout after all retries
- âœ— Status code doesn't match expected
- âœ— Connection error

## Error Handling

[è©³ç´°çš„éŒ¯èª¤è™•ç†ç­–ç•¥ï¼Œå¦‚å‰æ‰€è¿°]

## Complete Examples

[5+ å€‹å®Œæ•´ç¯„ä¾‹ï¼Œæ¶µè“‹å„ç¨®å ´æ™¯]

## Performance Considerations

- Uses connection pooling to reduce overhead
- Implements request timeout to prevent hanging
- Limits retry attempts to avoid excessive delays
- Caches DNS lookups (handled by requests library)

**Typical execution time**:
- Fast websites (<100ms): Total ~200-300ms
- Normal websites (100-500ms): Total ~500-800ms
- Slow websites (>500ms): Up to timeout limit

## Troubleshooting

**Problem**: "Connection timeout" errors
- **Solution**: Increase timeout value or check network connectivity

**Problem**: "Invalid URL format" error
- **Solution**: Ensure URL starts with http:// or https://

**Problem**: False negatives (healthy site marked unhealthy)
- **Solution**: Check expected_status matches actual server response
```

**è¨­è¨ˆåŸå‰‡**ï¼š

1. **å®Œæ•´ä½†ä¸å†—é•·**ï¼š
   - æ¶µè“‹æ‰€æœ‰é‡è¦ç´°ç¯€
   - ä½¿ç”¨çµæ§‹åŒ–æ ¼å¼
   - é¿å…éåº¦è§£é‡‹åŸºç¤æ¦‚å¿µ

2. **å¯¦éš›å¯åŸ·è¡Œ**ï¼š
   - æä¾›çœŸå¯¦çš„ä»£ç¢¼ç‰‡æ®µ
   - å±•ç¤ºå¯¦éš›çš„åŸ·è¡Œæµç¨‹
   - åŒ…å«æ€§èƒ½æ•¸æ“š

3. **æ¶µè“‹é‚Šç·£æ¡ˆä¾‹**ï¼š
   - åˆ—å‡ºå„ç¨®å¤±æ•—å ´æ™¯
   - æä¾›æ•…éšœæ’é™¤æŒ‡å—
   - è§£é‡‹è¨­è¨ˆæ±ºç­–

**å¯¦éš›æ•ˆæœ**ï¼š

åŸ·è¡Œéšæ®µï¼ŒClaude å¯èƒ½éœ€è¦ï¼š
- ç†è§£ç‚ºä»€éº¼åŸ·è¡Œå¤±æ•—
- èª¿æ•´åƒæ•¸é‡è©¦
- è§£é‡‹çµæœçµ¦ç”¨æˆ¶

é€™æ™‚ Layer 3 æä¾›æ‰€æœ‰å¿…è¦çš„æ·±åº¦è³‡è¨Šã€‚

### 3.2.5 æ¼¸é€²å¼æ­éœ²çš„é‡åŒ–æ•ˆç›Š

è®“æˆ‘å€‘ç”¨æ•¸æ“šèªªè©±ï¼š

**å ´æ™¯**ï¼š100 å€‹ Skillsï¼Œç”¨æˆ¶è«‹æ±‚éœ€è¦é¸æ“‡ 1 å€‹

| æ–¹å¼ | Layer 1 | Layer 2 | Layer 3 | ç¸½è¨ˆ |
|------|---------|---------|---------|------|
| **ä¸€æ¬¡è¼‰å…¥å…¨éƒ¨** | - | - | - | ~500,000 tokens |
| **æ¼¸é€²å¼æ­éœ²** | ~20,000 | ~1,500 | ~5,000 | ~26,500 tokens |

**ç¯€çœ**ï¼š95% çš„ token ä½¿ç”¨é‡ï¼

**æ™‚é–“ç¯€çœ**ï¼š
- ä¸€æ¬¡è¼‰å…¥ï¼š~30 ç§’ï¼ˆè™•ç†å¤§é‡è³‡è¨Šï¼‰
- æ¼¸é€²å¼ï¼š~3 ç§’ï¼ˆåªè™•ç†å¿…è¦è³‡è¨Šï¼‰

**æˆæœ¬ç¯€çœ**ï¼ˆåŸºæ–¼ Claude API å®šåƒ¹ï¼‰ï¼š
- ä¸€æ¬¡è¼‰å…¥ï¼š~$0.15 æ¯æ¬¡è«‹æ±‚
- æ¼¸é€²å¼ï¼š~$0.008 æ¯æ¬¡è«‹æ±‚

å°æ–¼æ¯å¤©è™•ç† 1000 æ¬¡è«‹æ±‚çš„ç³»çµ±ï¼š
- ä¸€æ¬¡è¼‰å…¥ï¼š$150/å¤© = $4,500/æœˆ
- æ¼¸é€²å¼ï¼š$8/å¤© = $240/æœˆ

**å¹´åº¦ç¯€çœï¼š$51,120** ğŸ‰

## 3.3 Skills ç”Ÿå‘½é€±æœŸ

ç†è§£ Skills çš„å®Œæ•´ç”Ÿå‘½é€±æœŸï¼Œèƒ½å¹«åŠ©ä½ è¨­è¨ˆæ›´å¥å£¯ã€æ›´é«˜æ•ˆçš„ Skillsã€‚ä¸€å€‹ Skill å¾è¢«ç™¼ç¾åˆ°åŸ·è¡Œå®Œæˆï¼Œç¶“æ­·äº”å€‹é—œéµéšæ®µã€‚

### 3.3.1 éšæ®µ 1: ç™¼ç¾ï¼ˆDiscoveryï¼‰

```
User Request: "æª¢æŸ¥æˆ‘çš„ç¶²ç«™ https://example.com æ˜¯å¦æ­£å¸¸"
    â†“
Claude åˆ†ææ„åœ–
    â†“
è­˜åˆ¥é—œéµè©: "æª¢æŸ¥"ã€"ç¶²ç«™"ã€"æ­£å¸¸"
    â†“
æƒææ‰€æœ‰ Skills çš„ Layer 1 (ç™¼ç¾å±¤)
    â†“
åŒ¹é…ç›¸é—œ Skills:
  - âœ“ Web Health Check (åŒ¹é…: website, check, monitoring)
  - âœ“ Website Screenshot (åŒ¹é…: website)
  - âœ— Excel Data Processor (ä¸åŒ¹é…)
    â†“
æ ¹æ“šç›¸é—œåº¦æ’åº
    â†“
é¸æ“‡æœ€ä½³åŒ¹é…: Web Health Check
```

**é—œéµå› ç´ **ï¼š

1. **Tags çš„é‡è¦æ€§**ï¼š
   - ä½¿ç”¨é ˜åŸŸç›¸é—œçš„é—œéµè©
   - åŒ…å«åŒç¾©è©ï¼ˆwebsite, web, siteï¼‰
   - æ¶µè“‹ä¸åŒçš„ä½¿ç”¨å ´æ™¯

2. **æè¿°çš„æ¸…æ™°åº¦**ï¼š
   - ä½¿ç”¨ç²¾ç¢ºçš„è¡“èª
   - é¿å…æ¨¡ç³Šçš„è©å½™
   - çªå‡ºæ ¸å¿ƒåŠŸèƒ½

3. **When to use çš„æ˜ç¢ºæ€§**ï¼š
   - åˆ—å‡ºå…·é«”å ´æ™¯
   - ä½¿ç”¨å‹•è©é–‹é ­
   - æ¶µè“‹å¸¸è¦‹éœ€æ±‚

**å„ªåŒ–å»ºè­°**ï¼š

```markdown
# å¥½çš„ Tags
web, monitoring, health-check, uptime, availability, http, https, endpoint

# ä¸å¥½çš„ Tags
utility, helper, tool, misc

# å¥½çš„ When to use
- Verify website accessibility after deployment
- Monitor production services uptime
- Check API endpoint health in microservices

# ä¸å¥½çš„ When to use
- When you need to test something
- For checking stuff
- General purpose testing
```

### 3.3.2 éšæ®µ 2: æº–å‚™ï¼ˆPreparationï¼‰

```
é¸å®šçš„ Skill: Web Health Check
    â†“
è¼‰å…¥ Layer 2 è³‡è¨Šï¼ˆåƒæ•¸å®šç¾©ï¼‰
    â†“
è§£æç”¨æˆ¶è«‹æ±‚ä¸­çš„åƒæ•¸:
  - url: "https://example.com" âœ“
  - expected_status: æœªæåŠ â†’ ä½¿ç”¨é è¨­å€¼ 200
  - timeout: æœªæåŠ â†’ ä½¿ç”¨é è¨­å€¼ 30
    â†“
é©—è­‰åƒæ•¸:
  - url æ ¼å¼æ­£ç¢º? âœ“
  - expected_status åœ¨ç¯„åœå…§? âœ“
  - timeout åœ¨ç¯„åœå…§? âœ“
    â†“
æª¢æŸ¥ä¾è³´:
  - requests å·²å®‰è£? âœ“
  - beautifulsoup4 å·²å®‰è£? âœ“
    â†“
åƒæ•¸æº–å‚™å®Œæˆ
```

**é—œéµè€ƒé‡**ï¼š

1. **åƒæ•¸é©—è­‰**ï¼š
   ```python
   # ä½¿ç”¨ Pydantic é€²è¡Œé©—è­‰
   from pydantic import BaseModel, Field, validator

   class HealthCheckParams(BaseModel):
       url: str = Field(..., description="Website URL")
       expected_status: int = Field(default=200, ge=100, le=599)
       timeout: int = Field(default=30, ge=1, le=300)

       @validator('url')
       def validate_url(cls, v):
           if not v.startswith(('http://', 'https://')):
               raise ValueError('URL must start with http:// or https://')
           return v
   ```

2. **é è¨­å€¼è™•ç†**ï¼š
   ```python
   # æ™ºèƒ½é è¨­å€¼
   class SkillConfig(BaseModel):
       # åŸºæ–¼ç’°å¢ƒçš„é è¨­å€¼
       timeout: int = Field(
           default_factory=lambda: int(os.getenv('DEFAULT_TIMEOUT', '30'))
       )

       # åŸºæ–¼æ¢ä»¶çš„é è¨­å€¼
       retry_count: int = Field(
           default_factory=lambda: 5 if os.getenv('ENV') == 'production' else 3
       )
   ```

3. **ä¾è³´æª¢æŸ¥**ï¼š
   ```python
   def check_dependencies():
       """æª¢æŸ¥æ‰€æœ‰ä¾è³´æ˜¯å¦å·²å®‰è£"""
       required = ['requests', 'beautifulsoup4']
       missing = []

       for package in required:
           try:
               __import__(package)
           except ImportError:
               missing.append(package)

       if missing:
           raise RuntimeError(
               f"Missing required packages: {', '.join(missing)}. "
               f"Install with: pip install {' '.join(missing)}"
           )
   ```

### 3.3.3 éšæ®µ 3: åŸ·è¡Œï¼ˆExecutionï¼‰

```
åƒæ•¸å·²æº–å‚™: {url: "https://example.com", expected_status: 200, timeout: 30}
    â†“
è¼‰å…¥ Layer 3 å¯¦ä½œ
    â†“
åˆå§‹åŒ–åŸ·è¡Œç’°å¢ƒ:
  - å‰µå»º HTTP session
  - è¨­ç½® timeout
  - æº–å‚™ retry é‚è¼¯
    â†“
åŸ·è¡Œ Skill é‚è¼¯:
  Step 1: é©—è­‰ URL âœ“
  Step 2: ç™¼é€ HTTP è«‹æ±‚ âœ“
  Step 3: æ¸¬é‡å›æ‡‰æ™‚é–“ (245ms) âœ“
  Step 4: è§£æ HTML âœ“
  Step 5: æå– title "Example Domain" âœ“
    â†“
è™•ç†éŒ¯èª¤å’Œé‡è©¦:
  - ç„¡éŒ¯èª¤ç™¼ç”Ÿ âœ“
    â†“
æ”¶é›†çµæœ:
  {
    "is_healthy": true,
    "status_code": 200,
    "response_time_ms": 245.67,
    "page_title": "Example Domain",
    "errors": []
  }
```

**é—œéµè€ƒé‡**ï¼š

1. **éŒ¯èª¤è™•ç†**ï¼š
   ```python
   def execute_with_retry(func, max_retries=3):
       """åŸ·è¡Œå‡½æ•¸ä¸¦è™•ç†éŒ¯èª¤"""
       for attempt in range(max_retries + 1):
           try:
               return func()
           except TransientError as e:
               if attempt == max_retries:
                   raise
               wait_time = 2 ** attempt
               logger.warning(f"Attempt {attempt + 1} failed: {e}. Retrying in {wait_time}s...")
               time.sleep(wait_time)
           except PermanentError as e:
               # ä¸é‡è©¦æ°¸ä¹…æ€§éŒ¯èª¤
               logger.error(f"Permanent error: {e}")
               raise
   ```

2. **è¶…æ™‚ç®¡ç†**ï¼š
   ```python
   import signal

   class TimeoutError(Exception):
       pass

   def timeout_handler(signum, frame):
       raise TimeoutError("Operation timed out")

   def execute_with_timeout(func, timeout_seconds):
       """åœ¨æŒ‡å®šæ™‚é–“å…§åŸ·è¡Œå‡½æ•¸"""
       signal.signal(signal.SIGALRM, timeout_handler)
       signal.alarm(timeout_seconds)
       try:
           result = func()
           signal.alarm(0)  # å–æ¶ˆ alarm
           return result
       except TimeoutError:
           logger.error(f"Operation timed out after {timeout_seconds}s")
           raise
   ```

3. **è³‡æºæ¸…ç†**ï¼š
   ```python
   class HealthCheckSession:
       """ç®¡ç†å¥åº·æª¢æŸ¥æœƒè©±"""

       def __init__(self):
           self.session = None

       def __enter__(self):
           self.session = requests.Session()
           return self

       def __exit__(self, exc_type, exc_val, exc_tb):
           if self.session:
               self.session.close()
           return False

   # ä½¿ç”¨
   with HealthCheckSession() as session:
       result = session.check_url("https://example.com")
   # session è‡ªå‹•é—œé–‰
   ```

### 3.3.4 éšæ®µ 4: å›å ±ï¼ˆReportingï¼‰

```
åŸ·è¡Œå®Œæˆ
    â†“
æ ¼å¼åŒ–çµæœ:
  - ç¢ºä¿æ‰€æœ‰å¿…è¦æ¬„ä½å­˜åœ¨
  - é©—è­‰è³‡æ–™é¡å‹
  - æ·»åŠ æ™‚é–“æˆ³
    â†“
å›å‚³çµ¦ Claude:
  {
    "is_healthy": true,
    "status_code": 200,
    "response_time_ms": 245.67,
    "page_title": "Example Domain",
    "errors": [],
    "url": "https://example.com",
    "checked_at": "2025-01-15T10:30:22.123Z"
  }
    â†“
Claude è§£é‡‹çµæœ:
  "æ‚¨çš„ç¶²ç«™ https://example.com é‹è¡Œæ­£å¸¸ï¼
   - HTTP ç‹€æ…‹ç¢¼: 200 âœ“
   - å›æ‡‰æ™‚é–“: 246 æ¯«ç§’ (å¿«é€Ÿ)
   - é é¢æ¨™é¡Œ: Example Domain

   ç¶²ç«™å¥åº·ï¼Œç„¡ç™¼ç¾å•é¡Œã€‚"
    â†“
ç”Ÿæˆç”¨æˆ¶å›æ‡‰
```

**é—œéµè€ƒé‡**ï¼š

1. **çµæœæ ¼å¼æ¨™æº–åŒ–**ï¼š
   ```python
   from pydantic import BaseModel
   from datetime import datetime

   class HealthCheckResult(BaseModel):
       """å¥åº·æª¢æŸ¥çµæœ"""
       is_healthy: bool
       status_code: int
       response_time_ms: float
       page_title: Optional[str]
       errors: List[str]
       url: str
       checked_at: datetime = Field(default_factory=datetime.utcnow)

       class Config:
           json_encoders = {
               datetime: lambda v: v.isoformat()
           }
   ```

2. **éŒ¯èª¤è¨Šæ¯æ¸…æ™°**ï¼š
   ```python
   # âœ… å¥½çš„éŒ¯èª¤è¨Šæ¯
   {
       "error": "Connection timeout",
       "details": "Unable to connect to https://example.com within 30 seconds",
       "suggestion": "Check network connectivity or increase timeout value",
       "error_code": "TIMEOUT_ERROR"
   }

   # âŒ ä¸å¥½çš„éŒ¯èª¤è¨Šæ¯
   {
       "error": "Failed",
       "message": "Something went wrong"
   }
   ```

3. **å¯æ“ä½œçš„è³‡è¨Š**ï¼š
   ```python
   def generate_actionable_report(result: HealthCheckResult) -> dict:
       """ç”Ÿæˆå¯æ“ä½œçš„å ±å‘Š"""
       report = result.dict()

       # æ·»åŠ å»ºè­°
       if not result.is_healthy:
           report['suggestions'] = []

           if result.status_code == 0:
               report['suggestions'].append("Check if the website is accessible from your network")
           elif 400 <= result.status_code < 500:
               report['suggestions'].append("Verify the URL is correct")
           elif result.status_code >= 500:
               report['suggestions'].append("Website server error - try again later")

       # æ·»åŠ æ€§èƒ½è©•ä¼°
       if result.response_time_ms < 200:
           report['performance'] = "Excellent"
       elif result.response_time_ms < 500:
           report['performance'] = "Good"
       elif result.response_time_ms < 1000:
           report['performance'] = "Fair"
       else:
           report['performance'] = "Slow"

       return report
   ```

### 3.3.5 éšæ®µ 5: æ¸…ç†ï¼ˆCleanupï¼‰

```
å›å ±å®Œæˆ
    â†“
é‡‹æ”¾è³‡æº:
  - é—œé–‰ HTTP session âœ“
  - é‡‹æ”¾è¨˜æ†¶é«” âœ“
  - æ¸…é™¤æš«å­˜æª”æ¡ˆ âœ“
    â†“
è¨˜éŒ„æ—¥èªŒ:
  - INFO: Health check completed for https://example.com
  - Duration: 0.25s
  - Status: healthy
    â†“
æ›´æ–°æŒ‡æ¨™:
  - health_checks_total: +1
  - health_checks_success: +1
  - response_time_histogram: add(245.67)
    â†“
å®Œæˆ
```

**é—œéµè€ƒé‡**ï¼š

1. **é˜²æ­¢è³‡æºæ´©æ¼**ï¼š
   ```python
   class ResourceManager:
       """è³‡æºç®¡ç†å™¨"""

       def __init__(self):
           self.resources = []

       def register(self, resource):
           """è¨»å†Šéœ€è¦æ¸…ç†çš„è³‡æº"""
           self.resources.append(resource)

       def cleanup(self):
           """æ¸…ç†æ‰€æœ‰è³‡æº"""
           for resource in self.resources:
               try:
                   if hasattr(resource, 'close'):
                       resource.close()
                   elif hasattr(resource, '__exit__'):
                       resource.__exit__(None, None, None)
               except Exception as e:
                   logger.warning(f"Failed to cleanup resource: {e}")

       def __enter__(self):
           return self

       def __exit__(self, exc_type, exc_val, exc_tb):
           self.cleanup()
           return False
   ```

2. **æ—¥èªŒè¨˜éŒ„**ï¼š
   ```python
   import logging
   import time

   logger = logging.getLogger(__name__)

   def log_skill_execution(skill_name: str):
       """è¨˜éŒ„ Skill åŸ·è¡Œ"""
       def decorator(func):
           def wrapper(*args, **kwargs):
               start_time = time.time()
               logger.info(f"Starting {skill_name} with args={args}, kwargs={kwargs}")

               try:
                   result = func(*args, **kwargs)
                   duration = time.time() - start_time
                   logger.info(f"{skill_name} completed successfully in {duration:.2f}s")
                   return result
               except Exception as e:
                   duration = time.time() - start_time
                   logger.error(f"{skill_name} failed after {duration:.2f}s: {e}", exc_info=True)
                   raise

           return wrapper
       return decorator

   # ä½¿ç”¨
   @log_skill_execution("web_health_check")
   def execute_health_check(url: str) -> dict:
       # ...
       pass
   ```

3. **æŒ‡æ¨™æ”¶é›†**ï¼š
   ```python
   from prometheus_client import Counter, Histogram

   # å®šç¾©æŒ‡æ¨™
   skill_executions = Counter(
       'skill_executions_total',
       'Total skill executions',
       ['skill_name', 'status']
   )

   skill_duration = Histogram(
       'skill_execution_duration_seconds',
       'Skill execution duration',
       ['skill_name']
   )

   def track_metrics(skill_name: str):
       """è¿½è¹¤æŒ‡æ¨™"""
       def decorator(func):
           def wrapper(*args, **kwargs):
               with skill_duration.labels(skill_name=skill_name).time():
                   try:
                       result = func(*args, **kwargs)
                       skill_executions.labels(skill_name=skill_name, status='success').inc()
                       return result
                   except Exception as e:
                       skill_executions.labels(skill_name=skill_name, status='failure').inc()
                       raise
           return wrapper
       return decorator
   ```

## 3.4 åƒæ•¸å®šç¾©èˆ‡é©—è­‰

åƒæ•¸é©—è­‰æ˜¯ Skills é–‹ç™¼ä¸­æœ€å®¹æ˜“è¢«å¿½è¦–ï¼Œå»æœ€é—œéµçš„éƒ¨åˆ†ã€‚è‰¯å¥½çš„åƒæ•¸é©—è­‰èƒ½å¤ ï¼š
- åœ¨æ—©æœŸæ•ç²éŒ¯èª¤
- æä¾›æ¸…æ™°çš„éŒ¯èª¤è¨Šæ¯
- é¿å…ä¸å¿…è¦çš„è³‡æºæµªè²»
- æé«˜ Skill çš„å¯é æ€§

### 3.4.1 ä½¿ç”¨ Pydantic é€²è¡Œåƒæ•¸é©—è­‰

Pydantic æ˜¯ Python ä¸­æœ€å¼·å¤§çš„è³‡æ–™é©—è­‰åº«ã€‚å®ƒä½¿ç”¨ Python é¡å‹æç¤ºä¾†å®šç¾©è³‡æ–™çµæ§‹ï¼Œä¸¦è‡ªå‹•é€²è¡Œé©—è­‰ã€‚

**åŸºæœ¬ç¯„ä¾‹**ï¼š

```python
from typing import Optional, List, Dict
from pydantic import BaseModel, Field, validator, HttpUrl
from datetime import datetime

class HealthCheckParams(BaseModel):
    """å¥åº·æª¢æŸ¥åƒæ•¸"""

    url: HttpUrl = Field(
        ...,  # ... è¡¨ç¤ºå¿…è¦æ¬„ä½
        description="Website URL to check",
        example="https://example.com"
    )

    expected_status: int = Field(
        default=200,
        ge=100,  # greater than or equal (>=100)
        le=599,  # less than or equal (<=599)
        description="Expected HTTP status code"
    )

    timeout: int = Field(
        default=30,
        ge=1,
        le=300,
        description="Timeout in seconds"
    )

    retry_count: int = Field(
        default=3,
        ge=0,
        le=10,
        description="Number of retries on failure"
    )

    headers: Optional[Dict[str, str]] = Field(
        default=None,
        description="Custom HTTP headers"
    )

    verify_ssl: bool = Field(
        default=True,
        description="Verify SSL certificates"
    )

    @validator('timeout')
    def timeout_must_be_reasonable(cls, v):
        """é©—è­‰ timeout æ˜¯å¦åˆç†"""
        if v > 120:
            import warnings
            warnings.warn(
                f"Timeout of {v}s is very long. Consider using a shorter timeout.",
                UserWarning
            )
        return v

    @validator('headers')
    def headers_must_be_valid(cls, v):
        """é©—è­‰ headers æ ¼å¼"""
        if v is not None:
            # æª¢æŸ¥æ˜¯å¦æœ‰æ•æ„Ÿè³‡è¨Š
            sensitive_keys = ['password', 'secret', 'token']
            for key in v.keys():
                if any(s in key.lower() for s in sensitive_keys):
                    logger.warning(f"Header '{key}' may contain sensitive information")
        return v

    class Config:
        # ç”Ÿæˆ JSON Schema
        schema_extra = {
            "examples": [
                {
                    "url": "https://example.com",
                    "expected_status": 200,
                    "timeout": 30
                }
            ]
        }
```

**ä½¿ç”¨ç¯„ä¾‹**ï¼š

```python
def execute_health_check(**kwargs) -> Dict[str, Any]:
    """åŸ·è¡Œå¥åº·æª¢æŸ¥"""

    # æ­¥é©Ÿ 1: é©—è­‰åƒæ•¸
    try:
        params = HealthCheckParams(**kwargs)
    except ValidationError as e:
        # Pydantic æä¾›çµæ§‹åŒ–çš„éŒ¯èª¤è¨Šæ¯
        error_details = []
        for error in e.errors():
            field = error['loc'][0]
            message = error['msg']
            error_details.append(f"{field}: {message}")

        return {
            "is_healthy": False,
            "errors": error_details,
            "error_type": "VALIDATION_ERROR"
        }

    # æ­¥é©Ÿ 2: åŸ·è¡Œæª¢æŸ¥ï¼ˆåƒæ•¸å·²é©—è­‰ï¼‰
    checker = WebHealthChecker(timeout=params.timeout)
    return checker.check(
        url=str(params.url),  # HttpUrl éœ€è¦è½‰æ›ç‚º str
        expected_status=params.expected_status,
        retry_count=params.retry_count,
        headers=params.headers,
        verify_ssl=params.verify_ssl
    )
```

### 3.4.2 è¤‡é›œåƒæ•¸é¡å‹

æœ‰æ™‚å€™åƒæ•¸ä¸åªæ˜¯ç°¡å–®çš„å­—ä¸²æˆ–æ•¸å­—ï¼Œè€Œæ˜¯åµŒå¥—çš„çµæ§‹ã€‚Pydantic å®Œå…¨æ”¯æ´è¤‡é›œé¡å‹ã€‚

**ç¯„ä¾‹ï¼šæ‰¹æ¬¡å¥åº·æª¢æŸ¥**

```python
class HealthCheckTarget(BaseModel):
    """å–®å€‹æª¢æŸ¥ç›®æ¨™"""
    url: HttpUrl
    expected_status: int = 200
    name: Optional[str] = None  # å¯é¸çš„åç¨±

class BatchHealthCheckParams(BaseModel):
    """æ‰¹æ¬¡å¥åº·æª¢æŸ¥åƒæ•¸"""

    targets: List[HealthCheckTarget] = Field(
        ...,
        min_items=1,
        max_items=100,
        description="List of targets to check"
    )

    concurrent: bool = Field(
        default=True,
        description="Execute checks concurrently"
    )

    max_workers: int = Field(
        default=5,
        ge=1,
        le=20,
        description="Maximum concurrent workers"
    )

    stop_on_first_failure: bool = Field(
        default=False,
        description="Stop execution if any check fails"
    )

    @validator('max_workers')
    def validate_max_workers(cls, v, values):
        """é©—è­‰ max_workers èˆ‡ targets æ•¸é‡çš„é—œä¿‚"""
        if 'targets' in values:
            target_count = len(values['targets'])
            if v > target_count:
                # è‡ªå‹•èª¿æ•´
                return target_count
        return v
```

## 3.5 éŒ¯èª¤è™•ç†ç­–ç•¥

å°ˆæ¥­çš„ Skills èƒ½å¤ å„ªé›…åœ°è™•ç†éŒ¯èª¤ã€‚è®“æˆ‘å€‘æ·±å…¥æ¢è¨å¦‚ä½•è¨­è¨ˆå¥å£¯çš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ã€‚

### 3.5.1 éŒ¯èª¤åˆ†é¡

ä¸æ˜¯æ‰€æœ‰éŒ¯èª¤éƒ½æ‡‰è©²è¢«åŒç­‰å°å¾…ã€‚æ ¹æ“šéŒ¯èª¤çš„æ€§è³ªï¼Œæˆ‘å€‘å¯ä»¥æ¡å–ä¸åŒçš„ç­–ç•¥ã€‚

```python
from enum import Enum

class ErrorType(Enum):
    TRANSIENT = "transient"      # å¯é‡è©¦
    PERMANENT = "permanent"      # ä¸å¯é‡è©¦
    PARTIAL = "partial"          # éƒ¨åˆ†å¤±æ•—

class SkillError(Exception):
    """Skill éŒ¯èª¤åŸºé¡"""

    def __init__(self, message: str, error_type: ErrorType, details: dict = None):
        super().__init__(message)
        self.error_type = error_type
        self.details = details or {}

class TransientError(SkillError):
    """æš«æ™‚æ€§éŒ¯èª¤ï¼ˆæ‡‰é‡è©¦ï¼‰"""
    def __init__(self, message: str, details: dict = None):
        super().__init__(message, ErrorType.TRANSIENT, details)

class PermanentError(SkillError):
    """æ°¸ä¹…æ€§éŒ¯èª¤ï¼ˆä¸æ‡‰é‡è©¦ï¼‰"""
    def __init__(self, message: str, details: dict = None):
        super().__init__(message, ErrorType.PERMANENT, details)
```

### 3.5.2 æ™ºèƒ½é‡è©¦ç­–ç•¥

```python
import time
import random
from typing import Callable, TypeVar
from functools import wraps

T = TypeVar('T')

def retry_with_backoff(
    max_retries: int = 3,
    base_delay: float = 1.0,
    max_delay: float = 60.0,
    exponential_base: float = 2.0,
    jitter: bool = True,
    exceptions: tuple = (TransientError,)
):
    """
    å¸¶æŒ‡æ•¸é€€é¿çš„é‡è©¦è£é£¾å™¨

    Args:
        max_retries: æœ€å¤§é‡è©¦æ¬¡æ•¸
        base_delay: åŸºç¤å»¶é²æ™‚é–“ï¼ˆç§’ï¼‰
        max_delay: æœ€å¤§å»¶é²æ™‚é–“ï¼ˆç§’ï¼‰
        exponential_base: æŒ‡æ•¸åŸºæ•¸ï¼ˆé€šå¸¸æ˜¯ 2ï¼‰
        jitter: æ˜¯å¦æ·»åŠ éš¨æ©ŸæŠ–å‹•
        exceptions: éœ€è¦é‡è©¦çš„ç•°å¸¸é¡å‹
    """
    def decorator(func: Callable[..., T]) -> Callable[..., T]:
        @wraps(func)
        def wrapper(*args, **kwargs) -> T:
            last_exception = None

            for attempt in range(max_retries + 1):
                try:
                    return func(*args, **kwargs)

                except exceptions as e:
                    last_exception = e

                    if attempt == max_retries:
                        logger.error(
                            f"Max retries ({max_retries}) reached for {func.__name__}. "
                            f"Last error: {e}"
                        )
                        raise

                    # è¨ˆç®—å»¶é²æ™‚é–“
                    delay = min(
                        base_delay * (exponential_base ** attempt),
                        max_delay
                    )

                    # æ·»åŠ éš¨æ©ŸæŠ–å‹•
                    if jitter:
                        delay = delay * (0.5 + random.random() * 0.5)

                    logger.warning(
                        f"Attempt {attempt + 1}/{max_retries} failed: {e}. "
                        f"Retrying in {delay:.2f}s..."
                    )

                    time.sleep(delay)

                except Exception as e:
                    logger.error(f"Non-retryable error: {e}")
                    raise

            raise last_exception

        return wrapper
    return decorator
```

## 3.6 Skills é–‹ç™¼æœ€ä½³å¯¦è¸

ç¶“éå¤šå¹´çš„å¯¦è¸ï¼Œæˆ‘å€‘ç¸½çµå‡ºä»¥ä¸‹æœ€ä½³å¯¦è¸ã€‚éµå¾ªé€™äº›åŸå‰‡ï¼Œä½ çš„ Skills å°‡æ›´å¥å£¯ã€æ›´æ˜“ç¶­è­·ã€‚

### 3.6.1 å–®ä¸€è·è²¬åŸå‰‡ï¼ˆSingle Responsibility Principleï¼‰

æ¯å€‹ Skill æ‡‰è©²åªåšä¸€ä»¶äº‹ï¼Œä¸¦æŠŠå®ƒåšå¥½ã€‚

**âœ… å¥½çš„è¨­è¨ˆ**ï¼š

```python
# åˆ†æˆå¤šå€‹å°ˆæ³¨çš„ Skills

def web_health_check(url: str) -> dict:
    """åªåšå¥åº·æª¢æŸ¥"""
    return check_health(url)

def web_performance_test(url: str) -> dict:
    """åªåšæ€§èƒ½æ¸¬è©¦"""
    return run_performance_test(url)

def seo_analyzer(url: str) -> dict:
    """åªåš SEO åˆ†æ"""
    return analyze_seo(url)
```

### 3.6.2 å¯çµ„åˆæ€§ï¼ˆComposabilityï¼‰

è¨­è¨ˆå¯ä»¥äº’ç›¸çµ„åˆçš„ Skillsï¼Œå‰µé€ æ›´å¼·å¤§çš„åŠŸèƒ½ã€‚

```python
# åŸºç¤ Skillsï¼ˆæ§‹å»ºå¡Šï¼‰

def fetch_webpage(url: str) -> str:
    """ç²å–ç¶²é å…§å®¹"""
    response = requests.get(url)
    return response.text

def parse_html(html: str) -> BeautifulSoup:
    """è§£æ HTML"""
    return BeautifulSoup(html, 'html.parser')

def extract_links(soup: BeautifulSoup) -> List[str]:
    """æå–æ‰€æœ‰é€£çµ"""
    return [a['href'] for a in soup.find_all('a', href=True)]

# çµ„åˆæˆé«˜éš Skills
def get_all_links(url: str) -> List[str]:
    """ç²å–é é¢æ‰€æœ‰é€£çµ"""
    html = fetch_webpage(url)
    soup = parse_html(html)
    return extract_links(soup)
```

### 3.6.3 å¯æ¸¬è©¦æ€§ï¼ˆTestabilityï¼‰

è¨­è¨ˆæ˜“æ–¼æ¸¬è©¦çš„ Skillsã€‚

```python
import pytest
from unittest.mock import Mock

class WebHealthChecker:
    """å¯æ¸¬è©¦çš„å¥åº·æª¢æŸ¥å™¨"""

    def __init__(self, http_client=None, timeout: int = 30):
        self.http_client = http_client or requests
        self.timeout = timeout

    def check(self, url: str) -> dict:
        """åŸ·è¡Œæª¢æŸ¥"""
        response = self.http_client.get(url, timeout=self.timeout)
        return {
            'is_healthy': response.status_code == 200,
            'status_code': response.status_code
        }

# æ¸¬è©¦
def test_health_checker_success():
    """æ¸¬è©¦æˆåŠŸæƒ…æ³"""
    mock_client = Mock()
    mock_response = Mock()
    mock_response.status_code = 200
    mock_client.get.return_value = mock_response

    checker = WebHealthChecker(http_client=mock_client)
    result = checker.check("https://test.com")

    assert result['is_healthy'] is True
    assert result['status_code'] == 200
```

## 3.7 æœ¬ç« ç¸½çµ

æ­å–œï¼ä½ å·²ç¶“æŒæ¡äº† Claude Code Skills çš„æ ¸å¿ƒæ¦‚å¿µã€‚è®“æˆ‘å€‘å›é¡§é—œéµè¦é»ï¼š

### 3.7.1 é—œéµè¦é»

âœ… **SKILL.md æ˜¯æ ¸å¿ƒ**
- çµæ§‹åŒ–ã€å®Œæ•´çš„æ–‡æª”
- æ¸…æ™°çš„åƒæ•¸å’Œè¿”å›å€¼å®šç¾©
- è±å¯Œçš„ç¯„ä¾‹å’ŒéŒ¯èª¤è™•ç†èªªæ˜

âœ… **ä¸‰å±¤æ¼¸é€²å¼æ­éœ²**
- Layer 1ï¼ˆç™¼ç¾å±¤ï¼‰ï¼šå¿«é€Ÿæ±ºç­–
- Layer 2ï¼ˆæº–å‚™å±¤ï¼‰ï¼šåƒæ•¸æº–å‚™
- Layer 3ï¼ˆåŸ·è¡Œå±¤ï¼‰ï¼šå®Œæ•´å¯¦ä½œ
- ç¯€çœ 95% token ä½¿ç”¨ã€é™ä½æˆæœ¬ã€æå‡æ€§èƒ½

âœ… **å®Œæ•´çš„ç”Ÿå‘½é€±æœŸ**
- ç™¼ç¾ â†’ æº–å‚™ â†’ åŸ·è¡Œ â†’ å›å ± â†’ æ¸…ç†
- æ¯å€‹éšæ®µæœ‰æ˜ç¢ºè·è²¬
- ç†è§£æµç¨‹æœ‰åŠ©æ–¼è¨­è¨ˆæ›´å¥½çš„ Skills

âœ… **åƒæ•¸é©—è­‰**
- ä½¿ç”¨ Pydantic é€²è¡Œè‡ªå‹•é©—è­‰
- æ—©æœŸæ•ç²éŒ¯èª¤
- æä¾›æ¸…æ™°çš„éŒ¯èª¤è¨Šæ¯

âœ… **éŒ¯èª¤è™•ç†**
- åˆ†é¡éŒ¯èª¤ï¼ˆå¯æ¢å¾© vs. æ°¸ä¹…æ€§ï¼‰
- æ™ºèƒ½é‡è©¦ï¼ˆæŒ‡æ•¸é€€é¿ + æŠ–å‹•ï¼‰
- çµæ§‹åŒ–éŒ¯èª¤è¨Šæ¯

âœ… **æœ€ä½³å¯¦è¸**
- å–®ä¸€è·è²¬åŸå‰‡
- å¯çµ„åˆæ€§è¨­è¨ˆ
- å¯æ¸¬è©¦æ€§ï¼ˆä¾è³´æ³¨å…¥ï¼‰
- å®Œæ•´æ–‡æª”

### 3.7.2 å¯¦è¸æª¢æŸ¥æ¸…å–®

åœ¨é–‹å§‹ä¸‹ä¸€ç« ä¹‹å‰ï¼Œç¢ºä¿ä½ èƒ½å¤ ï¼š

- [ ] æ’°å¯«å®Œæ•´çš„ SKILL.mdï¼ˆåŒ…å«æ‰€æœ‰å¿…è¦ç« ç¯€ï¼‰
- [ ] ç†è§£ä¸‰å±¤æ¼¸é€²å¼æ­éœ²çš„è¨­è¨ˆåŸç†å’Œå¥½è™•
- [ ] èªªæ˜ Skills ç”Ÿå‘½é€±æœŸçš„äº”å€‹éšæ®µ
- [ ] ä½¿ç”¨ Pydantic å¯¦ä½œåƒæ•¸é©—è­‰
- [ ] è¨­è¨ˆéŒ¯èª¤åˆ†é¡å’Œé‡è©¦ç­–ç•¥
- [ ] ç·¨å¯«çµæ§‹åŒ–ã€å¯æ“ä½œçš„éŒ¯èª¤è¨Šæ¯
- [ ] æ‡‰ç”¨å–®ä¸€è·è²¬åŸå‰‡è¨­è¨ˆ Skills
- [ ] å‰µå»ºå¯çµ„åˆçš„ Skills
- [ ] ç·¨å¯«å¯æ¸¬è©¦çš„ä»£ç¢¼ï¼ˆä½¿ç”¨ä¾è³´æ³¨å…¥ï¼‰
- [ ] æ’°å¯«å®Œæ•´çš„ docstrings

### 3.7.3 ä¸‹ä¸€ç« é å‘Š

ç¬¬ 4 ç« å°‡æ·±å…¥æ¢è¨ **Stagehand ç€è¦½å™¨è‡ªå‹•åŒ–**â€”â€”WebGuard æœ€é‡è¦çš„çµ„ä»¶ä¹‹ä¸€ã€‚ä½ å°‡å­¸ç¿’ï¼š

- Stagehand çš„ AI é©…å‹•æ¶æ§‹
- è‡ªæ„ˆæ¸¬è©¦ï¼ˆself-healing testsï¼‰çš„åŸç†
- å¦‚ä½•ä½¿ç”¨è‡ªç„¶èªè¨€ç·¨å¯«æ¸¬è©¦
- èˆ‡å‚³çµ±å·¥å…·ï¼ˆPlaywright, Seleniumï¼‰çš„æ•´åˆ
- å¯¦ä½œè¤‡é›œçš„ç€è¦½å™¨è‡ªå‹•åŒ–å ´æ™¯

Stagehand æ˜¯é©å‘½æ€§çš„å·¥å…·ï¼Œå®ƒå°‡ AI çš„åŠ›é‡å¸¶å…¥ç€è¦½å™¨è‡ªå‹•åŒ–é ˜åŸŸã€‚æº–å‚™å¥½è¿æ¥ä»¤äººèˆˆå¥®çš„æ—…ç¨‹ï¼

---

**æœ¬ç« ä»£ç¢¼**

æœ¬ç« çš„å®Œæ•´ä»£ç¢¼ç¯„ä¾‹å¯åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ°ï¼š
- `code-examples/chapter-03/parameter-validation/`
- `code-examples/chapter-03/error-handling/`
- `code-examples/chapter-03/best-practices/`

**å»¶ä¼¸é–±è®€**

- Pydantic æ–‡æª”: https://docs.pydantic.dev
- Python é¡å‹æç¤º (PEP 484): https://peps.python.org/pep-0484/
- éŒ¯èª¤è™•ç†æœ€ä½³å¯¦è¸: https://docs.python-guide.org/writing/structure/

---

> *ã€ŒThe best error message is the one that never shows up.ã€ - Thomas Fuchs*
