# ShopHub å°ˆæ¡ˆ - Claude Agent å·¥ä½œè¨˜æ†¶

## ğŸ“‹ å°ˆæ¡ˆæ¦‚è¦½
- **å°ˆæ¡ˆåç¨±**: ShopHub
- **å°ˆæ¡ˆé¡å‹**: é›»å•†å¹³å° (B2C)
- **æŠ€è¡“æ£§**: Python 3.11, FastAPI, PostgreSQL 14, Redis 7, Docker
- **åœ˜éšŠè¦æ¨¡**: 12 äººï¼ˆ6 å¾Œç«¯, 3 å‰ç«¯, 2 DevOps, 1 PMï¼‰
- **å°ˆæ¡ˆéšæ®µ**: MVP å·²ä¸Šç·šï¼Œæ­£åœ¨å„ªåŒ–æ”¯ä»˜æ¨¡çµ„

## ğŸ¯ ç•¶å‰å·¥ä½œæƒ…å¢ƒ
**æ›´æ–°æ—¥æœŸ**: 2025-11-08
**ç•¶å‰éšæ®µ**: æ”¯ä»˜æ¨¡çµ„é‡æ§‹ä¸­
**å„ªå…ˆä»»å‹™**:
1. å®Œæˆ Stripe æ•´åˆæ¸¬è©¦ï¼ˆé è¨ˆ 2025-11-15ï¼‰
2. é·ç§»èˆŠè¨‚å–®åˆ°æ–° schemaï¼ˆé è¨ˆ 2025-11-20ï¼‰
3. å¯¦ä½œé€€æ¬¾æµç¨‹è‡ªå‹•åŒ–

**å·²çŸ¥å•é¡Œ**:
- è¨‚å–®è™•ç†åœ¨é«˜å³°æ™‚æ®µå¶çˆ¾è®Šæ…¢ï¼ˆèª¿æŸ¥ä¸­ï¼‰
- Redis å¿«å–å‘½ä¸­ç‡åªæœ‰ 70%ï¼ˆç›®æ¨™ >90%ï¼‰

## ğŸ—ï¸ æ¶æ§‹æ±ºç­–è¨˜éŒ„ (ADRs)

### ADR-001: é¸æ“‡ FastAPI è€Œé Django
**æ—¥æœŸ**: 2024-01-15
**ç‹€æ…‹**: å·²æ¥å—
**æ±ºç­–**: ä½¿ç”¨ FastAPI ä½œç‚º Web æ¡†æ¶
**åŸå› **:
- éœ€è¦é«˜æ•ˆèƒ½ APIï¼ˆæ”¯æ´ async/awaitï¼‰
- è‡ªå‹•ç”Ÿæˆ OpenAPI æ–‡ä»¶ï¼ˆæ–¹ä¾¿å‰ç«¯æ•´åˆï¼‰
- åœ˜éšŠåå¥½è¼•é‡ç´šæ¡†æ¶
- å„ªç§€çš„å‹åˆ¥æª¢æŸ¥ï¼ˆåŸºæ–¼ Pydanticï¼‰
**æ›¿ä»£æ–¹æ¡ˆ**:
- Django REST Framework: å¤ªé‡ï¼Œå•Ÿå‹•æ…¢
- Flask: ç¼ºä¹è‡ªå‹•æ–‡ä»¶ç”Ÿæˆï¼Œéœ€è¦æ‰‹å‹•é…ç½®å¤ªå¤š
**å¾Œæœ**:
- âœ… API å›æ‡‰æ™‚é–“ <100ms
- âœ… é–‹ç™¼æ•ˆç‡æå‡ 40%
- âŒ åœ˜éšŠéœ€è¦å­¸ç¿’éåŒæ­¥ç¨‹å¼è¨­è¨ˆ

### ADR-002: PostgreSQL vs MongoDB
**æ—¥æœŸ**: 2024-03-10
**ç‹€æ…‹**: å·²æ¥å—
**æ±ºç­–**: ä½¿ç”¨ PostgreSQL ä½œç‚ºä¸»è¦è³‡æ–™åº«
**åŸå› **:
- è¨‚å–®å’Œæ”¯ä»˜éœ€è¦ ACID äº‹å‹™ä¿è­‰
- éœ€è¦è¤‡é›œçš„ JOIN æŸ¥è©¢ï¼ˆå•†å“ + è¨‚å–® + ç”¨æˆ¶ï¼‰
- åœ˜éšŠ 80% æˆå“¡ç†Ÿæ‚‰ PostgreSQL
**æ›¿ä»£æ–¹æ¡ˆ**:
- MongoDB: ç•¶æ™‚ç‰ˆæœ¬ï¼ˆ4.0ï¼‰äº‹å‹™æ”¯æ´ä¸å®Œæ•´
- MySQL: ç¼ºä¹ JSONB æ”¯æ´ï¼ˆéœ€è¦å„²å­˜å•†å“å±¬æ€§ï¼‰
**å¾Œæœ**:
- âœ… é›¶è³‡æ–™ä¸ä¸€è‡´å•é¡Œ
- âœ… æŸ¥è©¢æ•ˆèƒ½å„ªç•°ï¼ˆæœ‰é©ç•¶ç´¢å¼•ï¼‰
- âŒ Schema è®Šæ›´éœ€è¦é·ç§»è…³æœ¬

## âš ï¸ é‡è¦æé†’

### åƒè¬ä¸è¦åš
- âŒ **ä¸è¦ç›´æ¥ä¿®æ”¹ `legacy-auth.py`**: é€™æ˜¯èˆŠèªè­‰ç³»çµ±ï¼Œæ­£åœ¨é€æ­¥é·ç§»åˆ° `auth/jwt.py`ï¼Œé è¨ˆ 2025-12 å®Œå…¨ç§»é™¤
- âŒ **ä¸è¦åœ¨ç”Ÿç”¢ç’°å¢ƒä½¿ç”¨ `DEBUG=True`**: æœƒæ´©æ¼æ•æ„Ÿè³‡è¨Š
- âŒ **ä¸è¦ç¹é `RateLimiter`**: æœƒå°è‡´ API è¢«æ¿«ç”¨ï¼Œå½±éŸ¿æ‰€æœ‰ç”¨æˆ¶
- âŒ **ä¸è¦åœ¨ migration ä¸­ç›´æ¥åˆªé™¤è³‡æ–™**: å¿…é ˆå…ˆå‚™ä»½ï¼Œä¸¦ç¶“é code review

### æœ€ä½³å¯¦è¸
- âœ… **æ‰€æœ‰ API éƒ½è¦åŠ å…¥ rate limiting**: ä½¿ç”¨ `@rate_limit(max_calls=100, period=60)` è£é£¾å™¨
- âœ… **æ•æ„Ÿè³‡æ–™ä½¿ç”¨åŠ å¯†**: ä½¿ç”¨ `utils.encryption.encrypt_field()` åŠ å¯†ä¿¡ç”¨å¡è³‡è¨Š
- âœ… **è³‡æ–™åº«é·ç§»ä½¿ç”¨ Alembic**: ä¸è¦æ‰‹å‹•åŸ·è¡Œ SQL
- âœ… **æ‰€æœ‰è®Šæ›´éƒ½è¦å¯«æ¸¬è©¦**: æ¸¬è©¦è¦†è“‹ç‡ç›®æ¨™ >80%
- âœ… **API æ–‡ä»¶è¦åŒæ­¥æ›´æ–°**: ä¿®æ”¹ endpoint å¾Œæ›´æ–° docstring

### åœ°é›·å€åŸŸ
- ğŸš« **payments/legacy/**: èˆŠç‰ˆæ”¯ä»˜æ•´åˆï¼Œä¸è¦ä¿®æ”¹ï¼Œç­‰å¾…ç§»é™¤
- ğŸš« **database/manual_migrations/**: æ‰‹å‹•åŸ·è¡Œçš„ SQLï¼Œå·²è¢« Alembic å–ä»£
- ğŸš« **scripts/hotfix_*.py**: è‡¨æ™‚ä¿®å¾©è…³æœ¬ï¼Œä¸è¦åœ¨ç”Ÿç”¢ç’°å¢ƒä½¿ç”¨

## ğŸ“ å°ˆæ¡ˆçµæ§‹
```
shophub/
â”œâ”€â”€ api/                 # FastAPI æ‡‰ç”¨ç¨‹å¼
â”‚   â”œâ”€â”€ routes/          # API è·¯ç”±
â”‚   â”œâ”€â”€ models/          # Pydantic æ¨¡å‹
â”‚   â””â”€â”€ dependencies.py  # ä¾è³´æ³¨å…¥
â”œâ”€â”€ auth/                # èªè­‰ç³»çµ±
â”‚   â”œâ”€â”€ jwt.py           # JWT å¯¦ä½œï¼ˆæ–°ç‰ˆï¼‰
â”‚   â””â”€â”€ legacy-auth.py   # èˆŠç‰ˆèªè­‰ï¼ˆå¾…ç§»é™¤ï¼‰
â”œâ”€â”€ products/            # å•†å“ç®¡ç†
â”‚   â”œâ”€â”€ service.py       # æ¥­å‹™é‚è¼¯
â”‚   â”œâ”€â”€ repository.py    # è³‡æ–™å­˜å–
â”‚   â””â”€â”€ schemas.py       # è³‡æ–™æ¨¡å‹
â”œâ”€â”€ orders/              # è¨‚å–®è™•ç†
â”‚   â”œâ”€â”€ state_machine.py # è¨‚å–®ç‹€æ…‹æ©Ÿ
â”‚   â”œâ”€â”€ processor.py     # è¨‚å–®è™•ç†å™¨
â”‚   â””â”€â”€ notifications.py # è¨‚å–®é€šçŸ¥
â”œâ”€â”€ payments/            # é‡‘æµæ•´åˆ
â”‚   â”œâ”€â”€ integrations/    # ç¬¬ä¸‰æ–¹æ•´åˆ
â”‚   â”‚   â”œâ”€â”€ stripe.py    # Stripeï¼ˆä¸»è¦ï¼‰
â”‚   â”‚   â””â”€â”€ paypal.py    # PayPalï¼ˆå‚™ç”¨ï¼‰
â”‚   â””â”€â”€ models.py        # æ”¯ä»˜æ¨¡å‹
â””â”€â”€ utils/               # å·¥å…·å‡½å¼
    â”œâ”€â”€ encryption.py    # åŠ å¯†å·¥å…·
    â”œâ”€â”€ cache.py         # å¿«å–å·¥å…·
    â””â”€â”€ rate_limiter.py  # é™æµå·¥å…·
```

## ğŸ”§ é–‹ç™¼ç’°å¢ƒè¨­å®š

### å‰ç½®éœ€æ±‚
- Python 3.11+
- Docker & Docker Compose
- PostgreSQL 14+ (æˆ–ä½¿ç”¨ Docker)
- Redis 7+ (æˆ–ä½¿ç”¨ Docker)

### å®‰è£æ­¥é©Ÿ
```bash
# 1. Clone å°ˆæ¡ˆ
git clone https://github.com/company/shophub.git
cd shophub

# 2. å»ºç«‹è™›æ“¬ç’°å¢ƒ
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 3. å®‰è£ä¾è³´
pip install -r requirements.txt

# 4. è¨­å®šç’°å¢ƒè®Šæ•¸
cp .env.example .env
# ç·¨è¼¯ .envï¼Œå¡«å…¥ DATABASE_URL, REDIS_URL, STRIPE_API_KEY

# 5. å•Ÿå‹•è³‡æ–™åº«ï¼ˆä½¿ç”¨ Dockerï¼‰
docker-compose up -d postgres redis

# 6. åŸ·è¡Œè³‡æ–™åº«é·ç§»
alembic upgrade head

# 7. å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
uvicorn api.main:app --reload
```

### å¸¸è¦‹å•é¡Œ
**Q**: åŸ·è¡Œ `alembic upgrade head` å¤±æ•—ï¼Ÿ
**A**: æª¢æŸ¥ `DATABASE_URL` æ˜¯å¦æ­£ç¢ºï¼Œç¢ºä¿ PostgreSQL å·²å•Ÿå‹•ã€‚

**Q**: ç‚ºä»€éº¼ç„¡æ³•é€£ç·šåˆ° Redisï¼Ÿ
**A**: ç¢ºèª Docker å®¹å™¨å·²å•Ÿå‹•ï¼š`docker-compose ps`

## ğŸ“š çŸ¥è­˜åº«

### æ ¸å¿ƒæ¦‚å¿µ
- **è¨‚å–®ç‹€æ…‹æ©Ÿ**: è¨‚å–®å¾å»ºç«‹åˆ°å®Œæˆçš„æ‰€æœ‰ç‹€æ…‹è½‰æ›ï¼ˆè©³è¦‹ `orders/state_machine.py`ï¼‰
- **æ”¯ä»˜æµç¨‹**: ä½¿ç”¨ Stripe Webhook è™•ç†éåŒæ­¥æ”¯ä»˜é€šçŸ¥
- **å¿«å–ç­–ç•¥**: Cache-Aside æ¨¡å¼ï¼Œå…ˆæŸ¥å¿«å–ï¼Œmiss å‰‡æŸ¥è³‡æ–™åº«ä¸¦å¯«å…¥å¿«å–

### åœ˜éšŠæ…£ä¾‹
- **Coding Style**: éµå¾ª PEP 8 + Black æ ¼å¼åŒ–
- **Git Workflow**: GitHub Flowï¼ˆmain + feature branchesï¼‰
- **Code Review æ¨™æº–**:
  - å¿…é ˆæœ‰æ¸¬è©¦
  - è‡³å°‘ 1 å€‹ approval
  - CI å¿…é ˆé€šéï¼ˆlinting + testsï¼‰
- **Commit è¨Šæ¯æ ¼å¼**: `[é¡å‹] ç°¡çŸ­æè¿°`ï¼ˆä¾‹å¦‚ï¼š`[feat] Add Stripe webhook handler`ï¼‰

## ğŸ“ è®Šæ›´è¨˜éŒ„
- **2025-11-01**: å‡ç´š PostgreSQL 13 â†’ 14ï¼ˆæŸ¥è©¢æ•ˆèƒ½æå‡ 30%ï¼‰
- **2025-10-15**: é‡æ§‹æ”¯ä»˜æ¨¡çµ„ï¼ˆæ”¯æ´å¤šå¹£åˆ¥ï¼šUSD, EUR, TWDï¼‰
- **2025-09-20**: æ–°å¢ Redis Clusterï¼ˆè§£æ±ºå–®é»æ•…éšœå•é¡Œï¼‰
- **2025-08-10**: å¯¦ä½œè¨‚å–®ç‹€æ…‹æ©Ÿï¼ˆå–ä»£åŸæœ¬çš„ if-else é‚è¼¯ï¼‰

## ğŸ”— ç›¸é—œè³‡æº
- **ç”¢å“æ–‡ä»¶**: https://docs.shophub.com
- **API æ–‡ä»¶**: https://api.shophub.com/docs
- **è¨­è¨ˆç¨¿**: https://figma.com/shophub
- **åœ˜éšŠ Wiki**: https://wiki.shophub.com
