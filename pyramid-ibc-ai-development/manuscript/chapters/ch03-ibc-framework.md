# 第三章：認識 I-B-C 框架

**在這一章中，你將學會：**
- 為什麼需要一個結構化的框架來與 AI 協作
- I-B-C 框架的三根支柱：Intent、Behavior、Context
- 5W2H 檢查清單：確保你沒有遺漏關鍵資訊
- 實際運用框架完成一個完整的開發任務

> 💡 **開場白**
>
> 如果金字塔原則告訴你「結構很重要」，那麼 I-B-C 框架就是告訴你「結構裡面要放什麼」。
>
> 這就像是：金字塔原則是房子的骨架，I-B-C 框架是牆壁、門窗和水電管線。有了骨架不代表能住人，你還需要知道每個位置該放什麼。

---

## 3.1 為什麼需要結構化框架

在我們進入 I-B-C 框架之前，讓我先問你一個問題：

**你有沒有這樣的經驗？**

- 花了 30 分鐘跟 AI 來回對話，最後得到的結果還是不對
- AI 產出的程式碼「技術上正確」，但完全不符合你的需求
- 你說「不是這樣」，AI 就改成另一個方向，然後你又說「也不是這樣」
- 最後你放棄了，決定自己寫比較快

如果你有以上任何一個經驗，問題很可能出在：**你的第一個指令就沒有說清楚**。

### 「乒乓球對話」的代價

讓我們計算一下「來回修正」的成本：

```
你：幫我寫一個用戶註冊功能
AI：[產出程式碼 A]
你：不對，我們用的是 email 而不是 username
AI：[產出程式碼 B]
你：還要加上 email 驗證
AI：[產出程式碼 C]
你：密碼要符合規則
AI：[產出程式碼 D]
你：我們用的是 PostgreSQL 不是 MySQL
AI：[產出程式碼 E]
你：可以用我們現有的 User 模型嗎
AI：[產出程式碼 F]
```

**六次來回！**

每一次 AI 產出的程式碼，你都需要：
1. 閱讀理解（1-2 分鐘）
2. 找出問題（1-2 分鐘）
3. 解釋問題（1-2 分鐘）
4. 等待新的輸出（10-30 秒）

六次來回 = 約 **20-30 分鐘**。

但如果你第一次就說清楚呢？

```
【目標】
實作用戶註冊 API

【使用者故事】
作為一個訪客，我希望能用 email 註冊帳號，
這樣我就可以使用網站的會員功能。

【行為規格】
輸入：
- email（必填，需驗證格式）
- password（必填，至少 8 字元，含大小寫和數字）
- name（必填，2-50 字元）

輸出（成功）：
- HTTP 201
- { "id": uuid, "email": string, "name": string, "created_at": datetime }

輸出（失敗）：
- HTTP 409：email 已存在
- HTTP 422：輸入格式不正確

【技術上下文】
- FastAPI + SQLAlchemy + PostgreSQL
- 使用現有的 User 模型（models/user.py）
- 密碼用 bcrypt 加密
- 參考 routers/auth.py 的程式碼風格
```

**一次到位！** 約 **5 分鐘**。

> ⚡ **快速複習**
>
> 結構化框架的價值：
> - 減少來回次數
> - 節省時間（你的和 AI 的）
> - 得到更準確的結果
> - 建立可重複使用的模式

---

## 3.2 Intent-Behavior-Context 三支柱

好，現在讓我們正式介紹 **I-B-C 框架**。

I-B-C 是三個英文字的縮寫：
- **I**ntent（意圖）
- **B**ehavior（行為）
- **C**ontext（上下文）

把它想像成一張椅子的三隻腳——少了任何一隻，椅子就會倒。

```
        ┌─────────────────────────────────┐
        │                                 │
        │      你想要 AI 完成的任務        │
        │                                 │
        └─────────────────────────────────┘
                        │
        ┌───────────────┼───────────────┐
        │               │               │
        ▼               ▼               ▼
   ┌─────────┐    ┌─────────┐    ┌─────────┐
   │ Intent  │    │Behavior │    │ Context │
   │  意圖   │    │  行為   │    │ 上下文  │
   │         │    │         │    │         │
   │ 為什麼  │    │ 是什麼  │    │ 在哪裡  │
   │ 做這件事 │    │  完成   │    │ 怎麼做  │
   └─────────┘    └─────────┘    └─────────┘
```

讓我們逐一深入。

---

### 支柱一：Intent（意圖）— 為什麼

**簡單來說...**

Intent 回答的是「為什麼要做這件事」。它是任務的**北極星**，讓 AI 知道方向。

**深入一點...**

Intent 不只是「我要什麼」，更重要的是「我想達成什麼目的」。這兩者的差別很微妙但很重要。

**舉個例子：**

❌ **只說「要什麼」：**
```
我需要一個快取功能
```

✅ **說「想達成什麼目的」：**
```
【意圖】
我們的商品列表 API 目前每次請求都要查資料庫，
在高峰時段造成資料庫負載過高。
我希望透過快取來減少資料庫查詢，目標是將資料庫負載降低 70%。
```

第二個版本告訴 AI **為什麼**需要快取。這讓 AI 可以：
- 選擇適合「減少資料庫負載」的快取策略
- 考慮快取失效的時機
- 評估是否有其他解決方案（可能更好）

> 🎯 **實戰技巧**
>
> 寫 Intent 時，試著用「User Story」的格式：
>
> **作為**〈角色〉，
> **我希望**〈功能〉，
> **這樣我就可以**〈價值〉。
>
> 例如：
> 作為**系統管理員**，
> 我希望**有一個商品快取機制**，
> 這樣我就可以**在高峰時段維持系統穩定**。

---

### 支柱二：Behavior（行為）— 是什麼算完成

**簡單來說...**

Behavior 回答的是「怎樣算做完了」。它是任務的**驗收標準**。

**深入一點...**

Behavior 是你用來判斷「AI 有沒有做對」的依據。如果你無法清楚描述 Behavior，那你也無法判斷結果是否正確。

好的 Behavior 描述應該是**可驗證的**（Verifiable）。

**舉個例子：**

❌ **不可驗證的 Behavior：**
```
API 要快一點
```
（什麼叫「快」？多快才算快？）

✅ **可驗證的 Behavior：**
```
【行為規格】

1. 效能要求：
   - 在快取命中時，API 回應時間 < 50ms
   - 在快取未命中時，API 回應時間 < 200ms
   - 快取命中率目標 > 80%

2. API 行為：
   - GET /api/products：回傳商品列表，支援分頁
   - 快取失效時間：5 分鐘
   - 當商品更新時，主動清除對應快取

3. 錯誤處理：
   - 快取連線失敗時，直接查資料庫（降級策略）
   - 記錄快取錯誤到日誌
```

> 💡 **小提示**
>
> 在寫 Behavior 時，問自己：「我要怎麼測試這個功能？」
> 如果你能列出測試步驟，那這個 Behavior 就夠清楚了。

---

### 支柱三：Context（上下文）— 在哪裡、怎麼做

**簡單來說...**

Context 回答的是「在什麼環境下完成」。它是任務的**邊界條件**。

**深入一點...**

Context 包含所有 AI 需要知道但「不會自己猜到」的資訊：
- 技術棧是什麼
- 現有程式碼在哪裡
- 有什麼限制和偏好
- 團隊的 coding style
- 歷史決策和原因

**舉個例子：**

❌ **缺乏 Context：**
```
幫我實作快取
```
（用什麼？Redis？Memcached？本地快取？）

✅ **充足的 Context：**
```
【技術上下文】

1. 技術棧：
   - Python 3.11 + FastAPI
   - Redis 7.0（已部署，連線資訊在環境變數）
   - 現有的 Redis 工具函數在 utils/redis_client.py

2. 現有架構：
   - 商品 API 在 routers/products.py
   - 商品模型在 models/product.py
   - 目前沒有快取，每次都查 PostgreSQL

3. 限制：
   - 不能引入新的外部套件
   - 要相容現有的 API 介面（不能改 request/response 格式）

4. 偏好：
   - 快取 key 格式：products:{filter_hash}
   - 使用現有的 logger 記錄快取操作
   - 新增測試到 tests/test_products_cache.py
```

> ⚠️ **注意**
>
> Context 最容易被忽略，但往往是造成「AI 產出不符預期」的主因。
>
> 想像你請一個新人幫你做事，但不告訴他公司的系統架構、coding style、Git workflow...結果會怎樣？

---

## 3.3 5W2H 檢查清單

I-B-C 框架給了你一個結構，但你怎麼知道每個部分有沒有寫完整呢？

這裡有一個檢查清單：**5W2H**。

```
┌─────────────────────────────────────────────────────────────┐
│                      5W2H 檢查清單                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  What?    （是什麼）── 你要 AI 做什麼？                      │
│  Why?     （為什麼）── 為什麼要做這件事？                    │
│  Who?     （誰）   ── 誰會使用？誰會受影響？                 │
│  Where?   （在哪裡）── 在哪個檔案/模組/系統？                │
│  When?    （何時）── 什麼情況下觸發？有時間限制嗎？          │
│                                                             │
│  How?     （如何）── 用什麼技術/方法？                       │
│  How much?（多少）── 效能指標？規模限制？                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

讓我們用這個清單來檢查一個範例：

### 範例：實作商品搜尋功能

**原始指令：**
```
幫我做商品搜尋
```

**用 5W2H 檢查：**

| 問題 | 是否有回答？ | 遺漏的資訊 |
|------|-------------|-----------|
| What? | 部分 ✓ | 搜尋什麼？標題？描述？全部？ |
| Why? | ❌ | 為什麼需要搜尋？現有方案的問題？ |
| Who? | ❌ | 誰會用？一般用戶？管理員？ |
| Where? | ❌ | 在哪個 API 端點？哪個檔案？ |
| When? | ❌ | 即時搜尋？按下按鈕才搜尋？ |
| How? | ❌ | 用什麼技術？全文搜尋？LIKE 查詢？ |
| How much? | ❌ | 效能要求？商品數量？ |

**改進後的指令：**

```
【Intent（意圖）】

Why: 目前用戶只能瀏覽分類，無法快速找到想要的商品。
     客服反映每天有 50+ 通電話是問「某某商品在哪」。
     我們需要讓用戶能自己搜尋。

Who: 一般用戶（前台）

【Behavior（行為）】

What: 實作商品搜尋 API

When: 用戶在搜尋框輸入關鍵字並送出時觸發

輸入輸出規格：
- GET /api/products/search?q={keyword}&page={n}&limit={m}
- 回傳：{ "items": [...], "total": number }
- 搜尋範圍：商品標題、描述、SKU
- 排序：相關度優先，同相關度按銷量排序

How much（效能指標）:
- 回應時間 < 300ms（P95）
- 支援 100 萬商品量級
- 支援中文和英文混合搜尋

【Context（上下文）】

Where:
- 新增 API 端點到 routers/products.py
- 搜尋邏輯放在 services/product_search.py

How:
- 使用 PostgreSQL 的全文搜尋功能（已安裝 pg_trgm 擴充）
- 參考現有的 routers/products.py 的程式碼風格
- 商品模型在 models/product.py
```

看到差別了嗎？改進後的指令回答了所有 5W2H 的問題。

---

## 3.4 框架實戰演練

理論說得夠多了，讓我們來做一個完整的練習！

### 🚀 試試看：實作「忘記密碼」功能

**場景描述：**

你正在開發一個電商網站。PM 跟你說：「我們需要讓用戶可以重設密碼。」

現在，請用 I-B-C 框架設計一個完整的指令給 Claude Code。

**提示：** 在開始之前，先用 5W2H 列出你需要回答的問題。

---

**先自己試試看，然後對照下方的參考答案！**

---

### 參考答案

```
【Intent（意圖）】

作為一個電商網站的用戶，
我希望能夠在忘記密碼時重設密碼，
這樣我就可以在忘記密碼後仍能使用我的帳號購物。

背景：
- 目前用戶忘記密碼只能聯繫客服，平均處理時間 2 小時
- 每月約有 500 位用戶有此需求
- 這是上線前必須完成的功能

【Behavior（行為）】

## 功能流程

1. 用戶在登入頁點擊「忘記密碼」
2. 輸入註冊 email
3. 系統發送重設密碼連結到該 email（連結有效期 1 小時）
4. 用戶點擊連結，進入重設密碼頁面
5. 輸入新密碼（兩次確認）
6. 密碼重設成功，跳轉到登入頁

## API 規格

### POST /api/auth/forgot-password
請求：
{
  "email": "user@example.com"
}

回應（成功）：
- HTTP 200
- { "message": "重設密碼郵件已發送" }

回應（失敗）：
- HTTP 404：email 不存在（注意：基於安全考量，統一回 200）
- HTTP 429：同一 email 10 分鐘內只能請求一次

### POST /api/auth/reset-password
請求：
{
  "token": "abc123...",
  "new_password": "newPassword123"
}

回應（成功）：
- HTTP 200
- { "message": "密碼已重設" }

回應（失敗）：
- HTTP 400：token 無效或過期
- HTTP 422：密碼格式不符要求

## 安全要求

- 重設連結 token 使用 cryptographically secure random
- Token 長度至少 32 字元
- Token 只能使用一次
- 密碼重設後，所有現有的 session 都要失效
- 重設密碼連結不應洩漏 email 是否存在

【Context（上下文）】

## 技術棧
- Python 3.11 + FastAPI
- PostgreSQL + SQLAlchemy 2.0
- Redis（用於 rate limiting）
- SendGrid API 發送郵件（已有 utils/email.py）

## 現有架構
- 認證相關 API 在 routers/auth.py
- User 模型在 models/user.py
- 密碼加密使用 bcrypt（現有函數在 utils/security.py）

## 資料庫設計建議
新增 password_reset_tokens 表：
- id: UUID
- user_id: FK to users
- token: string (hashed)
- expires_at: datetime
- used_at: datetime (nullable)
- created_at: datetime

## 需要新增的檔案
- services/password_reset.py（業務邏輯）
- tests/test_password_reset.py（測試案例）
- templates/emails/password_reset.html（郵件模板）

## 限制與偏好
- 必須：所有新 API 都要有 type hints
- 必須：每個函數都要有 docstring
- 禁止：不要把 token 明文存在資料庫
- 偏好：錯誤訊息使用中文
```

---

### 使用這個指令

現在，把這個指令貼給 Claude Code。觀察它的回應：

1. 它是否理解了需求？
2. 它產出的程式碼是否符合你的預期？
3. 需要多少次來回修正？

如果你發現還是需要多次修正，思考一下：是 I、B、還是 C 沒有說清楚？

---

## 本章重點回顧

- **要點 1**：結構化框架減少「乒乓球對話」，節省時間並得到更準確的結果。

- **要點 2**：I-B-C 框架包含三個支柱——Intent（為什麼）、Behavior（是什麼算完成）、Context（在哪裡怎麼做）。

- **要點 3**：使用 5W2H 檢查清單確保你沒有遺漏關鍵資訊。

- **要點 4**：好的指令應該讓 AI「一次就做對」，而不是需要多次來回修正。

---

## 大腦體操 🧠

**問題 1：**
如果你只能提供 I、B、C 其中一個，你會選哪一個？為什麼？

**問題 2：**
以下指令缺少了 I-B-C 的哪個部分？該如何補充？
```
請用 React 寫一個登入表單，要有 email 和密碼欄位，
登入成功後跳轉到首頁。
```

**問題 3：**
為什麼「可驗證的 Behavior」比「模糊的 Behavior」更重要？舉一個實際的例子說明。

---

## 下一章預告

你已經認識了 I-B-C 框架的全貌。從下一章開始，我們將逐一深入每個支柱。

第四章將聚焦於 **Intent（意圖）**——如何用 User Story 表達意圖、如何平衡業務需求和技術需求、以及如何利用 MCP 自動獲取需求資訊。

準備好深入意圖的世界了嗎？

---

> 📝 **讀者筆記區**
>
> 你過去的指令最常缺少 I-B-C 的哪個部分？
>
> _________________________________
>
> 5W2H 中，哪個問題你最容易忘記回答？
>
> _________________________________
>
> 實戰演練後，你需要幾次來回修正才得到滿意的結果？
>
> _________________________________
