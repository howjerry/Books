# ç¬¬ 6 ç« ï¼šäº‹ä»¶é©…å‹•èˆ‡è‡ªå‹•åŒ– (Event-Driven & Automation)

> ã€Œæœ€å¥½çš„è‡ªå‹•åŒ–æ˜¯ä½ æ„Ÿè¦ºä¸åˆ°å®ƒå­˜åœ¨çš„è‡ªå‹•åŒ–ã€‚ã€
> â€”â€” CloudMart è‡ªå‹•åŒ–å·¥ç¨‹å¸«

---

## æœ¬ç« å­¸ç¿’ç›®æ¨™

å®Œæˆæœ¬ç« å¾Œï¼Œä½ å°‡èƒ½å¤ ï¼š

- è§£é‡‹äº‹ä»¶é©…å‹•æ¶æ§‹çš„æ ¸å¿ƒæ¦‚å¿µ
- è¨­è¨ˆ Webhook æ¥æ”¶å’Œè™•ç†æ©Ÿåˆ¶
- ç†è§£ç„¡ä¼ºæœå™¨é‹ç®—çš„å„ªå‹¢å’Œé™åˆ¶
- ä½¿ç”¨ Azure Functions å»ºç«‹äº‹ä»¶é©…å‹•æ‡‰ç”¨
- é…ç½® Azure Event Grid é€²è¡Œäº‹ä»¶è·¯ç”±
- å»ºç«‹è‡ªå‹•åŒ–å·¥ä½œæµç¨‹

---

## 6.1 åº«å­˜å±æ©Ÿï¼šäººå·¥ç›£æ§çš„æ¥µé™

2023 å¹´æŸå€‹é€±ä¸‰ä¸‹åˆï¼ŒCloudMart çš„æš¢éŠ·å•†å“ã€Œç„¡ç·šé™å™ªè€³æ©Ÿ Proã€åº«å­˜è¦‹åº•ã€‚

ä½†æ²’æœ‰äººçŸ¥é“ã€‚

å®¢æœé–‹å§‹æ”¶åˆ°æŠ±æ€¨ï¼šã€Œç‚ºä»€éº¼æˆ‘ä¸‹å–®å¾Œä¸€é€±é‚„æ²’ç™¼è²¨ï¼Ÿã€åº«ç®¡äººå“¡ä¸€æŸ¥ï¼Œç™¼ç¾åº«å­˜æ—©å°±æ˜¯é›¶ï¼Œä½†ç³»çµ±é‚„åœ¨æ¥å–®ã€‚

æå¤±çµ±è¨ˆï¼š
- 47 ç­†ç„¡æ³•å±¥è¡Œçš„è¨‚å–®
- å¤§é‡é€€æ¬¾è™•ç†
- å®¢æˆ¶ä¿¡ä»»åº¦ä¸‹é™

äº‹å¾Œæª¢è¨ç™¼ç¾å•é¡Œï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    äººå·¥ç›£æ§çš„å•é¡Œ                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ç¾æœ‰æµç¨‹ï¼š                                                      â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ åº«å­˜ç³»çµ± â”‚      â”‚ äººå·¥æª¢æŸ¥ â”‚      â”‚ é€šçŸ¥æ¡è³¼ â”‚                 â”‚
â”‚  â”‚         â”‚ â”€â”€â”€â–º â”‚ (æ¯å¤©1æ¬¡)â”‚ â”€â”€â”€â–º â”‚         â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                        â”‚                                        â”‚
â”‚                        â”‚ å•é¡Œï¼š                                  â”‚
â”‚                        â”‚ â€¢ æª¢æŸ¥é »ç‡å¤ªä½                          â”‚
â”‚                        â”‚ â€¢ äººç‚ºç–å¿½                              â”‚
â”‚                        â”‚ â€¢ æ²’æœ‰å³æ™‚æ€§                            â”‚
â”‚                        â–¼                                        â”‚
â”‚                   åº«å­˜æ­¸é›¶ä½†                                     â”‚
â”‚                   ç„¡äººå¯Ÿè¦º                                       â”‚
â”‚                                                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                 â”‚
â”‚  ç†æƒ³æµç¨‹ï¼ˆäº‹ä»¶é©…å‹•ï¼‰ï¼š                                          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” åº«å­˜è®ŠåŒ–  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” è‡ªå‹•è§¸ç™¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ åº«å­˜ç³»çµ± â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ äº‹ä»¶è™•ç† â”‚ â”€â”€â”€â”€â”€â”€â”€â–º â”‚ é€šçŸ¥æ¡è³¼ â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   äº‹ä»¶    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   å³æ™‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                            â”‚                                    â”‚
â”‚                            â”‚ åŒæ™‚ï¼š                              â”‚
â”‚                            â”œâ”€â”€â–º æ›´æ–°å•†å“ç‹€æ…‹ï¼ˆç¼ºè²¨ï¼‰              â”‚
â”‚                            â”œâ”€â”€â–º é€šçŸ¥ç›¸é—œäººå“¡                     â”‚
â”‚                            â””â”€â”€â–º è¨˜éŒ„åˆ†ææ•¸æ“š                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6.2 äº‹ä»¶é©…å‹•æ¶æ§‹

### 6.2.1 ä»€éº¼æ˜¯äº‹ä»¶é©…å‹•æ¶æ§‹ï¼Ÿ

**äº‹ä»¶é©…å‹•æ¶æ§‹ï¼ˆEvent-Driven Architecture, EDAï¼‰** æ˜¯ä¸€ç¨®è»Ÿé«”è¨­è¨ˆæ¨¡å¼ï¼Œç³»çµ±çš„è¡Œç‚ºç”±äº‹ä»¶çš„ç™¼ç”Ÿä¾†è§¸ç™¼ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    äº‹ä»¶é©…å‹•æ¶æ§‹æ¦‚å¿µ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  å‚³çµ±æ¶æ§‹ï¼ˆè«‹æ±‚-å›æ‡‰ï¼‰                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  Client â”€â”€è«‹æ±‚â”€â”€â–º Service A â”€â”€è«‹æ±‚â”€â”€â–º Service B           â”‚ â”‚
â”‚  â”‚    â”‚                 â”‚                 â”‚                  â”‚ â”‚
â”‚  â”‚    â”‚â—„â”€â”€â”€å›æ‡‰â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€å›æ‡‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  ç‰¹é»ï¼šåŒæ­¥ã€ç·Šè€¦åˆã€ç­‰å¾…å›æ‡‰                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  äº‹ä»¶é©…å‹•æ¶æ§‹                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  Producer â”€â”€äº‹ä»¶â”€â”€â–º Event Router â”€â”€â–º Consumer A           â”‚ â”‚
â”‚  â”‚                          â”‚                                â”‚ â”‚
â”‚  â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â–º Consumer B             â”‚ â”‚
â”‚  â”‚                          â”‚                                â”‚ â”‚
â”‚  â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â–º Consumer C             â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  ç‰¹é»ï¼šéåŒæ­¥ã€é¬†è€¦åˆã€å³æ™‚åæ‡‰                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  æ ¸å¿ƒçµ„ä»¶ï¼š                                                      â”‚
â”‚                                                                 â”‚
â”‚  1. Event Producerï¼ˆäº‹ä»¶ç”Ÿç”¢è€…ï¼‰                                 â”‚
â”‚     ç”¢ç”Ÿäº‹ä»¶çš„ç³»çµ±æˆ–æœå‹™                                         â”‚
â”‚                                                                 â”‚
â”‚  2. Event Routerï¼ˆäº‹ä»¶è·¯ç”±å™¨ï¼‰                                   â”‚
â”‚     æ¥æ”¶äº‹ä»¶ä¸¦åˆ†ç™¼åˆ°ç›¸é—œçš„æ¶ˆè²»è€…                                 â”‚
â”‚                                                                 â”‚
â”‚  3. Event Consumerï¼ˆäº‹ä»¶æ¶ˆè²»è€…ï¼‰                                 â”‚
â”‚     æ¥æ”¶ä¸¦è™•ç†äº‹ä»¶çš„ç³»çµ±æˆ–æœå‹™                                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2.2 äº‹ä»¶çš„çµæ§‹

```json
{
  "id": "evt-20240115-abc123",
  "source": "inventory-service",
  "type": "inventory.stock.low",
  "time": "2024-01-15T14:30:00Z",
  "datacontenttype": "application/json",
  "subject": "/products/HEADPHONE-PRO-001",
  "data": {
    "productId": "HEADPHONE-PRO-001",
    "productName": "ç„¡ç·šé™å™ªè€³æ©Ÿ Pro",
    "currentStock": 5,
    "threshold": 10,
    "warehouseId": "WH-TAIPEI-01"
  }
}
```

**äº‹ä»¶çµæ§‹èªªæ˜ï¼š**

| æ¬„ä½ | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|
| `id` | äº‹ä»¶çš„å”¯ä¸€è­˜åˆ¥ç¢¼ | evt-20240115-abc123 |
| `source` | ç”¢ç”Ÿäº‹ä»¶çš„ç³»çµ± | inventory-service |
| `type` | äº‹ä»¶é¡å‹ | inventory.stock.low |
| `time` | äº‹ä»¶ç™¼ç”Ÿæ™‚é–“ | ISO 8601 æ ¼å¼ |
| `subject` | äº‹ä»¶ä¸»é«” | /products/HEADPHONE-PRO-001 |
| `data` | äº‹ä»¶çš„è©³ç´°è³‡æ–™ | JSON ç‰©ä»¶ |

---

## 6.3 Webhookï¼šäº‹ä»¶çš„å³æ™‚é€šçŸ¥

### 6.3.1 ä»€éº¼æ˜¯ Webhookï¼Ÿ

**Webhook** æ˜¯ä¸€ç¨®ã€Œåå‘ APIã€â€”â€”ç•¶äº‹ä»¶ç™¼ç”Ÿæ™‚ï¼Œç³»çµ±ä¸»å‹•å‘ä½ æŒ‡å®šçš„ URL ç™¼é€ HTTP è«‹æ±‚ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Webhook vs. è¼ªè©¢                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  è¼ªè©¢ï¼ˆPollingï¼‰                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  Client â”€â”€æœ‰æ–°è³‡æ–™å—?â”€â”€â–º Server                           â”‚ â”‚
â”‚  â”‚    â”‚â—„â”€â”€â”€â”€â”€æ²’æœ‰â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚ â”‚
â”‚  â”‚    â”‚                                                      â”‚ â”‚
â”‚  â”‚    â”‚â”€â”€æœ‰æ–°è³‡æ–™å—?â”€â”€â–º Server                               â”‚ â”‚
â”‚  â”‚    â”‚â—„â”€â”€â”€â”€â”€æ²’æœ‰â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚ â”‚
â”‚  â”‚    â”‚                                                      â”‚ â”‚
â”‚  â”‚    â”‚â”€â”€æœ‰æ–°è³‡æ–™å—?â”€â”€â–º Server                               â”‚ â”‚
â”‚  â”‚    â”‚â—„â”€â”€â”€â”€â”€æœ‰ï¼â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  å•é¡Œï¼š                                                    â”‚ â”‚
â”‚  â”‚  â€¢ æµªè²»è³‡æºï¼ˆå¤§é‡ç„¡æ•ˆè«‹æ±‚ï¼‰                                â”‚ â”‚
â”‚  â”‚  â€¢ å»¶é²ï¼ˆå–æ±ºæ–¼è¼ªè©¢é–“éš”ï¼‰                                  â”‚ â”‚
â”‚  â”‚  â€¢ ä¼ºæœå™¨è² è¼‰é«˜                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  Webhookï¼ˆæ¨é€ï¼‰                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  [äº‹ä»¶ç™¼ç”Ÿ]                                                â”‚ â”‚
â”‚  â”‚      â”‚                                                    â”‚ â”‚
â”‚  â”‚      â–¼                                                    â”‚ â”‚
â”‚  â”‚  Server â”€â”€POST äº‹ä»¶è³‡æ–™â”€â”€â–º Client Webhook URL             â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  å„ªé»ï¼š                                                    â”‚ â”‚
â”‚  â”‚  â€¢ å³æ™‚é€šçŸ¥                                                â”‚ â”‚
â”‚  â”‚  â€¢ ç¯€çœè³‡æº                                                â”‚ â”‚
â”‚  â”‚  â€¢ é™ä½ä¼ºæœå™¨è² è¼‰                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3.2 å¯¦ä½œ Webhook æ¥æ”¶å™¨

```javascript
// webhook-receiver.js
// CloudMart Webhook æ¥æ”¶å™¨

const express = require('express');
const crypto = require('crypto');

const app = express();
app.use(express.json());

// Webhook å¯†é‘°ï¼ˆç”¨æ–¼é©—è­‰è«‹æ±‚ä¾†æºï¼‰
const WEBHOOK_SECRET = process.env.WEBHOOK_SECRET;

// é©—è­‰ Webhook ç°½å
function verifySignature(payload, signature) {
    const expectedSignature = crypto
        .createHmac('sha256', WEBHOOK_SECRET)
        .update(JSON.stringify(payload))
        .digest('hex');

    return crypto.timingSafeEqual(
        Buffer.from(signature),
        Buffer.from(`sha256=${expectedSignature}`)
    );
}

// Webhook æ¥æ”¶ç«¯é»
app.post('/webhooks/inventory', async (req, res) => {
    // 1. é©—è­‰ç°½å
    const signature = req.headers['x-webhook-signature'];
    if (!verifySignature(req.body, signature)) {
        console.error('Invalid webhook signature');
        return res.status(401).json({ error: 'Invalid signature' });
    }

    // 2. å¿«é€Ÿå›æ‡‰ï¼ˆé¿å…è¶…æ™‚ï¼‰
    res.status(200).json({ received: true });

    // 3. éåŒæ­¥è™•ç†äº‹ä»¶
    try {
        await handleInventoryEvent(req.body);
    } catch (error) {
        console.error('Error processing webhook:', error);
        // è¨˜éŒ„å¤±æ•—ï¼Œç¨å¾Œé‡è©¦
        await queueForRetry(req.body);
    }
});

// è™•ç†åº«å­˜äº‹ä»¶
async function handleInventoryEvent(event) {
    console.log(`Received event: ${event.type}`);

    switch (event.type) {
        case 'inventory.stock.low':
            await handleLowStock(event.data);
            break;

        case 'inventory.stock.out':
            await handleOutOfStock(event.data);
            break;

        case 'inventory.stock.replenished':
            await handleReplenished(event.data);
            break;

        default:
            console.log(`Unknown event type: ${event.type}`);
    }
}

// è™•ç†ä½åº«å­˜è­¦å‘Š
async function handleLowStock(data) {
    console.log(`Low stock alert for ${data.productName}`);

    // 1. ç™¼é€é€šçŸ¥çµ¦æ¡è³¼äººå“¡
    await sendNotification({
        channel: 'slack',
        message: `âš ï¸ ä½åº«å­˜è­¦å‘Š\nå•†å“ï¼š${data.productName}\nç›®å‰åº«å­˜ï¼š${data.currentStock}\nå®‰å…¨åº«å­˜ï¼š${data.threshold}`,
        recipients: ['procurement-team']
    });

    // 2. è‡ªå‹•å»ºç«‹æ¡è³¼å–®ï¼ˆå¦‚æœå•Ÿç”¨è‡ªå‹•æ¡è³¼ï¼‰
    if (data.currentStock <= data.threshold / 2) {
        await createPurchaseOrder({
            productId: data.productId,
            quantity: data.threshold * 2,
            priority: 'high'
        });
    }

    // 3. è¨˜éŒ„äº‹ä»¶åˆ°åˆ†æç³»çµ±
    await logAnalytics({
        event: 'low_stock_alert',
        productId: data.productId,
        currentStock: data.currentStock
    });
}

// è™•ç†ç¼ºè²¨
async function handleOutOfStock(data) {
    console.log(`Out of stock: ${data.productName}`);

    // 1. æ›´æ–°å•†å“ç‹€æ…‹
    await updateProductStatus(data.productId, 'out_of_stock');

    // 2. ç·Šæ€¥é€šçŸ¥
    await sendNotification({
        channel: 'sms',
        message: `ğŸš¨ ç·Šæ€¥ï¼š${data.productName} å·²ç¼ºè²¨ï¼`,
        recipients: ['warehouse-manager', 'procurement-lead']
    });

    // 3. æš«åœè©²å•†å“çš„å»£å‘ŠæŠ•æ”¾
    await pauseProductAds(data.productId);
}

app.listen(3000, () => {
    console.log('Webhook receiver listening on port 3000');
});
```

### 6.3.3 Webhook æœ€ä½³å¯¦è¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Webhook æœ€ä½³å¯¦è¸                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. å¿«é€Ÿå›æ‡‰                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  // âœ“ æ­£ç¢ºï¼šå…ˆå›æ‡‰ï¼Œå†è™•ç†                                 â”‚ â”‚
â”‚  â”‚  app.post('/webhook', (req, res) => {                     â”‚ â”‚
â”‚  â”‚      res.status(200).send('OK');  // ç«‹å³å›æ‡‰              â”‚ â”‚
â”‚  â”‚      processAsync(req.body);      // éåŒæ­¥è™•ç†            â”‚ â”‚
â”‚  â”‚  });                                                      â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  // âœ— éŒ¯èª¤ï¼šè™•ç†å®Œæ‰å›æ‡‰                                   â”‚ â”‚
â”‚  â”‚  app.post('/webhook', async (req, res) => {               â”‚ â”‚
â”‚  â”‚      await longProcess(req.body);  // å¯èƒ½è¶…æ™‚             â”‚ â”‚
â”‚  â”‚      res.status(200).send('OK');                          â”‚ â”‚
â”‚  â”‚  });                                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  2. é©—è­‰ä¾†æº                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â€¢ ä½¿ç”¨ HMAC ç°½åé©—è­‰                                      â”‚ â”‚
â”‚  â”‚  â€¢ æª¢æŸ¥ä¾†æº IPï¼ˆå¦‚æœå¯èƒ½ï¼‰                                 â”‚ â”‚
â”‚  â”‚  â€¢ é©—è­‰æ™‚é–“æˆ³è¨˜ï¼ˆé˜²æ­¢é‡æ”¾æ”»æ“Šï¼‰                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  3. å†ªç­‰è™•ç†                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  // ä½¿ç”¨äº‹ä»¶ ID ç¢ºä¿ä¸é‡è¤‡è™•ç†                             â”‚ â”‚
â”‚  â”‚  async function handleEvent(event) {                      â”‚ â”‚
â”‚  â”‚      if (await isProcessed(event.id)) {                   â”‚ â”‚
â”‚  â”‚          return; // å·²è™•ç†éï¼Œè·³é                         â”‚ â”‚
â”‚  â”‚      }                                                    â”‚ â”‚
â”‚  â”‚      await processEvent(event);                           â”‚ â”‚
â”‚  â”‚      await markAsProcessed(event.id);                     â”‚ â”‚
â”‚  â”‚  }                                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  4. éŒ¯èª¤è™•ç†èˆ‡é‡è©¦                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ç™¼é€æ–¹ï¼š                                                  â”‚ â”‚
â”‚  â”‚  â€¢ å¯¦ä½œæŒ‡æ•¸é€€é¿é‡è©¦ï¼ˆ1s, 2s, 4s, 8s...ï¼‰                  â”‚ â”‚
â”‚  â”‚  â€¢ è¨­å®šæœ€å¤§é‡è©¦æ¬¡æ•¸                                        â”‚ â”‚
â”‚  â”‚  â€¢ æä¾›é‡è©¦ä½‡åˆ—                                            â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  æ¥æ”¶æ–¹ï¼š                                                  â”‚ â”‚
â”‚  â”‚  â€¢ è¨˜éŒ„å¤±æ•—çš„äº‹ä»¶                                          â”‚ â”‚
â”‚  â”‚  â€¢ æä¾›æ‰‹å‹•é‡è©¦æ©Ÿåˆ¶                                        â”‚ â”‚
â”‚  â”‚  â€¢ ç›£æ§å¤±æ•—ç‡                                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6.4 ç„¡ä¼ºæœå™¨é‹ç®—

### 6.4.1 ä»€éº¼æ˜¯ç„¡ä¼ºæœå™¨ï¼ˆServerlessï¼‰ï¼Ÿ

**ç„¡ä¼ºæœå™¨é‹ç®—**ä¸¦ä¸æ˜¯ã€Œæ²’æœ‰ä¼ºæœå™¨ã€ï¼Œè€Œæ˜¯ä½ ä¸éœ€è¦ç®¡ç†ä¼ºæœå™¨ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç„¡ä¼ºæœå™¨ vs. å‚³çµ±é‹ç®—                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  å‚³çµ±é‹ç®—ï¼ˆIaaSï¼‰                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  ä½ éœ€è¦ç®¡ç†ï¼š                                              â”‚ â”‚
â”‚  â”‚  âœ“ ä½œæ¥­ç³»çµ±æ›´æ–°                                            â”‚ â”‚
â”‚  â”‚  âœ“ å®‰å…¨ä¿®è£œç¨‹å¼                                            â”‚ â”‚
â”‚  â”‚  âœ“ å®¹é‡è¦åŠƒ                                                â”‚ â”‚
â”‚  â”‚  âœ“ æ“´å±•é…ç½®                                                â”‚ â”‚
â”‚  â”‚  âœ“ 24/7 é‹è¡Œ                                               â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  è¨ˆè²»ï¼šæŒ‰ä¼ºæœå™¨é‹è¡Œæ™‚é–“ï¼ˆå³ä½¿é–’ç½®ä¹Ÿè¦ä»˜è²»ï¼‰                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  ç„¡ä¼ºæœå™¨ï¼ˆServerlessï¼‰                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  ä½ åªéœ€è¦ç®¡ç†ï¼š                                            â”‚ â”‚
â”‚  â”‚  âœ“ ä½ çš„ç¨‹å¼ç¢¼                                              â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  é›²ç«¯ä¾›æ‡‰å•†ç®¡ç†ï¼š                                          â”‚ â”‚
â”‚  â”‚  âœ— ä½œæ¥­ç³»çµ±                                                â”‚ â”‚
â”‚  â”‚  âœ— æ“´å±•                                                    â”‚ â”‚
â”‚  â”‚  âœ— é«˜å¯ç”¨                                                  â”‚ â”‚
â”‚  â”‚  âœ— ä¿®è£œç¨‹å¼                                                â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  è¨ˆè²»ï¼šæŒ‰å¯¦éš›åŸ·è¡Œæ™‚é–“ï¼ˆæ¯«ç§’ç´šè¨ˆè²»ï¼Œé–’ç½®ä¸æ”¶è²»ï¼‰             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   æˆæœ¬æ¯”è¼ƒç¯„ä¾‹                           â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  å ´æ™¯ï¼šæ¯å¤©è™•ç† 10,000 å€‹è«‹æ±‚ï¼Œæ¯å€‹è«‹æ±‚ 200ms            â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  å‚³çµ± VMï¼ˆ24/7 é‹è¡Œï¼‰ï¼š                                  â”‚   â”‚
â”‚  â”‚  â€¢ B2s VMï¼šç´„ $30/æœˆ                                    â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  Azure Functionsï¼ˆæŒ‰åŸ·è¡Œè¨ˆè²»ï¼‰ï¼š                         â”‚   â”‚
â”‚  â”‚  â€¢ åŸ·è¡Œæ™‚é–“ï¼š10,000 Ã— 200ms Ã— 30 å¤© = 16.7 å°æ™‚          â”‚   â”‚
â”‚  â”‚  â€¢ è²»ç”¨ï¼šç´„ $0.50/æœˆ                                    â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  ç¯€çœï¼š98%                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.4.2 Azure Functionsï¼šäº‹ä»¶é©…å‹•çš„ç„¡ä¼ºæœå™¨å¹³å°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Azure Functions è§¸ç™¼å™¨                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  HTTP Trigger                                           â”‚   â”‚
â”‚  â”‚  ç•¶æ”¶åˆ° HTTP è«‹æ±‚æ™‚è§¸ç™¼                                  â”‚   â”‚
â”‚  â”‚  ç”¨é€”ï¼šREST APIã€Webhook æ¥æ”¶                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Timer Trigger                                          â”‚   â”‚
â”‚  â”‚  æŒ‰ç…§æ’ç¨‹è§¸ç™¼ï¼ˆé¡ä¼¼ Cronï¼‰                               â”‚   â”‚
â”‚  â”‚  ç”¨é€”ï¼šå®šæ™‚ä»»å‹™ã€å ±è¡¨ç”Ÿæˆ                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Blob Trigger                                           â”‚   â”‚
â”‚  â”‚  ç•¶ Blob å„²å­˜é«”æœ‰æ–°æª”æ¡ˆæ™‚è§¸ç™¼                            â”‚   â”‚
â”‚  â”‚  ç”¨é€”ï¼šåœ–ç‰‡è™•ç†ã€æª”æ¡ˆè½‰æ›                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Queue Trigger                                          â”‚   â”‚
â”‚  â”‚  ç•¶ä½‡åˆ—æœ‰æ–°è¨Šæ¯æ™‚è§¸ç™¼                                    â”‚   â”‚
â”‚  â”‚  ç”¨é€”ï¼šéåŒæ­¥ä»»å‹™è™•ç†                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Event Grid Trigger                                     â”‚   â”‚
â”‚  â”‚  ç•¶ Event Grid æ”¶åˆ°äº‹ä»¶æ™‚è§¸ç™¼                            â”‚   â”‚
â”‚  â”‚  ç”¨é€”ï¼šäº‹ä»¶é©…å‹•å·¥ä½œæµ                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Cosmos DB Trigger                                      â”‚   â”‚
â”‚  â”‚  ç•¶ Cosmos DB æœ‰è³‡æ–™è®Šæ›´æ™‚è§¸ç™¼                           â”‚   â”‚
â”‚  â”‚  ç”¨é€”ï¼šè³‡æ–™åŒæ­¥ã€è®Šæ›´è¿½è¹¤                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚                                       â”‚
â”‚                         â–¼                                       â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚              â”‚   Azure Function    â”‚                           â”‚
â”‚              â”‚    ï¼ˆä½ çš„ç¨‹å¼ç¢¼ï¼‰    â”‚                           â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.4.3 å¯¦ä½œ Azure Functionï¼šåº«å­˜è­¦å ±

```javascript
// functions/inventory-alert/index.js
// åº«å­˜ä½æ–¼é–¾å€¼æ™‚è‡ªå‹•é€šçŸ¥æ¡è³¼åœ˜éšŠ

const { app } = require('@azure/functions');
const { ServiceBusClient } = require('@azure/service-bus');

app.eventGrid('inventoryAlert', {
    handler: async (event, context) => {
        context.log('Received inventory event:', event.type);

        // åªè™•ç†åº«å­˜ä½è­¦å ±
        if (event.type !== 'inventory.stock.low') {
            return;
        }

        const data = event.data;
        context.log(`Low stock alert for ${data.productName}`);

        // 1. ç™¼é€ Slack é€šçŸ¥
        await sendSlackNotification({
            channel: '#procurement',
            text: `âš ï¸ *ä½åº«å­˜è­¦å‘Š*\n` +
                  `å•†å“ï¼š${data.productName}\n` +
                  `ç›®å‰åº«å­˜ï¼š${data.currentStock}\n` +
                  `å®‰å…¨åº«å­˜ï¼š${data.threshold}\n` +
                  `å€‰åº«ï¼š${data.warehouseId}`
        });

        // 2. å¦‚æœåº«å­˜æ¥µä½ï¼Œç™¼é€ç·Šæ€¥ SMS
        if (data.currentStock <= 2) {
            await sendSMS({
                to: process.env.EMERGENCY_CONTACT,
                message: `ç·Šæ€¥ï¼š${data.productName} åº«å­˜åƒ…å‰© ${data.currentStock}ï¼`
            });
        }

        // 3. è‡ªå‹•å»ºç«‹æ¡è³¼å»ºè­°å–®
        const suggestion = await createPurchaseSuggestion({
            productId: data.productId,
            suggestedQuantity: calculateReorderQuantity(data),
            priority: data.currentStock <= 2 ? 'urgent' : 'normal',
            createdBy: 'auto-system'
        });

        context.log(`Created purchase suggestion: ${suggestion.id}`);

        return { status: 'processed', suggestionId: suggestion.id };
    }
});

// è¨ˆç®—å»ºè­°æ¡è³¼é‡
function calculateReorderQuantity(data) {
    // åŸºæ–¼æ­·å²éŠ·å”®æ•¸æ“šè¨ˆç®—
    const dailyAvgSales = data.dailyAverageSales || 10;
    const leadTimeDays = data.supplierLeadTime || 7;
    const safetyStock = data.threshold;

    return (dailyAvgSales * leadTimeDays) + safetyStock;
}

// ç™¼é€ Slack é€šçŸ¥
async function sendSlackNotification({ channel, text }) {
    const response = await fetch(process.env.SLACK_WEBHOOK_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ channel, text })
    });

    if (!response.ok) {
        throw new Error(`Slack notification failed: ${response.statusText}`);
    }
}
```

```javascript
// functions/order-processor/index.js
// è™•ç†è¨‚å–®ä½‡åˆ—

const { app } = require('@azure/functions');

app.serviceBusQueue('orderProcessor', {
    connection: 'ServiceBusConnection',
    queueName: 'order-processing',
    handler: async (message, context) => {
        context.log('Processing order:', message.orderId);

        try {
            // 1. é©—è­‰è¨‚å–®
            await validateOrder(message);

            // 2. æ‰£æ¸›åº«å­˜
            await deductInventory(message.items);

            // 3. å»ºç«‹å‡ºè²¨å–®
            const shipment = await createShipment(message);

            // 4. ç™¼é€ç¢ºèªéƒµä»¶
            await sendConfirmationEmail(message.customerId, {
                orderId: message.orderId,
                shipmentId: shipment.id,
                estimatedDelivery: shipment.estimatedDelivery
            });

            context.log(`Order ${message.orderId} processed successfully`);

        } catch (error) {
            context.log.error(`Failed to process order ${message.orderId}:`, error);

            // é‡æ–°æ”¾å…¥ä½‡åˆ—é‡è©¦ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
            if (message.retryCount < 3) {
                await requeueOrder({
                    ...message,
                    retryCount: (message.retryCount || 0) + 1,
                    lastError: error.message
                });
            } else {
                // è¶…éé‡è©¦æ¬¡æ•¸ï¼Œæ”¾å…¥æ­»ä¿¡ä½‡åˆ—
                await moveToDeadLetter(message, error);
                await alertOperations(message, error);
            }
        }
    }
});
```

### 6.4.4 Timer Triggerï¼šå®šæ™‚ä»»å‹™

```javascript
// functions/daily-report/index.js
// æ¯å¤©æ—©ä¸Š 9 é»ç”ŸæˆéŠ·å”®å ±è¡¨

const { app } = require('@azure/functions');

app.timer('dailyReport', {
    // Cron è¡¨é”å¼ï¼šæ¯å¤©æ—©ä¸Š 9:00 (UTC+8 = 01:00 UTC)
    schedule: '0 0 1 * * *',
    handler: async (timer, context) => {
        context.log('Daily report generation started');

        const yesterday = getYesterdayDate();

        // 1. æ”¶é›†éŠ·å”®æ•¸æ“š
        const salesData = await getSalesData(yesterday);

        // 2. è¨ˆç®—çµ±è¨ˆæ•¸æ“š
        const report = {
            date: yesterday,
            totalOrders: salesData.length,
            totalRevenue: salesData.reduce((sum, o) => sum + o.amount, 0),
            topProducts: getTopProducts(salesData, 10),
            hourlyDistribution: getHourlyDistribution(salesData),
            regionBreakdown: getRegionBreakdown(salesData)
        };

        // 3. ç”Ÿæˆå ±è¡¨æª”æ¡ˆ
        const reportFile = await generateReportPDF(report);

        // 4. ä¸Šå‚³åˆ° Blob Storage
        await uploadToBlob(`reports/${yesterday}/daily-sales.pdf`, reportFile);

        // 5. ç™¼é€éƒµä»¶çµ¦ç®¡ç†å±¤
        await sendReportEmail({
            to: ['ceo@cloudmart.com', 'cfo@cloudmart.com'],
            subject: `CloudMart æ¯æ—¥éŠ·å”®å ±è¡¨ - ${yesterday}`,
            attachments: [reportFile],
            summary: `
                è¨‚å–®æ•¸ï¼š${report.totalOrders}
                ç‡Ÿæ”¶ï¼šNT$ ${report.totalRevenue.toLocaleString()}
                æœ€æš¢éŠ·å•†å“ï¼š${report.topProducts[0].name}
            `
        });

        context.log('Daily report sent successfully');
    }
});
```

---

## 6.5 Azure Event Grid

### 6.5.1 Event Grid æ¦‚è¿°

**Azure Event Grid** æ˜¯ä¸€å€‹å®Œå…¨è¨—ç®¡çš„äº‹ä»¶è·¯ç”±æœå‹™ï¼Œå°ˆé–€ç‚ºäº‹ä»¶é©…å‹•æ¶æ§‹è¨­è¨ˆã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Azure Event Grid æ¶æ§‹                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  äº‹ä»¶ä¾†æºï¼ˆEvent Sourcesï¼‰                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  Blob   â”‚ â”‚ Resourceâ”‚ â”‚  Event  â”‚ â”‚ Custom  â”‚               â”‚
â”‚  â”‚ Storage â”‚ â”‚  Group  â”‚ â”‚   Hub   â”‚ â”‚  Topic  â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜               â”‚
â”‚       â”‚           â”‚           â”‚           â”‚                     â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                       â”‚                                         â”‚
â”‚                       â–¼                                         â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚              â”‚   Azure Event Grid  â”‚                           â”‚
â”‚              â”‚                     â”‚                           â”‚
â”‚              â”‚  â€¢ äº‹ä»¶éæ¿¾         â”‚                           â”‚
â”‚              â”‚  â€¢ äº‹ä»¶è·¯ç”±         â”‚                           â”‚
â”‚              â”‚  â€¢ é‡è©¦æ©Ÿåˆ¶         â”‚                           â”‚
â”‚              â”‚  â€¢ æ­»ä¿¡è™•ç†         â”‚                           â”‚
â”‚              â”‚                     â”‚                           â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                         â”‚                                       â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚       â”‚                 â”‚                 â”‚                     â”‚
â”‚       â–¼                 â–¼                 â–¼                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ Azure   â”‚      â”‚ Azure   â”‚      â”‚ Webhook â”‚                 â”‚
â”‚  â”‚Functionsâ”‚      â”‚ Logic   â”‚      â”‚         â”‚                 â”‚
â”‚  â”‚         â”‚      â”‚  Apps   â”‚      â”‚         â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                 â”‚
â”‚  äº‹ä»¶è™•ç†å™¨ï¼ˆEvent Handlersï¼‰                                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.5.2 Event Grid è¨­å®šç¯„ä¾‹

```bash
# å»ºç«‹ Event Grid Topic
az eventgrid topic create \
    --name cloudmart-events \
    --resource-group CloudMart-Production \
    --location eastasia

# å»ºç«‹äº‹ä»¶è¨‚é–±ï¼ˆç™¼é€åˆ° Azure Functionï¼‰
az eventgrid event-subscription create \
    --name inventory-alerts-subscription \
    --source-resource-id /subscriptions/{sub-id}/resourceGroups/CloudMart-Production/providers/Microsoft.EventGrid/topics/cloudmart-events \
    --endpoint /subscriptions/{sub-id}/resourceGroups/CloudMart-Production/providers/Microsoft.Web/sites/cloudmart-functions/functions/inventoryAlert \
    --endpoint-type azurefunction \
    --event-delivery-schema eventgridschema \
    --subject-begins-with "/products/" \
    --included-event-types inventory.stock.low inventory.stock.out
```

```javascript
// ç™¼é€äº‹ä»¶åˆ° Event Grid
const { EventGridPublisherClient, AzureKeyCredential } = require("@azure/eventgrid");

async function publishInventoryEvent(product) {
    const client = new EventGridPublisherClient(
        process.env.EVENT_GRID_ENDPOINT,
        "EventGrid",
        new AzureKeyCredential(process.env.EVENT_GRID_KEY)
    );

    await client.send([
        {
            eventType: "inventory.stock.low",
            subject: `/products/${product.id}`,
            dataVersion: "1.0",
            data: {
                productId: product.id,
                productName: product.name,
                currentStock: product.stock,
                threshold: product.reorderThreshold,
                warehouseId: product.warehouseId
            }
        }
    ]);

    console.log(`Published low stock event for ${product.name}`);
}
```

---

## 6.6 CloudMart è‡ªå‹•åŒ–å·¥ä½œæµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CloudMart åº«å­˜è‡ªå‹•åŒ–æµç¨‹                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚  åº«å­˜ç³»çµ±   â”‚                                                â”‚
â”‚  â”‚ åµæ¸¬åˆ°åº«å­˜  â”‚                                                â”‚
â”‚  â”‚   ä½æ–¼é–¾å€¼  â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚ ç™¼å¸ƒäº‹ä»¶                                               â”‚
â”‚         â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚  Event Grid     â”‚                                            â”‚
â”‚  â”‚ inventory.stock â”‚                                            â”‚
â”‚  â”‚     .low        â”‚                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚           â”‚                                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚     â”‚                           â”‚                               â”‚
â”‚     â–¼                           â–¼                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚ â”‚ Azure Functionâ”‚        â”‚ Azure Functionâ”‚                     â”‚
â”‚ â”‚ ç™¼é€é€šçŸ¥      â”‚        â”‚ å»ºç«‹æ¡è³¼å–®    â”‚                     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚         â”‚                        â”‚                              â”‚
â”‚         â–¼                        â–¼                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚ â”‚ Slack é€šçŸ¥    â”‚        â”‚  æ¡è³¼ç³»çµ±     â”‚                     â”‚
â”‚ â”‚ æ¡è³¼åœ˜éšŠ      â”‚        â”‚ è‡ªå‹•ä¸‹å–®çµ¦    â”‚                     â”‚
â”‚ â”‚               â”‚        â”‚    ä¾›æ‡‰å•†     â”‚                     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                  â”‚                              â”‚
â”‚                                  â–¼                              â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                          â”‚  ä¾›æ‡‰å•†       â”‚                     â”‚
â”‚                          â”‚  Webhook å›èª¿ â”‚                     â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                  â”‚ å‡ºè²¨é€šçŸ¥                     â”‚
â”‚                                  â–¼                              â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                          â”‚ Azure Functionâ”‚                     â”‚
â”‚                          â”‚ æ›´æ–°åˆ°è²¨é æœŸ  â”‚                     â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                  â”‚                              â”‚
â”‚                                  â–¼                              â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                          â”‚  åº«å­˜ç³»çµ±     â”‚                     â”‚
â”‚                          â”‚ æ›´æ–°é æœŸåˆ°è²¨  â”‚                     â”‚
â”‚                          â”‚    æ—¥æœŸ       â”‚                     â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                 â”‚
â”‚  âœ“ å…¨è‡ªå‹•ï¼šå¾åµæ¸¬åˆ°è£œè²¨ï¼Œç„¡éœ€äººå·¥ä»‹å…¥                           â”‚
â”‚  âœ“ å³æ™‚ï¼šç§’ç´šåæ‡‰                                               â”‚
â”‚  âœ“ å¯è¿½è¹¤ï¼šæ¯å€‹æ­¥é©Ÿéƒ½æœ‰æ—¥èªŒ                                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6.7 ç« ç¯€ç¸½çµ

### æ ¸å¿ƒæ¦‚å¿µå›é¡§

| æ¦‚å¿µ | èªªæ˜ | Azure æœå‹™ |
|------|------|-----------|
| **äº‹ä»¶é©…å‹•æ¶æ§‹** | ç”±äº‹ä»¶è§¸ç™¼çš„ç³»çµ±è¨­è¨ˆ | Event Grid |
| **Webhook** | äº‹ä»¶ç™¼ç”Ÿæ™‚çš„ HTTP å›èª¿ | è‡ªè¨‚å¯¦ä½œ |
| **ç„¡ä¼ºæœå™¨** | æŒ‰åŸ·è¡Œè¨ˆè²»ï¼Œç„¡éœ€ç®¡ç†ä¼ºæœå™¨ | Azure Functions |
| **è§¸ç™¼å™¨** | å•Ÿå‹• Function çš„äº‹ä»¶é¡å‹ | HTTP, Timer, Queue ç­‰ |
| **äº‹ä»¶è·¯ç”±** | å°‡äº‹ä»¶åˆ†ç™¼åˆ°è™•ç†å™¨ | Event Grid |

### AZ-900 è€ƒè©¦é‡é»

1. **Azure Functions**ï¼šçŸ¥é“è§¸ç™¼å™¨é¡å‹å’Œè¨ˆè²»æ¨¡å¼
2. **Event Grid vs. Service Bus**ï¼šEvent Grid ç”¨æ–¼äº‹ä»¶é€šçŸ¥ï¼ŒService Bus ç”¨æ–¼è¨Šæ¯ä½‡åˆ—
3. **ç„¡ä¼ºæœå™¨å„ªå‹¢**ï¼šè‡ªå‹•æ“´å±•ã€æŒ‰åŸ·è¡Œè¨ˆè²»ã€ç„¡éœ€ç®¡ç†åŸºç¤è¨­æ–½
4. **Logic Apps**ï¼šä½ç¨‹å¼ç¢¼çš„å·¥ä½œæµè‡ªå‹•åŒ–

### å­¸ç¿’æª¢æŸ¥æ¸…å–®

- [ ] è§£é‡‹äº‹ä»¶é©…å‹•æ¶æ§‹çš„å„ªå‹¢
- [ ] è¨­è¨ˆ Webhook æ¥æ”¶å’Œè™•ç†æ©Ÿåˆ¶
- [ ] ä½¿ç”¨ Azure Functions å»ºç«‹äº‹ä»¶è™•ç†å™¨
- [ ] é…ç½® Event Grid äº‹ä»¶è·¯ç”±
- [ ] å»ºç«‹å®šæ™‚è§¸ç™¼çš„è‡ªå‹•åŒ–ä»»å‹™

---

**ä¸Šä¸€ç« ï¼š[ç¬¬ 5 ç« ï¼šæµé‡ç®¡ç†èˆ‡éåŒæ­¥æºé€š](./chapter-05.md)**

**ä¸‹ä¸€ç« ï¼š[ç¬¬ 7 ç« ï¼šæ‰“é€ è»Ÿé«”å·¥å» ](./chapter-07.md)**
