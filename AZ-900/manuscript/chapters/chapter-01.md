# 第 1 章：雲端運算的演進 (The Cloud Evolution)

> 「如果我們當初把錢花在硬體上，CloudMart 早就倒閉了。」
> —— 林志明，CloudMart 創辦人

---

## 本章學習目標

完成本章後，你將能夠：

- 解釋虛擬化技術如何改變運算資源的使用方式
- 區分實體伺服器、虛擬機與容器的差異
- 理解 IaaS、PaaS、SaaS 三種雲端服務模型
- 為不同的業務需求選擇適當的雲端服務模型
- 評估地端部署與雲端部署的優劣

---

## 1.1 創業第一天：一台伺服器的故事

2019 年的某個深夜，林志明坐在他的車庫裡，盯著眼前那台二手伺服器發呆。這台從網拍買來的 Dell PowerEdge R720，花了他創業基金的三分之一。

「這就是 CloudMart 的起點了。」他自言自語。

讓我們回到那個時刻，看看一個電商網站的誕生過程，以及為什麼「買一台伺服器」這個看似簡單的決定，會在未來帶來巨大的挑戰。

### 1.1.1 實體伺服器時代：一切的起點

林志明的第一個架構非常簡單：

```
┌─────────────────────────────────────────────────────┐
│                    車庫機房                          │
│  ┌───────────────────────────────────────────────┐  │
│  │           Dell PowerEdge R720                 │  │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────────────┐  │  │
│  │  │  Nginx  │ │ Node.js │ │    PostgreSQL   │  │  │
│  │  │ Web伺服器│ │ 應用程式 │ │     資料庫      │  │  │
│  │  └─────────┘ └─────────┘ └─────────────────┘  │  │
│  └───────────────────────────────────────────────┘  │
│                        │                            │
│                    家用寬頻                          │
└────────────────────────│────────────────────────────┘
                         │
                    ┌────▼────┐
                    │ 網際網路 │
                    └─────────┘
```

**這個架構的組成：**

| 元件 | 說明 | 成本 |
|------|------|------|
| 實體伺服器 | Dell PowerEdge R720（二手） | NT$ 35,000 |
| 作業系統 | Ubuntu Server 18.04 | 免費 |
| 網頁伺服器 | Nginx | 免費 |
| 應用程式 | Node.js + Express | 免費 |
| 資料庫 | PostgreSQL | 免費 |
| 網路 | 家用光纖 100M/40M | NT$ 899/月 |

**總初始成本：NT$ 35,899**

看起來很划算，對吧？但問題很快就出現了。

### 1.1.2 第一次危機：硬碟故障

創業第三個月的某個週日早上，林志明被手機警報吵醒。網站掛了。

他衝到車庫，發現伺服器發出刺耳的警報聲——硬碟故障。

```
[    3.892041] sd 0:2:0:0: [sda] Add. Sense: Unrecovered read error
[    3.892044] sd 0:2:0:0: [sda] CDB: Read(10) 28 00 00 00 00 00 00 00 08 00
[    3.892047] blk_update_request: critical medium error, dev sda, sector 0
```

**損失清單：**
- 網站停機時間：14 小時
- 損失訂單：約 47 筆（週日是流量高峰）
- 預估損失營收：NT$ 82,000
- 緊急購買新硬碟：NT$ 4,500
- 更慘的是：最近 3 天的訂單資料，永久遺失

> **教訓 #1：單點故障（Single Point of Failure, SPOF）**
>
> 當系統中的某個元件故障會導致整個系統停擺時，該元件就是「單點故障」。在林志明的架構中，那台伺服器就是一個巨大的單點故障。

### 1.1.3 傳統解決方案：購買更多硬體

痛定思痛，林志明決定「認真」建置基礎設施：

```
┌─────────────────────────────────────────────────────────────┐
│                      升級後的車庫機房                         │
│                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │  伺服器 #1   │    │  伺服器 #2   │    │  NAS 儲存   │     │
│  │  (主要)     │◄──►│  (備援)     │◄──►│  (備份)     │     │
│  └─────────────┘    └─────────────┘    └─────────────┘     │
│         │                                    │              │
│         └──────────────┬─────────────────────┘              │
│                        │                                    │
│                 ┌──────▼──────┐                             │
│                 │   交換器    │                              │
│                 │  (Switch)   │                              │
│                 └──────┬──────┘                             │
│                        │                                    │
│                 ┌──────▼──────┐                             │
│                 │    路由器    │                             │
│                 │   + 防火牆  │                              │
│                 └──────┬──────┘                             │
│                        │                                    │
│              商用光纖 300M/100M                              │
└────────────────────────│────────────────────────────────────┘
                         ▼
                    ┌─────────┐
                    │ 網際網路 │
                    └─────────┘
```

**升級成本：**

| 項目 | 成本 |
|------|------|
| 第二台伺服器（備援） | NT$ 38,000 |
| NAS 儲存設備（4TB） | NT$ 25,000 |
| 企業級交換器 | NT$ 8,000 |
| 商用光纖升級 | NT$ 2,499/月 |
| UPS 不斷電系統 | NT$ 15,000 |
| **初始投資總計** | **NT$ 86,000** |
| **每月營運成本** | **NT$ 2,499** |

這還不包括林志明自己花在維護上的時間——平均每週 10 小時。

### 1.1.4 關鍵問題：資源利用率

讓我們看看這些硬體的實際使用情況：

```
┌────────────────────────────────────────────────────────────┐
│                  伺服器資源使用率（一週平均）                  │
├────────────────────────────────────────────────────────────┤
│                                                            │
│  CPU 使用率                                                 │
│  ████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  12%            │
│                                                            │
│  記憶體使用率                                                │
│  ████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  23%            │
│                                                            │
│  硬碟使用率                                                  │
│  ██████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  18%            │
│                                                            │
│  網路頻寬使用率                                              │
│  ███░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  8%             │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

**驚人的發現：**

- 一台價值 NT$ 38,000 的伺服器，平均只用了 12% 的運算能力
- 大部分時間，這些昂貴的硬體都在「發呆」
- 但你不能不買——因為在促銷活動時，CPU 使用率會飆升到 85%

這就引出了一個關鍵問題：

> **有沒有辦法，只在需要的時候使用運算資源，而不是永遠佔有它們？**

答案是：有的。這就是虛擬化技術和雲端運算的核心價值。

---

## 1.2 虛擬化：一台電腦變多台

### 1.2.1 什麼是虛擬化？

想像一下，你有一棟辦公大樓，但只有一家公司租用。這家公司只需要兩個樓層，但你卻必須維護整棟大樓的水電、保全、清潔。

**虛擬化就像把這棟大樓隔成多個獨立的辦公空間，每個空間可以出租給不同的公司。**

```
┌─────────────────────────────────────────────────────────────┐
│                        實體伺服器                            │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    Hypervisor                       │   │
│  │         （虛擬化管理層，如 VMware、Hyper-V）          │   │
│  │  ┌───────────┐ ┌───────────┐ ┌───────────┐         │   │
│  │  │   VM #1   │ │   VM #2   │ │   VM #3   │         │   │
│  │  │  ┌─────┐  │ │  ┌─────┐  │ │  ┌─────┐  │         │   │
│  │  │  │ App │  │ │  │ App │  │ │  │ App │  │         │   │
│  │  │  ├─────┤  │ │  ├─────┤  │ │  ├─────┤  │         │   │
│  │  │  │ OS  │  │ │  │ OS  │  │ │  │ OS  │  │         │   │
│  │  │  │Ubuntu│  │ │  │CentOS│ │ │  │Windows│ │         │   │
│  │  │  └─────┘  │ │  └─────┘  │ │  └─────┘  │         │   │
│  │  │  2 CPU    │ │  4 CPU    │ │  2 CPU    │         │   │
│  │  │  4GB RAM  │ │  8GB RAM  │ │  4GB RAM  │         │   │
│  │  │  50GB SSD │ │  100GB SSD│ │  50GB SSD │         │   │
│  │  └───────────┘ └───────────┘ └───────────┘         │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                            │
│  實體硬體：16 CPU、32GB RAM、500GB SSD                       │
└────────────────────────────────────────────────────────────┘
```

### 1.2.2 Hypervisor：虛擬化的核心

**Hypervisor**（虛擬機監視器）是虛擬化技術的核心軟體，負責：

1. **資源分配**：將實體硬體的 CPU、記憶體、儲存空間分配給虛擬機
2. **隔離保護**：確保不同虛擬機之間互不干擾
3. **硬體模擬**：讓每台虛擬機都「以為」自己獨佔整台實體機器

**兩種類型的 Hypervisor：**

```
Type 1（裸機型）                    Type 2（託管型）
直接運行在硬體上                    運行在作業系統之上

┌───────────────────┐              ┌───────────────────┐
│    VM    VM    VM │              │    VM    VM    VM │
├───────────────────┤              ├───────────────────┤
│    Hypervisor     │              │    Hypervisor     │
├───────────────────┤              ├───────────────────┤
│      硬體         │              │   Host OS         │
└───────────────────┘              ├───────────────────┤
                                   │      硬體         │
                                   └───────────────────┘

範例：                              範例：
- VMware ESXi                      - VMware Workstation
- Microsoft Hyper-V                - Oracle VirtualBox
- Citrix XenServer                 - Parallels Desktop
```

**AZ-900 考試重點：**

> Azure 使用的是 **Type 1 Hypervisor**，這是一個高度客製化的版本，基於 Microsoft Hyper-V 技術開發。Type 1 的優勢在於效能更好（少了一層 Host OS）且安全性更高。

### 1.2.3 虛擬機 vs. 實體機：優劣比較

| 面向 | 實體伺服器 | 虛擬機 |
|------|-----------|--------|
| **初始成本** | 高（需購買硬體） | 低（共享硬體） |
| **部署時間** | 數天至數週 | 數分鐘 |
| **資源彈性** | 固定配置 | 可動態調整 |
| **隔離性** | 完全隔離 | 邏輯隔離 |
| **效能** | 100%（無虛擬化損耗） | 95-98%（輕微損耗） |
| **遷移難度** | 極高 | 低（可線上遷移） |
| **災難復原** | 複雜 | 簡單（快照備份） |

### 1.2.4 CloudMart 的虛擬化之路

林志明開始研究虛擬化技術。他在那台備援伺服器上安裝了 VMware ESXi：

```
┌─────────────────────────────────────────────────────────────┐
│                    重新規劃後的架構                          │
│                                                             │
│  主要伺服器                         備援伺服器               │
│  ┌─────────────────────┐           ┌─────────────────────┐ │
│  │      ESXi           │           │      ESXi           │ │
│  │  ┌──────┐ ┌──────┐  │           │  ┌──────┐ ┌──────┐  │ │
│  │  │ Web  │ │ App  │  │    HA     │  │ Web  │ │ App  │  │ │
│  │  │ VM   │ │ VM   │  │◄─────────►│  │ VM   │ │ VM   │  │ │
│  │  └──────┘ └──────┘  │  複寫同步  │  │(備援)│ │(備援)│  │ │
│  │  ┌──────┐           │           │  └──────┘ └──────┘  │ │
│  │  │ DB   │           │           │  ┌──────┐           │ │
│  │  │ VM   │           │           │  │ DB   │           │ │
│  │  └──────┘           │           │  │(備援)│           │ │
│  └─────────────────────┘           │  └──────┘           │ │
│                                    └─────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

**虛擬化帶來的好處：**

1. **更好的資源利用**：同一台實體機可以運行多個 VM
2. **更容易備份**：整台 VM 可以做成快照（Snapshot）
3. **更快的災難復原**：備援 VM 可以在幾分鐘內接手
4. **更靈活的擴展**：需要更多資源時，可以快速建立新 VM

但這還不夠。林志明很快發現，他仍然需要：

- 購買和維護實體硬體
- 處理硬體故障
- 支付固定的電費和網路費用
- 花大量時間在系統管理上

> **他需要的是——把這些麻煩事都交給別人處理。**

---

## 1.3 雲端運算：租用別人的電腦

### 1.3.1 什麼是雲端運算？

**雲端運算的本質很簡單：不要自己買電腦，租別人的。**

```
傳統模式（地端部署）              雲端模式

你買硬體 ──► 你維護 ──► 你負責      雲端供應商 ──► 維護 ──► 你只管用
     │           │                      │
     ▼           ▼                      ▼
  高初始成本    高營運成本              按使用量付費
  長採購週期    需要專業人員            隨開隨用
  固定產能      責任都在你身上          彈性擴展
```

**雲端運算的五大特性（NIST 定義）：**

| 特性 | 說明 | CloudMart 情境 |
|------|------|---------------|
| **隨選自助服務** | 不需要聯繫供應商，自己就能開通 | 半夜三點，林志明可以自己開一台新伺服器 |
| **廣泛的網路存取** | 透過網路即可使用 | 在家、在公司、在咖啡廳都能管理系統 |
| **資源池化** | 多租戶共享資源 | 你的 VM 和其他公司的 VM 可能在同一台實體機上 |
| **快速彈性** | 可以快速擴展或縮減 | 促銷活動開始前 10 分鐘，增加 5 台伺服器 |
| **可計量的服務** | 使用多少付多少 | 這個月用了 100 小時的運算時間，就付 100 小時的錢 |

### 1.3.2 主要的雲端服務供應商

截至 2024 年，全球三大公有雲供應商：

```
┌─────────────────────────────────────────────────────────────┐
│                    全球公有雲市場份額                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Amazon AWS        ████████████████████████████████  32%   │
│                                                             │
│  Microsoft Azure   ████████████████████████  23%           │
│                                                             │
│  Google Cloud      ███████████  10%                        │
│                                                             │
│  其他              ███████████████████████████████████ 35% │
│  (Alibaba, IBM,                                            │
│   Oracle, etc.)                                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**為什麼 CloudMart 選擇 Azure？**

林志明的考量：

1. **整合性**：CloudMart 已經在用 Office 365 處理郵件和文件
2. **混合雲支援**：未來可能需要連接地端系統
3. **企業支援**：微軟在台灣有完整的技術支援團隊
4. **認證路徑**：AZ-900 → AZ-104 → AZ-305 的學習路徑清晰

### 1.3.3 雲端部署模型

根據資源的擁有權和存取範圍，雲端分為三種部署模型：

```
┌───────────────────────────────────────────────────────────────┐
│                       雲端部署模型比較                         │
├───────────────────────────────────────────────────────────────┤
│                                                               │
│  公有雲 (Public Cloud)                                        │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │  雲端供應商擁有並管理所有基礎設施                          │ │
│  │  多個客戶共享相同的硬體資源（多租戶）                       │ │
│  │  透過網際網路存取                                         │ │
│  │  範例：Azure、AWS、GCP                                    │ │
│  └─────────────────────────────────────────────────────────┘ │
│                                                               │
│  私有雲 (Private Cloud)                                       │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │  組織自己擁有並管理基礎設施                               │ │
│  │  單一組織獨享所有資源                                     │ │
│  │  可能位於自有機房或託管機房                               │ │
│  │  範例：Azure Stack、VMware vSphere                       │ │
│  └─────────────────────────────────────────────────────────┘ │
│                                                               │
│  混合雲 (Hybrid Cloud)                                        │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │  結合公有雲和私有雲（或地端環境）                          │ │
│  │  工作負載可以在兩者之間移動                               │ │
│  │  保留敏感資料在私有環境，利用公有雲的彈性                   │ │
│  │  範例：Azure Arc、AWS Outposts                           │ │
│  └─────────────────────────────────────────────────────────┘ │
│                                                               │
└───────────────────────────────────────────────────────────────┘
```

**CloudMart 的選擇：混合雲**

林志明決定採用混合雲策略：

- **公有雲（Azure）**：網站前端、API 伺服器、CDN
- **地端環境**：財務系統、ERP 系統（因為法規要求資料不能出境）

```
┌────────────────────────────────────────────────────────────────┐
│                    CloudMart 混合雲架構                         │
│                                                                │
│   Azure 公有雲                           地端機房              │
│  ┌──────────────────────┐              ┌──────────────────┐   │
│  │  ┌────┐    ┌────┐   │   VPN 連線   │  ┌────────────┐  │   │
│  │  │Web │    │API │   │◄────────────►│  │  ERP 系統  │  │   │
│  │  │App │    │App │   │   加密通道   │  └────────────┘  │   │
│  │  └────┘    └────┘   │              │  ┌────────────┐  │   │
│  │  ┌────┐    ┌────┐   │              │  │  財務系統  │  │   │
│  │  │CDN │    │ DB │   │              │  └────────────┘  │   │
│  │  └────┘    │(副本)│  │              │                  │   │
│  │            └────┘   │              │                  │   │
│  └──────────────────────┘              └──────────────────┘   │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

---

## 1.4 雲端服務模型：IaaS、PaaS、SaaS

### 1.4.1 責任分攤模型

雲端運算最重要的概念之一，就是**責任分攤（Shared Responsibility）**。

不同的服務模型，你和雲端供應商各自負責不同的層面：

```
┌────────────────────────────────────────────────────────────────┐
│                      責任分攤模型                               │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│              地端部署    IaaS      PaaS      SaaS              │
│              On-Prem                                           │
│  ┌────────┐  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐          │
│  │ 資料   │  │ 你的 │  │ 你的 │  │ 你的 │  │ 你的 │          │
│  ├────────┤  ├──────┤  ├──────┤  ├──────┤  ├──────┤          │
│  │ 應用程式│  │ 你的 │  │ 你的 │  │ 你的 │  │供應商│          │
│  ├────────┤  ├──────┤  ├──────┤  ├──────┤  ├──────┤          │
│  │ 執行環境│  │ 你的 │  │ 你的 │  │供應商│  │供應商│          │
│  ├────────┤  ├──────┤  ├──────┤  ├──────┤  ├──────┤          │
│  │ 中介軟體│  │ 你的 │  │ 你的 │  │供應商│  │供應商│          │
│  ├────────┤  ├──────┤  ├──────┤  ├──────┤  ├──────┤          │
│  │ 作業系統│  │ 你的 │  │ 你的 │  │供應商│  │供應商│          │
│  ├────────┤  ├──────┤  ├──────┤  ├──────┤  ├──────┤          │
│  │ 虛擬化 │  │ 你的 │  │供應商│  │供應商│  │供應商│          │
│  ├────────┤  ├──────┤  ├──────┤  ├──────┤  ├──────┤          │
│  │ 伺服器 │  │ 你的 │  │供應商│  │供應商│  │供應商│          │
│  ├────────┤  ├──────┤  ├──────┤  ├──────┤  ├──────┤          │
│  │ 儲存   │  │ 你的 │  │供應商│  │供應商│  │供應商│          │
│  ├────────┤  ├──────┤  ├──────┤  ├──────┤  ├──────┤          │
│  │ 網路   │  │ 你的 │  │供應商│  │供應商│  │供應商│          │
│  ├────────┤  ├──────┤  ├──────┤  ├──────┤  ├──────┤          │
│  │ 機房   │  │ 你的 │  │供應商│  │供應商│  │供應商│          │
│  └────────┘  └──────┘  └──────┘  └──────┘  └──────┘          │
│                                                                │
│  ████ 你負責     ████ 雲端供應商負責                           │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

### 1.4.2 IaaS：基礎設施即服務

**Infrastructure as a Service（IaaS）** 提供最基本的雲端資源：虛擬機、儲存空間、網路。

**你得到什麼：**
- 虛擬機（可以選擇 CPU、記憶體、作業系統）
- 虛擬網路
- 儲存空間（磁碟、物件儲存）

**你負責什麼：**
- 安裝和設定作業系統
- 安裝應用程式和中介軟體
- 安全更新和修補程式
- 應用程式的部署和維護

**Azure IaaS 服務範例：**

| 服務 | 說明 |
|------|------|
| Azure Virtual Machines | 虛擬機器 |
| Azure Virtual Network | 虛擬網路 |
| Azure Disk Storage | 磁碟儲存 |
| Azure Blob Storage | 物件儲存 |

**CloudMart 的 IaaS 使用案例：**

```python
# 使用 Azure CLI 建立虛擬機
# 這就是 IaaS 的典型用法

az vm create \
    --resource-group CloudMart-Production \
    --name cloudmart-web-01 \
    --image Ubuntu2204 \
    --size Standard_B2s \
    --admin-username cloudadmin \
    --generate-ssh-keys \
    --public-ip-sku Standard
```

林志明用 IaaS 來運行：
- 需要特殊設定的舊版應用程式
- 開發和測試環境
- 需要完全控制的資料庫伺服器

### 1.4.3 PaaS：平台即服務

**Platform as a Service（PaaS）** 在 IaaS 之上，額外提供了執行環境。

**你得到什麼：**
- 預先設定好的執行環境（Node.js、Python、.NET 等）
- 自動化的擴展機制
- 內建的監控和日誌
- 資料庫服務

**你負責什麼：**
- 撰寫和部署應用程式程式碼
- 應用程式的設定
- 資料管理

**你不用管：**
- 作業系統更新
- 執行環境的維護
- 伺服器的擴展

**Azure PaaS 服務範例：**

| 服務 | 說明 |
|------|------|
| Azure App Service | Web 應用程式託管 |
| Azure SQL Database | 託管式 SQL 資料庫 |
| Azure Functions | 無伺服器運算 |
| Azure Cosmos DB | 全球分散式資料庫 |

**CloudMart 的 PaaS 使用案例：**

```yaml
# azure-pipelines.yml
# 部署到 Azure App Service（PaaS）
# 注意：我們只需要管程式碼，其他都不用管

trigger:
  - main

pool:
  vmImage: 'ubuntu-latest'

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '18.x'

  - script: |
      npm install
      npm run build
    displayName: 'Build application'

  - task: AzureWebApp@1
    inputs:
      azureSubscription: 'CloudMart-Production'
      appName: 'cloudmart-api'
      package: '$(System.DefaultWorkingDirectory)/dist'
```

林志明用 PaaS 來運行：
- 主要的 API 服務（Azure App Service）
- 訂單資料庫（Azure SQL Database）
- 即時通知功能（Azure Functions）

### 1.4.4 SaaS：軟體即服務

**Software as a Service（SaaS）** 是最高層次的雲端服務——你直接使用完整的應用程式。

**你得到什麼：**
- 完整、可立即使用的應用程式
- 定期的功能更新
- 技術支援

**你負責什麼：**
- 設定應用程式（使用者帳號、權限等）
- 你的資料

**你不用管：**
- 任何技術層面的維護

**常見的 SaaS 範例：**

| 服務 | 說明 |
|------|------|
| Microsoft 365 | 辦公室生產力套件 |
| Salesforce | 客戶關係管理（CRM） |
| Slack | 團隊協作 |
| Zoom | 視訊會議 |

**CloudMart 的 SaaS 使用案例：**

林志明用 SaaS 來處理：
- 公司郵件（Microsoft 365）
- 客服系統（Zendesk）
- 行銷自動化（Mailchimp）
- 人事管理（BambooHR）

### 1.4.5 服務模型選擇指南

**如何選擇適當的服務模型？**

```
┌────────────────────────────────────────────────────────────────┐
│                     服務模型決策樹                              │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  需求是什麼？                                                   │
│       │                                                        │
│       ▼                                                        │
│  ┌─────────────────────────────────────────┐                  │
│  │ 需要完整的應用程式嗎？                   │                  │
│  │ （例如：郵件、CRM、視訊會議）            │                  │
│  └─────────────────┬───────────────────────┘                  │
│           是 ─────►│◄───── 否                                  │
│           │        │        │                                  │
│           ▼        │        ▼                                  │
│       使用 SaaS    │  ┌─────────────────────────────┐         │
│                    │  │ 只需要運行自己的程式碼嗎？   │         │
│                    │  │ （不需要管理 OS 和執行環境） │         │
│                    │  └─────────────┬───────────────┘         │
│                    │       是 ─────►│◄───── 否                │
│                    │       │        │        │                │
│                    │       ▼        │        ▼                │
│                    │   使用 PaaS    │  ┌───────────────────┐  │
│                    │                │  │ 需要完全控制嗎？   │  │
│                    │                │  │ （OS、網路、安全） │  │
│                    │                │  └─────────┬─────────┘  │
│                    │                │    是 ────►│            │
│                    │                │    │       │            │
│                    │                │    ▼       │            │
│                    │                │ 使用 IaaS  │            │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

**CloudMart 的完整雲端服務組合：**

| 服務類型 | 使用的服務 | 用途 |
|----------|-----------|------|
| **SaaS** | Microsoft 365 | 公司郵件、文件協作 |
| **SaaS** | Zendesk | 客戶服務 |
| **PaaS** | Azure App Service | 主要 Web 應用程式 |
| **PaaS** | Azure SQL Database | 訂單資料庫 |
| **PaaS** | Azure Functions | 即時庫存更新 |
| **IaaS** | Azure Virtual Machines | 舊版 ERP 系統遷移 |
| **IaaS** | Azure Virtual Network | 混合雲連線 |

---

## 1.5 雲端運算的經濟效益

### 1.5.1 資本支出 vs. 營運支出

**CapEx（資本支出，Capital Expenditure）：**
- 購買實體資產的一次性支出
- 例如：伺服器、網路設備、機房
- 會計上需要分期攤銷（折舊）

**OpEx（營運支出，Operating Expenditure）：**
- 日常營運的持續性支出
- 例如：雲端服務月費、電費、人力成本
- 會計上可以當期認列為費用

```
┌────────────────────────────────────────────────────────────────┐
│                    CapEx vs. OpEx 現金流比較                    │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  CapEx 模式（購買伺服器）                                       │
│                                                                │
│  支出 ▲                                                        │
│       │                                                        │
│  100萬│  ████                                                  │
│       │  ████                                                  │
│   50萬│  ████   ██    ██    ██    ██                          │
│       │  ████   ██    ██    ██    ██                          │
│       └──────────────────────────────────────► 時間            │
│          第1年  第2年  第3年  第4年  第5年                       │
│                                                                │
│  OpEx 模式（租用雲端）                                          │
│                                                                │
│  支出 ▲                                                        │
│       │                                                        │
│  100萬│                                                        │
│       │                                                        │
│   50萬│                                                        │
│   20萬│  ██    ██    ██    ██    ██                            │
│       │  ██    ██    ██    ██    ██                            │
│       └──────────────────────────────────────► 時間            │
│          第1年  第2年  第3年  第4年  第5年                       │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

**雲端運算將 CapEx 轉換為 OpEx 的好處：**

1. **降低初始投資門檻**：不需要一開始就投入大量資金
2. **現金流更靈活**：按月付費，更容易管理現金流
3. **更容易預測成本**：固定的月費比不可預期的硬體故障好管理
4. **稅務優勢**：營運費用通常可以當期抵稅

### 1.5.2 CloudMart 成本比較

讓我們實際計算 CloudMart 在兩種模式下的五年總成本：

**情境：中型電商網站**
- 需要 4 台應用伺服器
- 1 台資料庫伺服器
- 網路和儲存設備

**方案一：自建機房（CapEx 為主）**

| 項目 | 第1年 | 第2-5年（每年） | 5年總計 |
|------|-------|----------------|---------|
| 伺服器（5台） | NT$ 500,000 | - | NT$ 500,000 |
| 網路設備 | NT$ 150,000 | - | NT$ 150,000 |
| 機房租金 | NT$ 120,000 | NT$ 120,000 | NT$ 600,000 |
| 電費 | NT$ 96,000 | NT$ 96,000 | NT$ 480,000 |
| 網路費用 | NT$ 60,000 | NT$ 60,000 | NT$ 300,000 |
| IT 人員薪資 | NT$ 840,000 | NT$ 840,000 | NT$ 4,200,000 |
| 軟體授權 | NT$ 200,000 | NT$ 100,000 | NT$ 600,000 |
| 硬體維護/更換 | - | NT$ 100,000 | NT$ 400,000 |
| **年度總計** | **NT$ 1,966,000** | **NT$ 1,316,000** | **NT$ 7,230,000** |

**方案二：Azure 雲端（OpEx 為主）**

| 項目 | 每月 | 每年 | 5年總計 |
|------|------|------|---------|
| 4x Standard_D4s_v3 (App) | NT$ 24,000 | NT$ 288,000 | NT$ 1,440,000 |
| 1x Standard_E8s_v3 (DB) | NT$ 16,000 | NT$ 192,000 | NT$ 960,000 |
| Azure SQL Database | NT$ 12,000 | NT$ 144,000 | NT$ 720,000 |
| 儲存和網路 | NT$ 5,000 | NT$ 60,000 | NT$ 300,000 |
| 備份和災難復原 | NT$ 3,000 | NT$ 36,000 | NT$ 180,000 |
| IT 人員薪資（減少 50%） | NT$ 35,000 | NT$ 420,000 | NT$ 2,100,000 |
| **年度總計** | **NT$ 95,000** | **NT$ 1,140,000** | **NT$ 5,700,000** |

**成本節省：NT$ 1,530,000（約 21%）**

但更重要的是：

- ✅ **風險降低**：不再需要擔心硬體故障
- ✅ **彈性提高**：可以隨時增減資源
- ✅ **專注核心**：IT 人員可以專注於業務開發而非基礎設施維護

### 1.5.3 彈性擴展的價值

雲端真正的價值不只是成本節省，而是**彈性**。

**傳統模式的困境：**

```
容量 ▲
     │
     │            ████████████████████████████  購買的容量
     │            ████████████████████████████
     │      ██████████████████████████████████
     │  ████████████████████████████████████
     │  ██                          ██
     │  ██   實際需求                ██
     │  ██   ~~~~~~~~~~             ██
     │  ~~~~~~~~~~~~~~~~~~
     └─────────────────────────────────────────► 時間
       平日     週末     促銷活動    平日

     閒置的容量 = 浪費的錢
     不足的容量 = 流失的營收
```

**雲端模式的優勢：**

```
容量 ▲
     │
     │                              ████████
     │                              ████████  自動擴展
     │      ████████████████████████████████
     │  ████████████████████████████████████
     │  ██                          ██
     │  ██   容量 = 需求            ██
     │  ██   ~~~~~~~~~~~~~~~~       ██
     │  ~~~~~~~~~~~~~~~~~~
     └─────────────────────────────────────────► 時間
       平日     週末     促銷活動    平日

     只付你用的 = 最佳化成本
     自動擴展 = 不會錯過商機
```

**真實案例：CloudMart 的黑色星期五**

2022 年黑色星期五，CloudMart 在雲端上的表現：

| 時間 | 流量倍數 | 伺服器數量 | 自動擴展動作 |
|------|----------|-----------|-------------|
| 00:00-06:00 | 1x | 4 台 | - |
| 06:00-10:00 | 3x | 8 台 | 自動增加 4 台 |
| 10:00-14:00 | 8x | 20 台 | 自動增加 12 台 |
| 14:00-22:00 | 12x | 32 台 | 自動增加 12 台 |
| 22:00-24:00 | 5x | 12 台 | 自動減少 20 台 |
| 隔天 | 2x | 6 台 | 自動減少 6 台 |

**如果用傳統模式：**
- 要準備 32 台伺服器的容量
- 其中 28 台在一年中的 99% 時間都閒置
- 或者選擇只準備 4 台，然後在促銷時網站當機

---

## 1.6 動手實作：在 Azure 建立你的第一台虛擬機

現在讓我們實際動手，體驗雲端運算的「隨選自助服務」特性。

### 1.6.1 前置準備

1. **Azure 帳號**：前往 [azure.microsoft.com](https://azure.microsoft.com) 註冊免費帳號
2. **免費額度**：新帳號可獲得 USD $200 的免費額度（30 天內使用）
3. **Azure CLI**：下載並安裝 Azure 命令列工具

```bash
# macOS
brew install azure-cli

# Windows (PowerShell，以系統管理員執行)
winget install -e --id Microsoft.AzureCLI

# Linux (Ubuntu/Debian)
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
```

### 1.6.2 建立資源群組

**資源群組（Resource Group）** 是 Azure 中用來組織資源的邏輯容器。

```bash
# 登入 Azure
az login

# 建立資源群組
az group create \
    --name CloudMart-Lab \
    --location eastasia

# 輸出結果
{
  "id": "/subscriptions/xxx/resourceGroups/CloudMart-Lab",
  "location": "eastasia",
  "name": "CloudMart-Lab",
  "properties": {
    "provisioningState": "Succeeded"
  },
  "type": "Microsoft.Resources/resourceGroups"
}
```

### 1.6.3 建立虛擬機

```bash
# 建立一台 Ubuntu 虛擬機
az vm create \
    --resource-group CloudMart-Lab \
    --name cloudmart-web-lab \
    --image Ubuntu2204 \
    --size Standard_B1s \
    --admin-username azureuser \
    --generate-ssh-keys \
    --public-ip-sku Standard

# 輸出結果（約需 2-3 分鐘）
{
  "fqdns": "",
  "id": "/subscriptions/xxx/resourceGroups/CloudMart-Lab/providers/Microsoft.Compute/virtualMachines/cloudmart-web-lab",
  "location": "eastasia",
  "macAddress": "00-0D-3A-XX-XX-XX",
  "powerState": "VM running",
  "privateIpAddress": "10.0.0.4",
  "publicIpAddress": "20.xxx.xxx.xxx",
  "resourceGroup": "CloudMart-Lab"
}
```

**參數說明：**

| 參數 | 說明 |
|------|------|
| `--resource-group` | 放在哪個資源群組 |
| `--name` | 虛擬機名稱 |
| `--image` | 作業系統映像 |
| `--size` | 機器規格（B1s 是最小的，適合測試） |
| `--admin-username` | 管理員帳號 |
| `--generate-ssh-keys` | 自動產生 SSH 金鑰 |
| `--public-ip-sku` | 公用 IP 類型 |

### 1.6.4 連線到虛擬機

```bash
# 使用 SSH 連線
ssh azureuser@20.xxx.xxx.xxx

# 成功連線後會看到
Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 6.2.0-1018-azure x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

azureuser@cloudmart-web-lab:~$
```

### 1.6.5 安裝 Web 伺服器

```bash
# 更新套件清單
sudo apt update

# 安裝 Nginx
sudo apt install -y nginx

# 確認 Nginx 正在運行
sudo systemctl status nginx

# 輸出
● nginx.service - A high performance web server and a reverse proxy server
     Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)
     Active: active (running) since Mon 2024-01-15 10:30:45 UTC; 10s ago
```

### 1.6.6 開放網路存取

預設情況下，Azure 虛擬機的防火牆會阻擋所有入站流量。我們需要開放 HTTP 埠（80）：

```bash
# 開放 80 埠
az vm open-port \
    --resource-group CloudMart-Lab \
    --name cloudmart-web-lab \
    --port 80 \
    --priority 1001
```

現在打開瀏覽器，輸入虛擬機的公用 IP 位址，你應該會看到 Nginx 的歡迎頁面！

### 1.6.7 清理資源

**重要：** 完成實驗後記得刪除資源，避免產生費用。

```bash
# 刪除整個資源群組（包含其中所有資源）
az group delete \
    --name CloudMart-Lab \
    --yes \
    --no-wait
```

---

## 1.7 章節總結

### 核心概念回顧

| 概念 | 說明 | CloudMart 範例 |
|------|------|---------------|
| **虛擬化** | 在一台實體機上運行多台虛擬機 | 從一台伺服器擴展到多個 VM |
| **Hypervisor** | 管理虛擬機的軟體層 | Azure 使用 Type 1 Hypervisor |
| **公有雲** | 多租戶共享的雲端環境 | Azure、AWS、GCP |
| **私有雲** | 單一組織專用的雲端環境 | Azure Stack |
| **混合雲** | 結合公有雲和私有雲 | CloudMart 的整體架構 |
| **IaaS** | 租用基礎設施 | Azure VMs |
| **PaaS** | 租用平台服務 | Azure App Service |
| **SaaS** | 使用現成軟體 | Microsoft 365 |
| **CapEx** | 資本支出 | 購買伺服器 |
| **OpEx** | 營運支出 | 雲端月租費 |

### AZ-900 考試重點

1. **雲端運算的特性**：隨選自助、廣泛網路存取、資源池化、快速彈性、可計量服務
2. **服務模型責任**：知道每種模型中，你和供應商各負責什麼
3. **部署模型差異**：公有雲、私有雲、混合雲的適用情境
4. **經濟效益**：CapEx vs. OpEx 的轉換

### 學習檢查清單

完成本章後，請確認你可以：

- [ ] 解釋什麼是虛擬化以及它的好處
- [ ] 說明 Type 1 和 Type 2 Hypervisor 的差異
- [ ] 區分 IaaS、PaaS、SaaS 的責任範圍
- [ ] 為給定的情境選擇適當的服務模型
- [ ] 解釋公有雲、私有雲、混合雲的差異
- [ ] 說明 CapEx 和 OpEx 的差異
- [ ] 使用 Azure CLI 建立虛擬機

---

## 1.8 下一章預告

在下一章「透視網路傳輸」中，我們將深入探討：

- 當用戶在瀏覽器輸入 `www.cloudmart.com` 時，背後發生了什麼？
- TCP/IP 協定堆疊的每一層在做什麼？
- 如何使用 Wireshark 分析網路封包？
- HTTPS 是如何保護你的信用卡資訊的？

這些知識將幫助你理解 CloudMart 如何在網際網路上安全地服務全球客戶。

---

## 延伸閱讀

- [Azure 架構中心](https://docs.microsoft.com/azure/architecture/)
- [NIST 雲端運算定義](https://csrc.nist.gov/publications/detail/sp/800-145/final)
- [Microsoft Learn: Azure 基礎知識](https://docs.microsoft.com/learn/paths/azure-fundamentals/)

---

**下一章：[第 2 章：透視網路傳輸](./chapter-02.md)**
